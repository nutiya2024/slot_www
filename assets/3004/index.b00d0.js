window.__require=function e(t,o,n){function i(s,c){if(!o[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+s+"'")}s=r}var p=o[s]={exports:{}};t[s][0].call(p.exports,function(e){return i(t[s][1][e]||e)},p,p.exports,e,t,o,n)}return o[s].exports}for(var a="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({CCLYBill:[function(e,t,o){"use strict";cc._RF.push(t,"4d52acuR2hOvabd6qh/rtL3","CCLYBill");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYManager"),c=cc._decorator,r=c.ccclass,l=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onLoad=function(){this.layer_min=this.node.getChildByName("layer_min"),this.an_fish=this.layer_min.getChildByName("an_fish").getComponent(cc.Animation),this.lb_gold0=this.layer_min.getChildByName("lb_gold").getComponent("CCLYLabel"),this.an_bg=this.layer_min.getChildByName("an_bg").getComponent(cc.Animation),this.win=this.layer_min.getChildByName("win");for(var e=["win18_","win19_","win20_","win21_","win11_","win16_","win17_"],t=0;t<e.length;t++){var o=s.default.once.getEffectByType(e[t]);o.wrapMode=cc.WrapMode.Loop,this.an_fish.addClip(o)}var n=s.default.once.getEffectByType("bigWin_bg_");n.wrapMode=cc.WrapMode.Loop,this.an_bg.addClip(n),this.an_bg.on("finished",this.onFinishAnimate,this)},t.prototype.show=function(e){var t=this;this.param=e,this.node.active=!0,this.win.active=!0,this.win.opacity=0,this.seatId=e.seatId,this.layer_min.active=!0,this.layer_min.scale=1.2,s.default.once.playSFX("bill_min"),this.lb_gold0.string=e.award?s.default.once.GameLayer.changeGold(e.award):"",this.an_fish.node.active=!0,this.an_fish.node.scale=1,this.an_bg.play("bigWin_bg_"),25==e.fid&&(e.fid=18),this.an_fish.play("win"+e.fid+"_"),this.an_fish.node.scale=16==e.fid||17==e.fid?.7:1,this.win.runAction(cc.sequence(cc.delayTime(1),cc.fadeIn(.1))),this.scheduleOnce(function(){t.clean(),s.default.once.GameLayer.EffectLayer.onFinishEffect(t.param),s.default.once.GameLayer.despawnBill(t)},2)},t.prototype.onFinishAnimate=function(){},t.prototype.clean=function(){this.node.stopAllActions(),this.unscheduleAllCallbacks()},a([r],t)}(cc.Component));o.default=l,cc._RF.pop()},{"./CCLYManager":"CCLYManager"}],CCLYBullet:[function(e,t,o){"use strict";cc._RF.push(t,"1956b7bPi9D/o1zElxXyFnq","CCLYBullet");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYFish"),r=e("./CCLYManager"),l=cc._decorator,p=l.ccclass,d=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.seatId=0,t.bulletId=0,t.angle=0,t.level=0,t.collisionCount=0,t.initTime=0,t._lastUpdateTime=0,t.lockFishId=s.CCLYConst.once.NotFound,t.radius=0,t}return i(t,e),t.prototype.onLoad=function(){this.node.zIndex=-1,this.sp=this.node.getComponent(cc.Sprite),this.radius=s.CCLYConst.once.BulletRadius,this.an_bullet=this.node.getComponent(cc.Animation)},t.prototype.init=function(e){var t=Date.now();this.initTime=t,this.seatId=e.seatId,this.bulletId=e.bulletId,this.bxy=null,this.drillRoute=null,this.isDrill=e.isDrill,this.boomWay=e.boomWay,this.nid=e.nid,this.boomPercent=e.boomPercent,this.node.stopAllActions(),this.angle=-e.angle,this.node.angle=e.angle,this.node.position=e.point,e.level<0&&(e.level=0),e.level>3&&(e.level=3),this.level=e.level,this.collisionCount=0,this._enableUpdate=!0,this.node.scale=e.isDrill?1.1:1.5,this.node.active=!0,this.setLockFishID(e.lock),this.sp.spriteFrame=e.isDrill?s.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("sickleHalo"):s.CCLYConst.once.MapAtlas.get("paopao1").getSpriteFrame("paopao_"+this.seatId+"_"+this.level),this.node.children[0].getComponent(cc.Sprite).spriteFrame=e.isDrill?s.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("sickle"):null,e.isDrill&&(this.node.runAction(cc.repeatForever(cc.rotateBy(.25,100))),this.addNewRoute()),this._lastUpdateTime=this.initTime},t.prototype.setLockFishID=function(e){this.lockFish=r.default.once.GameLayer.getLockFishByFishId(e),this.lockFish instanceof c.default?this.lockFishId=e:this.lockFishId=s.CCLYConst.once.NotFound},t.prototype.setOutPosition=function(e){this.angle=e.angle,this.node.x+=e.x,this.node.y+=e.y},t.prototype.calculateDrillBoomPoint=function(){if(++this.collisionCount==this.boomWay&&this.isDrill){var e=cc.v2(this.node.x,this.node.y),t=cc.view.getVisibleSize(),o=Math.sin(this.angle/180*Math.PI),n=Math.cos(this.angle/180*Math.PI),i=o>0?t.width/2-e.x:-t.width/2-e.x,a=n>0?t.height/2-e.y:-t.height/2-e.y,c=s.CCLYConst.once.BulletSpeed.x*o,r=s.CCLYConst.once.BulletSpeed.y*n,l=Math.abs(i/c*this.boomPercent/100),p=Math.abs(a/r*this.boomPercent/100);e.x+=c*Math.min(l,p),e.y+=r*Math.min(l,p),this.bxy=e}},t.prototype.updatexxx=function(){if(this._enableUpdate){if(this.lockFish instanceof c.default){var e=this.lockFish.getWorldPoint(),t=this.node.convertToWorldSpaceAR(cc.v2(0,0));this.angle=r.default.once.convertPointToAngle(t,e)-90}var o=Date.now(),n=(o-this._lastUpdateTime)/1e3;this._lastUpdateTime=o;var i=cc.v2(s.CCLYConst.once.BulletSpeed.x,s.CCLYConst.once.BulletSpeed.y);this.isDrill&&(i.x*=.2,i.y*=.2);var a=r.default.once.calculateSpacePoint({angle:this.angle,space:n,speed:i});this.node.x+=a.x,this.node.y+=a.y;var l=r.default.once.convertPositionAngle({x:this.node.x,y:this.node.y,angle:this.angle});if(l.out?(this.clearLockID(),this.setOutPosition(l),this.calculateDrillBoomPoint(),this.addNewRoute()):this.checkDrillBoom(a.x,a.y),this.node.angle=-this.angle,this.isDrill&&this.drillRoute){this.drillRoute.angle=-this.angle;var p=this.drillRoute.position.sub(this.node.position).mag();this.drillRoute.height=p}}},t.prototype.addNewRoute=function(){this.isDrill&&r.default.once.GameLayer.EffectLayer.addEffect({skillId:s.CCLYEffectType.TLBoomRoute,nid:this.nid})},t.prototype.checkDrillBoom=function(e,t){if(this.bxy&&this.isDrill){var o=this.node.x>this.bxy.x&&e>0||this.node.x<this.bxy.x&&e<0,n=this.node.y>this.bxy.y&&t>0||this.node.y<this.bxy.y&&t<0;(o||n)&&(this.node.position=this.bxy,this.lowerNet(!1))}},t.prototype.beAttackFish=function(e){e&&e.alive&&e.beAttack()},t.prototype.clearLockID=function(){this.setLockFishID(-1)},t.prototype.lowerNet=function(e,t){void 0===e&&(e=!0),this._enableUpdate=!1,e&&(t=t||this.node.convertToWorldSpaceAR(cc.v2(0,0)),r.default.once.GameLayer.addNet(t,this.level,this.node.angle,this.seatId)),this.an_bullet.currentClip&&this.an_bullet.removeClip(this.an_bullet.currentClip,!0),r.default.once.GameLayer.despawnBullet(this)},t.prototype.sendHitFishReqType=function(e){if(e instanceof c.default&&this.seatId===s.CCLYConst.once.seatId){var t=this.isDrill?3:1;if(this.isDrill&&parseInt(e.config.Skill)>0)return;if(2==e.config.propFish&&(t=7,this.isDrill))return;var o=this.lockFish instanceof c.default?this.lockFish.fishId:null;r.default.once.requestShotTarget(e.fishId,this.bulletId,t,o)}},t.prototype.onCollision=function(e){var t=this.lockFishId===e.fishId;if((this._enableUpdate||t)&&(this.lockFishId===s.CCLYConst.once.NotFound||t)){if(!this.isDrill){var o=t?e.getWorldPoint():null;this.lowerNet(!0,o)}this.sendHitFishReqType(e),this.beAttackFish(e)}},a([p],t)}(cc.Component));o.default=d,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYFish":"CCLYFish","./CCLYManager":"CCLYManager"}],CCLYCoin:[function(e,t,o){"use strict";cc._RF.push(t,"98e91uTKStA6Ic5YraMejw/","CCLYCoin");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onLoad=function(){this.sb_bg=this.node.getComponent(cc.Sprite),this.an_bg=this.node.getComponent(cc.Animation);var e=c.default.once.getEffectByType("smoke");e.wrapMode=cc.WrapMode.Normal,this.an_bg.addClip(e),this.an_bg.on("finished",this.onFinishAn,this)},t.prototype.onFinishAn=function(){var e=s.CCLYConst.once.MapAtlas.get("paopao1"),t=this.param?"bigpaopao_"+this.param.fid:null;this.sb_bg.spriteFrame=e.getSpriteFrame(t)},t.prototype.clean=function(){this.node.stopAllActions(),this.node.active=!1},t.prototype.init=function(e){var t=this;this.clean(),this.node.active=!0,this.an_bg.play("smoke"),this.param=e;var o=cc.v2(e.position.x,e.position.y);this.node.setPosition(o);var n=e.i;this.node.setScale(.5),this.node.opacity=0;var i=cc.sequence(cc.fadeIn(.03),cc.moveBy(.12,cc.v2(0,110)).easing(cc.easeOut(3)),cc.moveBy(.1,cc.v2(0,-110)).easing(cc.easeIn(3))),a=cc.spawn(i,cc.scaleTo(.3,.5)),s=this.node.parent.convertToNodeSpaceAR(e.to),r=cc.v2((o.x+s.x)/2,o.y+50),l=cc.bezierTo(2,[o,r,s]),p=cc.spawn(l.easing(cc.easeOut(2)),cc.scaleTo(2,.35)),d=cc.callFunc(function(){var t="gold_small";e.fid>9&&(t="gold"),e.fid>19&&(t="gold_big"),e.skillId>100&&(t="gold_effect"),c.default.once.playSFX(t)}),h=cc.callFunc(function(){c.default.once.playSFX("back")}),f=c.default.once.GameLayer.getUserByTable(e.seatId);f&&(s=this.node.parent.convertToNodeSpaceAR(f.getUserWinWorldPoint()));var u=cc.callFunc(function(){0===n&&c.default.once.showCoinLbAction({position:s,award:e.award,self:e.self}),c.default.once.GameLayer.despawnCoin(t)}),C=[];n*=.07,C.push(cc.delayTime(n));var y=!e.skillId,g=e.self&&0===e.i;y&&g&&C.push(d),C.push(a),C.push(cc.delayTime(.7)),y&&g&&C.push(h),C.push(p),C.push(u),this.node.runAction(cc.sequence(C))},a([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYConst:[function(e,t,o){"use strict";var n;cc._RF.push(t,"6797dnzKUBGz4ZUvF33WNIH","CCLYConst"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoadType=o.CCLYConst=o.CCLYEffectType=o.CCLYFireSpeed=o.CCLYFishStatus=void 0,function(e){e[e.Die=0]="Die",e[e.Live=1]="Live"}(o.CCLYFishStatus||(o.CCLYFishStatus={})),function(e){e[e.Speed0=.2]="Speed0",e[e.Speed1=.1]="Speed1"}(n=o.CCLYFireSpeed||(o.CCLYFireSpeed={})),function(e){e[e.None=0]="None",e[e.Ice=101]="Ice",e[e.TLBoom=103]="TLBoom",e[e.TLBoomRoute=1031]="TLBoomRoute",e[e.BigBoom=104]="BigBoom",e[e.BigBoomYanHua=109]="BigBoomYanHua",e[e.ZZBoom=106]="ZZBoom",e[e.ZZBoom4Child=1066]="ZZBoom4Child",e[e.ZZBoomBoList=1068]="ZZBoomBoList",e[e.ZZBoomBo=1067]="ZZBoomBo",e[e.WGBoom=1063]="WGBoom",e[e.WGBoomST=1064]="WGBoomST",e[e.WGBoomLight=1061]="WGBoomLight",e[e.WGBoomQuan=1062]="WGBoomQuan",e[e.XZBoom=108]="XZBoom",e[e.XZBoomLight=1081]="XZBoomLight",e[e.Double=105]="Double",e[e.Fast=100]="Fast",e[e.Bill=120]="Bill",e[e.SamllBill=1201]="SamllBill"}(o.CCLYEffectType||(o.CCLYEffectType={}));var i=function(){function e(){this.NotFound=999999999,this.CoinRotationTime=.06,this.FishRedDuring=.15,this.NetMaxTime=.2,this.BulletSpeed={x:.6,y:.6},this.BoomR=200,this.IsDrillR=200,this.LastFishSD=[],this.AutoLimit=n.Speed0,this.FightLimit=n.Speed0,this.WeaponHight=110,this.BorderCount=4,this.BulletRadius=25,this.FireCD=180,this.compensate=0,this.MapCompensate=new Map,this.IsDrill=!1,this.BombId="",this.Round=101,this.BulletCount=0,this.NetUp=0,this.NetDown=0,this.winScale=cc.v2(1,1),this.IsAuto=!1,this.IsLock=!1,this.HeartBeatCD=0,this.MapAtlas=new Map,this.MapSwims=new Map,this.MapDieanis=new Map,this.MapEffects=new Map,this.diamond=0,this.RoomBet=1,this.BLevel=0,this.BLevels=[1,2,3,4,5],this.CannonBets=[],this.seatId=-1,this.userId=-1,this.TableId=-1,this.Entries=0,this.Winning=0,this.users={},this.UIAtals=null}return Object.defineProperty(e,"once",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e.destroyInstance=function(){e._instance&&(e._instance=null,delete e._instance)},e}();o.CCLYConst=i,function(e){e[e.Sprite=0]="Sprite",e[e.Atlas=1]="Atlas",e[e.Skeleton=2]="Skeleton",e[e.ParticleAsset=3]="ParticleAsset",e[e.Prefab=4]="Prefab",e[e.Json=5]="Json"}(o.GameLoadType||(o.GameLoadType={})),cc._RF.pop()},{}],CCLYEffectLayer:[function(e,t,o){"use strict";cc._RF.push(t,"e2de55mJvJAy6TScs0szy9a","CCLYEffectLayer");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=e("../../../Script/utils/Utils"),l=cc._decorator,p=l.ccclass,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.an_waves=null,t.lb_fire=null,t.layer_recharge=null,t.sp_haicao=null,t.layer_paopao=[],t.bill_cd=0,t}return i(t,e),t.prototype.onLoad=function(){this.initEvents()},t.prototype.initEvents=function(){this.map_info=new Map;for(var e=0;e<4;e++)this.map_info.set(e,[]);for(this.map_sameinfo=new Map,e=0;e<4;e++)this.map_sameinfo.set(e,[]);for(this.lb_max=this.node.getChildByName("lb_max"),this.lb_ms=this.node.getChildByName("lb_ms").getComponent(cc.Label),this.an_waves.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(5,1.8,1.2),cc.delayTime(1),cc.scaleTo(5,1.5,1)))),e=0;e<this.layer_paopao.length;e++)for(var t=this.layer_paopao[e],o=0;o<t.children.length;o++)t.children[o].active=!1},t.prototype.showNetMs=function(){this.lb_ms.string="\u5ef6\u8fdf\uff1a"+(s.CCLYConst.once.NetUp+s.CCLYConst.once.NetDown)},t.prototype.prefixInteger=function(e,t){return(e/Math.pow(10,t)).toFixed(t).substr(2)},t.prototype.showLable=function(e){this.lb_fire.node.parent.active=e<-60;var t=Math.ceil(90+e)<0?0:Math.ceil(90+e);this.lb_fire.string="Since you have'nt fired in a minute, you will leave the game in "+t+" s"},t.prototype.showRecharge=function(){Common.showMessage("not enough balance")},t.prototype.onClickedCloseRechargeTip=function(){this.layer_recharge.active=!1,this.layer_recharge.opacity=255,this.layer_recharge.stopAllActions()},t.prototype.defaultLight=function(e){var t="0;0;1000".split(";"),o=t[0]||0,n=t[1]||0,i=e.convertToWorldSpaceAR(cc.v2(parseFloat(o+""),parseFloat(n+""))),a=t[2]||1500;this.initLight(i,a)},t.prototype.initLight=function(e,t){this.v2Light=e,this.lightHeight=parseFloat(t)},t.prototype.pushFishEffect=function(e,t,o,n){for(var i=0;i<e.length;i++){var a=r.default.deepCopy(o),s=e[i];s.alive&&(s.pushEffect(t,a),n&&a.fishId!==s.fishId&&(a.target=s.node.position,a.playSFX=0===i,a.end=i===e.length-1,c.default.once.GameLayer.addEffect(a)))}},t.prototype.addEffect=function(e){var t=this;if(cc.isValid(this.node)){var o=r.default.deepCopy(e);if(o.skillId===s.CCLYEffectType.Ice&&(c.default.once.playSFX("effect_101"),o.duringTime=o.leftTime||10,o.position=o.position||cc.v2(0,0),this.pushFishEffect(c.default.once.GameLayer.getFishs(),o.skillId,o),c.default.once.GameLayer.addEffect(o)),o.skillId===s.CCLYEffectType.BigBoom&&(c.default.once.playSFX("boom"),c.default.once.GameLayer.addEffect(o)),o.skillId===s.CCLYEffectType.TLBoom&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.WGBoom&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.WGBoomLight&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.WGBoomST&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.XZBoom&&(c.default.once.playSFX("double"),c.default.once.GameLayer.addEffect(o)),o.skillId===s.CCLYEffectType.XZBoomLight&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.ZZBoom&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.ZZBoom4Child&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.ZZBoomBo&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.ZZBoomBoList&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.TLBoomRoute)for(var n=c.default.once.GameLayer.getBullets(),i=0;i<n.length;i++){var a=n[i];o.nid===a.nid&&(cc.log("param.nid-----\x3e"+o.nid),c.default.once.GameLayer.addRoute(a))}if(o.skillId===s.CCLYEffectType.BigBoomYanHua&&c.default.once.GameLayer.addEffect(o),o.skillId===s.CCLYEffectType.Fast){o.duringTime=o.time||2,this.pushFishEffect(c.default.once.GameLayer.getFishs(),s.CCLYEffectType.Fast,o);var l=cc.view.getVisibleSize().width/2-20;this.sp_haicao.node.stopAllActions(),this.sp_haicao.node.active=!0,this.sp_haicao.node.opacity=0;var p=-l-70,d=500/-p/2+3;p-=1e3;var h=cc.callFunc(function(){t.sp_haicao.node.setPosition(l,0),t.sp_haicao.node.opacity=255,c.default.once.GameLayer.changeSceneBg(o.now,o.anim,o.later)}),f=cc.callFunc(function(){t.sp_haicao.node.active=!1,c.default.once.sendChangeScene()}),u=[cc.delayTime(o.duringTime),h,cc.moveTo(d,cc.v2(p,0)),f];this.sp_haicao.node.runAction(cc.sequence(u))}if(o.skillId===s.CCLYEffectType.Double&&(c.default.once.playSFX("double"),c.default.once.GameLayer.WeaponLayer.showDoubleByIndex(o.index,o.left)),o.skillId===s.CCLYEffectType.Bill){o.index=c.default.once.tableConvertIndex(o.seatId),o.nid=r.default.generateMixed(20);var C=this.map_info.get(o.seatId)||[];o.position=c.default.once.GameLayer.WeaponLayer.getWeaponOutPositionByTid(o.seatId,0),o.position.y=o.index>1?o.position.y-138:o.position.y+138,o.limit=o.limit||o.type,C.push(o),this.map_info.set(o.seatId,C),this.checkPlayBill(o)}o.skillId===s.CCLYEffectType.SamllBill&&(o.index=c.default.once.tableConvertIndex(o.seatId),o.nid=r.default.generateMixed(20),(C=this.map_sameinfo.get(o.seatId)||[]).push(o),this.map_sameinfo.set(o.seatId,C))}},t.prototype.checkPlayBill=function(e){var t=this.map_info.get(e.seatId),o=function(e,t,o,n){for(var i=!0,a=0,s=0,c=0;c<e.length;c++)e[c].limit===t&&o!==e[c].nid&&(i=!1),e[c].limit===t&&a++,e[c].limit!==t||e[c].playing||s++;return i&&n||s===a&&0!==s};if(t)for(var n=0;n<t.length;n++){var i=t[n];o(t,i.limit,i.nid,!i.playing)&&(t[n].playing=!0,this.map_info.set(e.seatId,t),c.default.once.playSFX("bill_big"),c.default.once.GameLayer.addBill(t[n]))}},t.prototype.onFinishEffect=function(e){if(-1!==[s.CCLYEffectType.Bill].indexOf(e.skillId)){for(var t=this.map_info.get(e.seatId),o=0;o<t.length;o++)if(t[o].nid===e.nid){t.splice(o,1);break}this.map_info.set(e.seatId,t),this.checkPlayBill(e)}},t.prototype.refreshSmallBill=function(){for(var e=this,t=function(t){var n=o.map_sameinfo.get(t);if(n.length>0){var i=o.layer_paopao[t];if(n.length>0&&n[0].show){var a=i.children[0];a.stopAllActions(),a.runAction(cc.sequence(cc.spawn(cc.fadeOut(.1),cc.scaleTo(.3,0,1)),cc.callFunc(function(){a.active=!1,i.removeChild(a),i.addChild(a),n.splice(0,1),e.map_sameinfo.set(t,n)})))}for(var c=0;c<4;c++){var r=i.children[c];r.scale=1,r.opacity=255,r.active=n.length>c,n.length>c&&(r.getComponent(cc.Sprite).spriteFrame=s.CCLYConst.once.MapAtlas.get("paopao1").getSpriteFrame("bigpaopao_"+n[c].fid),r.getChildByName("lb").getComponent("CCLYLabel").string=n[c].award,n[c].show||(r.opacity=0,r.stopAllActions(),r.runAction(cc.fadeIn(.3))),n[c].show=!0)}}},o=this,n=0;n<4;n++)t(n)},t.prototype.updateShadowEffect=function(e,t){var o=e.x-this.v2Light.x,n=e.y-this.v2Light.y,i=cc.v2(0,0),a=e.sub(this.v2Light).mag(),s=(t+this.lightHeight)*a/this.lightHeight;return i.x=e.x+o*(s/a-1),i.y=e.y+n*(s/a-1),i},t.prototype.update=function(e){this.bill_cd-=e,this.bill_cd<0&&(this.bill_cd=1,this.refreshSmallBill())},t.prototype.onDestroy=function(){},a([d(cc.Animation)],t.prototype,"an_waves",void 0),a([d(cc.Label)],t.prototype,"lb_fire",void 0),a([d(cc.Node)],t.prototype,"layer_recharge",void 0),a([d(cc.Sprite)],t.prototype,"sp_haicao",void 0),a([d([cc.Node])],t.prototype,"layer_paopao",void 0),a([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYEffect:[function(e,t,o){"use strict";cc._RF.push(t,"a3eb0x93qFNMaL18Z73yZZx","CCLYEffect");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../../Script/utils/Utils"),c=e("./CCLYConst"),r=e("./CCLYFish"),l=e("./CCLYManager"),p=cc._decorator,d=p.ccclass,h=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onLoad=function(){this.an_effect=this.node.getChildByName("an_effect").addComponent(cc.Animation),this.an_1=this.node.getChildByName("sp_1").addComponent(cc.Animation),this.an_0=this.node.getChildByName("sp_0").addComponent(cc.Animation),this.an_effect.on("finished",this.onFinishAnimate,this),this.sp_effect=this.node.getChildByName("an_effect").getComponent(cc.Sprite),this.sp_2=this.node.getChildByName("sp_2").getComponent(cc.Sprite),this.sp_1=this.node.getChildByName("sp_1").getComponent(cc.Sprite),this.sp_0=this.node.getChildByName("sp_0").getComponent(cc.Sprite),this.sp_0.node.on("click",this.onClickedEffect,this)},t.prototype.init=function(e){var t=this;this.node.position=e.position||cc.v2(0,0),this.node.angle=0,this.node.active=!0,e.parent=!1,this.node.zIndex=0,this.param=e,this.node.scale=1,this.node.opacity=255,this.sp_0.node.children[0].active=!1,this._enableUpdate=!1;for(var o=0;o<this.node.children.length;o++){var n=this.node.children[o].getComponent(cc.Sprite),i=this.node.children[o].getComponent(cc.Animation);i.stop(),i.pause(),n.node.active=!0,n.spriteFrame=null,n.node.scale=1,n.node.stopAllActions(),n.node.opacity=255,n.node.color=cc.Color.WHITE,n.node.rotation=0,n.node.anchorX=.5,n.node.setPosition(0,0)}if(e.skillId===c.CCLYEffectType.BigBoom&&(this.sp_1.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect0").getSpriteFrame("halo17"),this.node.scale=.1,this.node.runAction(cc.sequence(cc.scaleTo(1.1,5),cc.fadeOut(.2),cc.callFunc(function(){t.onFinishAnimate()})))),e.skillId===c.CCLYEffectType.Ice){var a=c.CCLYConst.once.MapAtlas.get("effect0").getSpriteFrame("hive2"),p=[cc.v2(-150,-150),cc.v2(-150,150),cc.v2(150,-150),cc.v2(150,150)];for(o=0;o<this.node.children.length;o++)(n=this.node.children[o].getComponent(cc.Sprite)).spriteFrame=a,n.node.rotation=0,n.node.scale=1,n.node.setPosition(p[o]);this.sp_0.node.runAction(cc.sequence(cc.moveTo(.1,cc.v2(0,0)),cc.callFunc(function(){t.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect0").getSpriteFrame("halo11_0"),t.sp_0.node.scale=.5,t.sp_0.node.opacity=0}),cc.fadeIn(.05),cc.scaleTo(.3,5),cc.fadeOut(.1))),this.sp_1.node.runAction(cc.sequence(cc.moveTo(.1,cc.v2(0,0)),cc.callFunc(function(){t.sp_1.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect0").getSpriteFrame("halo11_1"),t.sp_1.node.scale=.2,t.sp_1.node.opacity=0}),cc.fadeIn(.05),cc.scaleTo(.3,3.5),cc.fadeOut(.1))),this.sp_2.node.runAction(cc.sequence(cc.moveTo(.1,cc.v2(0,0)),cc.callFunc(function(){t.sp_2.node.scale=1,t.sp_2.node.opacity=0,t.sp_2.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect0").getSpriteFrame("light11")}),cc.spawn(cc.fadeIn(.1),cc.scaleTo(.3,3)),cc.fadeOut(.05))),this.an_effect.node.runAction(cc.sequence(cc.moveTo(.1,cc.v2(0,0)),cc.callFunc(function(){t.an_effect.node.opacity=0}),cc.spawn(cc.fadeIn(.05),cc.scaleTo(.15,2)),cc.scaleTo(.2,1))),this.node.runAction(cc.sequence(cc.delayTime(1.5),cc.fadeOut(.1),cc.callFunc(function(){t.onFinishEffect()})))}var d="",h=cc.WrapMode.Normal;if(e.skillId===c.CCLYEffectType.BigBoomYanHua){var f=l.default.once.getEffectByType("fireworks0_");f.wrapMode=cc.WrapMode.Normal,this.an_effect.addClip(f),this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){t.an_effect.play(f.name)})))}if(e.skillId==c.CCLYEffectType.TLBoom&&(this.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("halo20_0"),this.sp_1.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("halo20_1"),this.sp_effect.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("halo20_1"),this.sp_2.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("halo20_1"),this.sp_0.node.scale=.5,this.sp_0.node.opacity=0,this.sp_1.node.opacity=0,this.sp_1.node.scale=2,this.sp_2.node.opacity=0,this.sp_2.node.scale=2,this.sp_effect.node.opacity=0,this.sp_effect.node.scale=2,e.isDrill=!0,e.boomWay=2,e.boomPercent=99,e.point=e.position,e.nid=s.default.generateMixed(20),this.sp_0.node.runAction(cc.sequence(cc.delayTime(.3),cc.fadeIn(.3),cc.scaleTo(.6,2.5),cc.fadeOut(.5),cc.callFunc(function(){t.onFinishEffect()}))),this.sp_1.node.runAction(cc.sequence(cc.fadeIn(.01),cc.scaleTo(.8,.2))),this.sp_effect.node.runAction(cc.sequence(cc.fadeIn(.2),cc.scaleTo(.8,.2),cc.callFunc(function(){l.default.once.GameLayer.addBullet(e);var t=s.default.deepCopy(e);t.angle=t.angle+45,t.nid=s.default.generateMixed(20),l.default.once.GameLayer.addBullet(t)}))),this.sp_2.node.runAction(cc.sequence(cc.fadeIn(.4),cc.scaleTo(.8,.2)))),e.skillId==c.CCLYEffectType.ZZBoom){this.angle=e.angle;var u=l.default.once.getEffectByType("18_2_");u.wrapMode=cc.WrapMode.Loop;var C=l.default.once.getEffectByType("18_6_");C.wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(C),this.an_effect.addClip(u);var y=l.default.once.getEffectByType("redBoom");y.wrapMode=cc.WrapMode.Loop;var g=l.default.once.getEffectByType("die19_light_");g.wrapMode=cc.WrapMode.Loop,this.an_1.node.setPosition(-270,0),this.sp_0.node.setPosition(-110,0),this.an_1.node.scale=2,this.an_1.addClip(y),this.an_1.play(y.name),this.an_1.addClip(g),this.an_effect.node.angle=180,this.an_1.node.runAction(cc.sequence(cc.spawn(cc.scaleTo(2,.5),cc.moveTo(2,cc.v2(-110,0)),cc.rotateTo(2,-540)),cc.delayTime(.1),cc.callFunc(function(){t.an_1.play(g.name),t.an_1.node.scale=4;for(var o=[],n=0;n<8;n++){var i=n%2?.8:1;o.push(cc.scaleTo(.2,i))}o.push(cc.callFunc(function(){var o=s.default.deepCopy(e);t.an_1.stop(),t.an_1.node.active=!1,o.skillId=c.CCLYEffectType.ZZBoom4Child,l.default.once.GameLayer.EffectLayer.addEffect(o),t.sp_0.spriteFrame=null,t.sp_0.node.setPosition(0,0)})),o.push(cc.delayTime(1)),o.push(cc.callFunc(function(){if(t.an_effect.node.rotation=-90,t.sp_0.node.children[0].active=!0,t.an_effect.play(C.name),t._lastUpdateTime=t._initTime=Date.now(),t._enableUpdate=!0,e.seatId==c.CCLYConst.once.seatId){var o=l.default.once.GameLayer.getUserByTable(e.seatId);o&&o.showZZ(!0)}})),t.sp_0.node.runAction(cc.sequence(o)),t.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect2").getSpriteFrame("halo18_0")}))),this.an_effect.play(u.name)}if(e.skillId==c.CCLYEffectType.ZZBoom4Child){var _=[cc.v2(-150,-150),cc.v2(-150,150),cc.v2(150,-150),cc.v2(150,150)],L=function(e){var o=m.node.children[e].getComponent(cc.Sprite);o.node.scale=1,o.node.rotation=180,o.node.setPosition(_[e]),o.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect2").getSpriteFrame("18_5_"+e),o.node.runAction(cc.sequence(cc.delayTime(.3),cc.moveTo(.3,cc.v2(0,0)),cc.delayTime(.1),cc.callFunc(function(){o.node.setPosition(_[e])}),cc.moveTo(.3,cc.v2(0,0)),cc.delayTime(.1),cc.callFunc(function(){0==e&&t.onFinishEffect()})))},m=this;for(o=0;o<this.node.children.length;o++)L(o)}if(e.skillId==c.CCLYEffectType.ZZBoomBo){this.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect2").getSpriteFrame("halo18_1"),this.sp_0.node.scale=4;var v=[cc.v2(-150,-150),cc.v2(-150,150),cc.v2(150,-150),cc.v2(150,150),cc.v2(0,0)];this.sp_0.node.runAction(cc.sequence(cc.spawn(cc.rotateBy(1.5,480),cc.scaleTo(1.5,1)),cc.callFunc(function(){t.sp_0.spriteFrame=null,l.default.once.playSFX("effect_205");for(var o=s.default.deepCopy(e),n=0;n<v.length;n++)o.position=cc.v2(t.node.x+v[n].x,t.node.y+v[n].y),o.i=n,o.skillId=c.CCLYEffectType.ZZBoomBoList,l.default.once.GameLayer.EffectLayer.addEffect(o);t.onFinishEffect()})))}if(e.skillId==c.CCLYEffectType.ZZBoomBoList){this.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect2").getSpriteFrame("halo18_2");var I=l.default.once.getEffectByType("boom1_");I.wrapMode=cc.WrapMode.Normal,this.an_effect.addClip(I),this.an_effect.play(I.name),this.an_effect.node.scale=2.5,this.sp_0.node.opacity=0,this.sp_0.node.scale=0,this.sp_0.node.runAction(cc.sequence(cc.spawn(cc.scaleTo(.5,1),cc.fadeIn(.1)),cc.delayTime(1),cc.callFunc(function(){t.onFinishEffect()})))}if(e.skillId==c.CCLYEffectType.WGBoomQuan&&(d="die19_halo_"),e.skillId==c.CCLYEffectType.WGBoomLight&&(d="die19_light_",this.an_effect.node.scale=3,this.node.position=e.position,h=cc.WrapMode.Loop,this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){t.onFinishEffect()})))),e.skillId==c.CCLYEffectType.WGBoom){this.node.angle=e.angle,this.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("insect2").getSpriteFrame("19_1_0"),this.sp_1.spriteFrame=c.CCLYConst.once.MapAtlas.get("insect2").getSpriteFrame("19_1_0"),this.sp_1.node.color=cc.Color.RED,this.an_effect.stop(),this.sp_1.node.runAction(cc.sequence(cc.blink(2,4),cc.callFunc(function(){t.sp_1.spriteFrame=null}),cc.delayTime(.1),cc.callFunc(function(){for(var o=[150,120,80,40,0,-40,-80,-120,-160,-160],n=[-270,-180,0,-180,0,-180,0,-180,0,-90],i=0;i<o.length;i++){var a=t.node.convertToWorldSpaceAR(cc.v2(o[i],0));a=t.node.parent.convertToNodeSpaceAR(a);var r=n[i]-e.angle;cc.log("i--------\x3e"+i+"----------\x3e"+r);var p=s.default.deepCopy(e);p.skillId=c.CCLYEffectType.WGBoomST,p.position=a,p.p=t.node.convertToWorldSpaceAR(cc.v2(0,0)),p.i=i,p.angle=r,l.default.once.GameLayer.EffectLayer.addEffect(p)}t.onFinishEffect()})));var Y=[-100,0,100];for(o=0;o<Y.length;o++){var b=this.node.convertToWorldSpaceAR(cc.v2(Y[o],0));b=this.node.parent.convertToNodeSpaceAR(b),l.default.once.GameLayer.EffectLayer.addEffect({skillId:c.CCLYEffectType.WGBoomLight,position:b,i:o})}}if(e.skillId==c.CCLYEffectType.WGBoomST){var F;(F=l.default.once.getEffectByType("die19_move_")).wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(F),this.an_effect.node.setPosition(0,-50),this.an_effect.play(F.name);var B=l.default.once.getEffectByType("boom1_");B.wrapMode=cc.WrapMode.Normal,this.an_effect.addClip(B);var T=0==e.i?0:9==e.i?2:1;this.sp_0.spriteFrame=c.CCLYConst.once.MapAtlas.get("effect1").getSpriteFrame("body19_"+T),this.sp_0.node.runAction(cc.rotateBy(2,360));var w=50*Math.sin(e.angle/180*Math.PI)+e.position.x,S=50*Math.cos(e.angle/180*Math.PI)+e.position.y;this.node.runAction(cc.sequence(cc.moveTo(1,cc.v2(w,S)),cc.callFunc(function(){0==e.i&&l.default.once.playSFX("effect_205"),t.an_effect.node.setPosition(0,0),t.an_effect.play(B.name)})))}if(e.skillId==c.CCLYEffectType.XZBoomLight){this.node.parent=l.default.once.GameLayer.RouteParent;var A=l.default.once.getEffectByType("diebg21_");A.wrapMode=cc.WrapMode.Loop,this.an_effect.node.scale=2,this.an_effect.addClip(A),this.an_effect.play(A.name),this.an_effect.node.runAction(cc.sequence(cc.delayTime(4),cc.callFunc(function(){t.onFinishEffect()})))}if(e.skillId==c.CCLYEffectType.XZBoom){cc.log("param",e);var k=cc.v2(e.to.x,e.to.y).sub(cc.v2(e.position.x,e.position.y)).mag(),E=k<165?165:k<415?415:k<830?830:1245,P="lightning"+(k<165?0:k<415?1:k<830?2:3)+"_",x=l.default.once.getEffectByType(P);x.wrapMode=cc.WrapMode.Loop,this.an_effect.node.anchorX=0,this.an_effect.addClip(x);var M=k/E;this.an_effect.node.scaleX=M;var R=l.default.once.convertPointToAngle(e.to,e.position);this.node.angle=-R,this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(e.delay),cc.fadeIn(.01),cc.callFunc(function(){t.an_effect.play(x.name)}),cc.delayTime(.5),cc.callFunc(function(){var o=l.default.once.getFishByFishId(e.fishId);o instanceof r.default&&(o.playDieAni(),e.position=e.coinPosition,l.default.once.addResultCoin(e)),t.an_effect.stop(),t.onFinishEffect()})))}""!=d&&((F=l.default.once.getEffectByType(d)).wrapMode=h,this.an_effect.addClip(F),this.an_effect.play(F.name))},t.prototype.onFinishAnimate=function(){this.param.skillId===c.CCLYEffectType.Ice||this.onFinishEffect()},t.prototype.onFinishEffect=function(){l.default.once.GameLayer.EffectLayer.onFinishEffect(this.param),l.default.once.GameLayer.despawnEffect(this),this.param.skillId===c.CCLYEffectType.WGBoomST&&0==this.param.i&&this.param.seatId==c.CCLYConst.once.seatId&&l.default.once.CmdCCLYSmallBomb(this.param)},t.prototype.onClickedEffect=function(){this.param&&this.param.clicked},t.prototype.clean=function(){this.unscheduleAllCallbacks(),this.node.stopAllActions(),this.param&&(this.param.clicked=!0);for(var e=0;e<this.node.children.length;e++){var t=this.node.children[e].getComponent(cc.Sprite);t.spriteFrame=null,t.node.stopAllActions();var o=t.node.getComponent(cc.Animation);o.stop();var n=o.getClips();if(n)for(var i=n.length-1;i>=0;i--)n[i]instanceof cc.AnimationClip&&o.removeClip(n[i],!0)}},t.prototype.setOutPosition=function(e){this.angle=e.angle,this.node.x+=e.x,this.node.y+=e.y},t.prototype.zzBoom=function(){var e=this;this._enableUpdate=!1;var t=s.default.deepCopy(this.param);t.position=this.node.position,t.skillId=c.CCLYEffectType.ZZBoomBo,l.default.once.GameLayer.EffectLayer.addEffect(t),this.scheduleOnce(function(){e.onFinishEffect()},1)},t.prototype.update=function(){if(this._enableUpdate){var e=Date.now(),t=(e-this._lastUpdateTime)/1e3;this._lastUpdateTime=e,(e-this._initTime)/1e3>5&&this.param.skillId==c.CCLYEffectType.ZZBoom&&(this._enableUpdate=!1,this.param.seatId==c.CCLYConst.once.seatId&&l.default.once.CmdZZBoom(this));var o=cc.v2(.5*c.CCLYConst.once.BulletSpeed.x,.5*c.CCLYConst.once.BulletSpeed.y),n=l.default.once.calculateSpacePoint({angle:this.angle,space:t,speed:o});this.node.x+=n.x,this.node.y+=n.y;var i=l.default.once.convertPositionAngle({x:this.node.x,y:this.node.y,angle:this.angle});i.out&&this.setOutPosition(i),this.node.angle=-this.angle}},a([d],t)}(cc.Component));o.default=h,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYConst":"CCLYConst","./CCLYFish":"CCLYFish","./CCLYManager":"CCLYManager"}],CCLYFishNet:[function(e,t,o){"use strict";cc._RF.push(t,"c3de3oiVhJCL4X7CWyxUNP/","CCLYFishNet");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.netRedius=70,t}return i(t,e),t.prototype.onLoad=function(){this.sp_net=this.node.getComponent(cc.Sprite),this.an_net=this.node.getComponent(cc.Animation);for(var e=0;e<4;e++)for(var t=0;t<4;t++){var o=c.default.once.getEffectByType("paopao_"+e+"_"+t+"_");o.wrapMode=cc.WrapMode.Normal,this.an_net.addClip(o)}this.an_net.on("finished",this.onFinishNet,this)},t.prototype.onFinishNet=function(){c.default.once.GameLayer?c.default.once.GameLayer.despawnNet(this):this.node.destroy()},t.prototype.init=function(e,t,o,n){this.node.position=this.node.parent.convertToNodeSpaceAR(e),this.node.active=!0,this.node.angle=o,this.sp_net.spriteFrame=null,this.an_net.play("paopao_"+n+"_"+t+"_"),this.node.opacity=255,this.node.scale=.8;var i=[],a=cc.scaleTo(s.CCLYConst.once.NetMaxTime,.9);i.push(a);var c=cc.scaleTo(2*s.CCLYConst.once.NetMaxTime/3,.8);i.push(c),i.push(cc.fadeOut(.1));var r=cc.callFunc(this.onFinishNet.bind(this));i.push(r),this.node.runAction(cc.sequence(i))},t.prototype.onDestroy=function(){this.an_net.clear()},a([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYFish:[function(e,t,o){"use strict";cc._RF.push(t,"4e028yJ5XZABJ0T/g0zt3RL","CCLYFish");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fid=-1,t.fishId=-1,t.index=-1,t._state=s.CCLYFishStatus.Die,t._outBorder=!1,t.skillId=-1,t.enbaleMove=!0,t.lastPosition=null,t.initTime=0,t._lastUpdateTime=0,t.swimTime=10,t.leaveTime=0,t.mapEffects=new Map,t.radius=0,t.dieCD=0,t}return i(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e,this.checkLock()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outBorder",{get:function(){return this._outBorder},set:function(e){this._outBorder=e,this.checkLock()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.initView()},t.prototype.initView=function(){this.sp_fish=this.node.getChildByName("sp_fish").getComponent(cc.Sprite),this.sp_effect=this.node.getChildByName("sp_effect").getComponent(cc.Sprite),this.sp_shadow=this.node.getChildByName("sp_shadow").getComponent(cc.Sprite),this.an_fish=this.sp_fish.node.getComponent(cc.Animation),this.an_effect=this.sp_effect.node.getComponent(cc.Animation),this.an_fish.on("finished",this.onFinishAnimate,this),this.sp_fish.node.on(cc.Node.EventType.TOUCH_START,this.onClickFish,this),this.sp_effect.node.on(cc.Node.EventType.TOUCH_START,this.onClickFish,this)},t.prototype.onClickFish=function(e){c.default.once.GameLayer.WeaponLayer.onTouchStart(e,this)},t.prototype.init=function(e){var t=this;this.params=e,this.node.active=!0,this.flipY=s.CCLYConst.once.seatId>1,this.fid=e.fid,this.fishId=e.fishId,this.index=e.index,this.skillId=e.skillId,this.swimTime=e.pathInterval,this.initTime=Date.now()-e.compensate-1e3*e.swimmingInterval,this.config=e.config,this.FishPath=e.FishPath;var o=e.groups.points[this.index];if(this.gpoint=cc.v2(e.groups.origin.x+o.x,e.groups.origin.y+o.y),this.colliders=e.conlliderPoints,this.resetInfo(),this.refreshSwimAni(),this.an_fish.play(this.params.swimAni.name),this.an_effect.node.active=25==e.config.fishType,this.an_effect.node.active){var n=c.default.once.getEffectByType("bigZhiZhuMove");n.wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(n),this.an_effect.play(n.name);for(var i=[],a=0;a<50;a++)i.push(cc.callFunc(function(){t.node.scale=2,t.an_effect.node.opacity=255})),i.push(cc.delayTime(2)),i.push(cc.callFunc(function(){t.node.scale=1,t.an_effect.node.opacity=0})),i.push(cc.delayTime(2));this.an_effect.node.runAction(cc.sequence(i))}this.node.runAction(cc.fadeIn(.1))},t.prototype.refreshSwimAni=function(){for(var e=[this.params.swimAni,this.params.dieAni,this.params.iceAni],t=0;t<e.length;t++){var o=e[t];o.wrapMode=1==t?cc.WrapMode.Normal:cc.WrapMode.Loop,this.an_fish.addClip(o),this.an_fish.play(o.name)}},t.prototype.getColliderPoints=function(){for(var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=[],o=0;o<this.colliders.length;o++)t.push(cc.v2(e.x+this.colliders[o].x,e.y+this.colliders[o].y));return{ws:t,zIndex:this.node.zIndex}},t.prototype.resetInfo=function(){this.node.scale=1,this.sp_fish.spriteFrame=null,this.sp_shadow.spriteFrame=null,this.node.opacity=0,this.sp_fish.node.color=cc.Color.WHITE,this._lastUpdateTime=Date.now(),this.setState(s.CCLYFishStatus.Live),this.dieCD=9999999999,this.outBorder=c.default.once.checkLimitBorder(this.node),this.cleanLockWeapons(),this.enbaleMove=!0,this.mapEffects=null,this.mapEffects=new Map,this.node.zIndex=parseFloat(this.config.Layer||0),this.leaveTime=this.swimTime,this.node.angle=this.FishPath.scale<0?180:0;var e=parseFloat(this.config.Scale),t=this.FishPath.scale*parseFloat(this.config.Scale);this.sp_fish.node.setScale(e,t),this.sp_shadow.node.setScale(e,t);for(var o=c.default.once.convertWindowScale(),n=0;n<this.colliders.length;n++){var i=this.colliders[n],a=i.x*e*o.x,r=i.y*t*o.y;this.radius=Math.max(this.radius,cc.v2(a,r).mag())}this.lastPosition=cc.v2(this.FishPath.points[0].x,this.FishPath.points[0].y),this.node.setPosition(this.lastPosition.x,this.lastPosition.y)},t.prototype.animateFrameChange=function(){this.setShadowSpriteFrame()},t.prototype.getShadowWorldPoint=function(){return this.sp_shadow.node.convertToWorldSpaceAR(cc.v2(0,0))},t.prototype.getWorldPoint=function(){var e={1053:cc.v2(130,0),1036:cc.v2(200,0),1038:cc.v2(50,0),1047:cc.v2(70,0),1019:cc.v2(70,0),1039:cc.v2(100,0)}[this.fid]||cc.v2(0,0);return this.node.convertToWorldSpaceAR(e)},t.prototype.setShadowSpriteFrame=function(){if(this.sp_shadow.spriteFrame!=this.sp_fish.spriteFrame){var e=2!=this.config.propFish&&this.sp_effect.node.active?.5:1;this.sp_shadow.node.scaleX=e*this.sp_shadow.node.scaleX,this.sp_shadow.node.scaleY=e*this.sp_shadow.node.scaleY,this.sp_shadow.spriteFrame=this.sp_effect.node.active?this.sp_effect.spriteFrame:this.sp_fish.spriteFrame}},t.prototype.updateShadowEffect=function(){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=c.default.once.GameLayer.EffectLayer.updateShadowEffect(e,parseFloat(this.config.Layer)),o=this.sp_shadow.node.parent.convertToNodeSpaceAR(t);this.sp_shadow.node.setPosition(o.x,o.y),this.setShadowSpriteFrame()},t.prototype.getSwimF=function(e){return e-this.initTime},t.prototype.pushEffect=function(e,t){if(e===s.CCLYEffectType.Ice&&(this.mapEffects.set(e,{init:Date.now(),duringTime:t.duringTime}),this.an_fish.play(this.params.iceAni.name)),e===s.CCLYEffectType.Fast){var o=this.leaveTime/t.duringTime;this.mapEffects.set(e,o)}},t.prototype.runCurrent=function(e,t){e.currentClip&&e[t](e.currentClip.name)},t.prototype.popEffect=function(e){this.mapEffects.get(e)&&(this.mapEffects.delete(e),e===s.CCLYEffectType.Ice&&(this.alive?this.an_fish.play(this.params.swimAni.name):this.playDieAni()))},t.prototype.setState=function(e){this.state=e},t.prototype.onFinishAnimate=function(){var e=this.an_fish.currentClip;if(e&&-1!==e.name.indexOf("die"))if(parseInt(this.config.Skill)==s.CCLYEffectType.XZBoom){var t=c.default.once.getEffectByType("21_die_");t.wrapMode=cc.WrapMode.Loop,this.an_fish.addClip(t),this.an_fish.play(t.name)}else this.despawnFish()},t.prototype.pushLockSeat=function(e){return-1===this.lockWeapons.indexOf(e)&&(this.lockWeapons.push(e),!0)},t.prototype.popLockTid=function(e){var t=this.lockWeapons.indexOf(e);-1!==t&&this.lockWeapons.splice(t,1)},t.prototype.cleanLockWeapons=function(){this.lockWeapons=[]},t.prototype.calculateFPoint=function(e){if(e<=1){var t=Math.ceil(this.FishPath.points.length*e);t>this.FishPath.points.length-1&&(t=this.FishPath.points.length-1);var o=this.FishPath.points[t],n=o.y+this.gpoint.y;this.flipY&&(n=-n);var i=this.gpoint.x+o.x;return cc.v2(i*s.CCLYConst.once.winScale.x,n*s.CCLYConst.once.winScale.y)}return cc.v2(1e5,1e5)},t.prototype.updateDegree=function(){var e=cc.v2(this.node.x,this.node.y),t=c.default.once.convertPointToAngle(e,this.lastPosition);this.node.angle=-t,this.lastPosition=e},t.prototype.beAttack=function(){var e=this;this.sp_fish.node.color=cc.Color.BLACK.fromHEX("#FD8484"),this.node.stopActionByTag(s.CCLYConst.once.FishAttackAniTag);var t=cc.sequence([cc.delayTime(s.CCLYConst.once.FishRedDuring),cc.callFunc(function(){e.sp_fish.node.color=cc.Color.WHITE})]);t.setTag(s.CCLYConst.once.FishAttackAniTag),this.node.runAction(t)},t.prototype.playDieAni=function(){this.an_fish.play(this.params.dieAni.name)},t.prototype.goDie=function(){this.enbaleMove=!1,this.dieCD=5,this.setState(s.CCLYFishStatus.Die)},Object.defineProperty(t.prototype,"alive",{get:function(){return this.state===s.CCLYFishStatus.Live},enumerable:!1,configurable:!0}),t.prototype.checkDespawn=function(){this.leaveTime<0&&this.despawnFish()},t.prototype.clearLock=function(){c.default.once.GameLayer.clearLockFishAllBullet(this.fishId),c.default.once.GameLayer.WeaponLayer.cleanFishAllWeaponLock(this),this.cleanLockWeapons()},t.prototype.despawnFish=function(){this.sp_effect.node.stopAllActions(),this.clearLock(),this.unscheduleAllCallbacks(),this.mapEffects=new Map;var e=this.an_fish.getClips();if(e)for(var t=e.length-1;t>=0;t--)this.an_fish.removeClip(e[t],!0);var o=this.an_effect.getClips();if(o)for(t=0;t<o.length;t++)this.an_effect.removeClip(o[t],!0);this.an_effect.node.stopAllActions(),this.node.active=!1,c.default.once.GameLayer?c.default.once.GameLayer.despawnFish(this):this.node.destroy()},t.prototype.checkLock=function(){this.outBorder&&this.alive||this.clearLock()},t.prototype.updateEffect=function(e){var t=this,o=e;if(this.mapEffects.size<=0)return o;var n=Date.now();return this.mapEffects.forEach(function(e,i){var a=t.mapEffects.get(i);i===s.CCLYEffectType.Fast&&(o*=a),i==s.CCLYEffectType.Ice&&((n-a.init)/1e3>=a.duringTime&&t.popEffect(i),o=0)}),o},t.prototype.updatexxx=function(e){if(-1!==this.fid){var t=this.updateEffect(e);if(this.enbaleMove){var o=this.updateTime(t);this.updatePonint(o)}(this.dieCD-=e)<0&&this.despawnFish(),this.lastPosition.sub(cc.v2(this.node.x,this.node.y)).mag()>2&&("1"===this.config.Rotation&&this.updateDegree(),this.updateShadowEffect()),this.outBorder=c.default.once.checkLimitBorder(this.node),this.updateLockWeapon()}},t.prototype.updateTime=function(e,t){void 0===t&&(t=!0);var o=this._lastUpdateTime+1e3*e;t&&(this._lastUpdateTime=o);var n=this.getSwimF(o)/1e3;return this.leaveTime=this.swimTime-n,n/this.swimTime},t.prototype.updatePonint=function(e){if(e<=1){var t=this.calculateFPoint(e);this.node.x=t.x,this.node.y=t.y}else this.checkDespawn()},t.prototype.updateLockWeapon=function(){this.lockWeapons.length>0&&c.default.once.showLockLineByTid(this,this.lockWeapons)},t.prototype.onDestroy=function(){},a([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYLabel:[function(e,t){"use strict";cc._RF.push(t,"4f81aIF9X9COYkYNcupmp/U","CCLYLabel");var o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2});cc.Class({editor:!1,extends:cc.Component,properties:{_layout:{get:function(){var e=this.node.getComponent(cc.Layout);return e||((e=this.node.addComponent(cc.Layout)).type=1),e}},string:{default:"",notify:function(){this._updateWordArt()}},alignType:{type:o,default:o.CENTER,notify:function(){this._checkAnchorX()}},defaultNames:{default:"2"},spriteAtlas:{type:cc.SpriteAtlas,default:null}},onLoad:function(){this._checkAnchorX()},_checkAnchorX:function(){this.alignType===o.CENTER?this.node.anchorX=.5:this.node.anchorX=this.alignType===o.RIGHT?1:0},_updateWordArt:function(){if(!this.spriteAtlas)return cc.log("\u65e0\u6548\u7684 spriteAtlas \u56fe\u96c6\u8d44\u6e90\uff01");this._names=this.defaultNames.split(","),this.setWordArt()},setWordArt:function(){try{for(var e=(""+this.string).split(""),t=this.node.children,n=0,i=0;i<e.length||i<t.length;i++){var a=t[i];if(a||((s=(a=new cc.Node).addComponent(cc.Sprite)).trim=!0,s.sizeMode=cc.Sprite.SizeMode.TRIMMED,s.type=cc.Sprite.Type.SIMPLE),a.parent||(a.parent=this.node),a.active=i<e.length,a.active){var s=a.getComponent(cc.Sprite),c=e[this.alignType!==o.CENTER?e.length-1-i:i];if(c=this._names[0]+c,this._names[1]&&(c+=this._names[1]),void 0===c)return void cc.log("\u56fe\u96c6\u8d44\u6e90spriteAtlas \u627e\u4e0d\u5230\u56fe\u7247\u540d\u79f0\uff1a"+c+"\uff01");s.spriteFrame=this.spriteAtlas.getSpriteFrame(""+c),n+=a.width}}n+=(e.length+1)*this._layout.spacingX,this._layout.paddingLeft=this._layout.spacingX,this._layout.paddingRight=this._layout.spacingX,this.node.width=n,this.alignType===o.RIGHT&&(this._layout.horizontalDirection=1),this.alignType===o.LEFT&&(this._layout.horizontalDirection=1),this.alignType===o.CENTER&&(this._layout.horizontalDirection=0)}catch(r){console.log(r)}}}),cc._RF.pop()},{}],CCLYLoading:[function(e,t,o){"use strict";cc._RF.push(t,"348ae6lZIdKnb0S9GRvMk2l","CCLYLoading");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../../Script/utils/Utils"),c=e("./CCLYConst"),r=cc._decorator,l=r.ccclass,p=r.property,d=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.boom=null,e.double=null,e.bill_big=null,e.effect_101=null,e.effect_205=null,e.click=null,e.back=null,e.bill_min=null,e.die=null,e.die_big=null,e.die_small=null,e.effect_108=null,e.gold=null,e.gold_effect=null,e.gold_small=null,e.lock=null,e.weapon_change=null,e.v1=null,e.v2=null,e.v3=null,e.v4=null,e.v5=null,e.v6=null,e.v7=null,e.v8=null,e.v9=null,e.bg0=null,e.bg1=null,e.bg2=null,e.configs=[],e.fishs=[],e.effectArr=[],e}return i(o,t),o.prototype.onLoad=function(){c.CCLYConst.once.PlayerInfo=e("PlayerInfo").getInstant,c.CCLYConst.once.RoomBet=c.CCLYConst.once.PlayerInfo.RoomBet,c.CCLYConst.once.PlayerInfo.fishBetList&&(c.CCLYConst.once.BLevels=c.CCLYConst.once.PlayerInfo.fishBetList),this.loadFinish()},o.prototype.loadFinish=function(){c.CCLYConst.once.FishConfigs=this.configs[1].json;var e=this.configs[2].json.data,t=this.configs[0].json;c.CCLYConst.once.FishGroups=t.data,c.CCLYConst.once.FishPoints=this.configs[3].json;var o=[],n=[];c.CCLYConst.once.FishPath=[];for(var i=0;i<300&&!(e.length<=i);i++){for(var a=e[i],r=[],l=0;l<=1500;l++){var p=l/1500,d=this.makeBreakBezier2(p,a.points,a.controls);r.push(d)}a.time=a.time>30?30:a.time,c.CCLYConst.once.FishPath.push({id:a.id,points:r,time:a.time,scale:1})}var h=["batteryFire","anchor",{key:"fire0_",space:25},{key:"fire1_",space:25},{key:"fire2_",space:25},{key:"fire3_",space:25},{key:"fire4_",space:25},{key:"fire5_",space:25},{key:"fire6_",space:25},{key:"fire7_",space:25},{key:"paotong0_",space:25},{key:"paotong1_",space:25},{key:"paotong2_",space:25},{key:"paotong3_",space:25},{key:"paotong4_",space:25},{key:"paotong5_",space:25},{key:"paotong6_",space:25},{key:"paotong7_",space:25},{key:"hive",space:15},{key:"21_die_",space:10},{key:"18_2_",space:10},{key:"18_5_",space:10},{key:"18_6_",space:10},{key:"bigZhiZhuMove",space:10},{key:"jinggao",space:10},{key:"redBoom",space:10},{key:"tubiao",space:10},"paopao_0_0_","paopao_0_1_","paopao_0_2_","paopao_0_3_","paopao_1_0_","paopao_1_1_","paopao_1_2_","paopao_1_3_","paopao_2_0_","paopao_2_1_","paopao_2_2_","paopao_2_3_","paopao_3_0_","paopao_3_1_","paopao_3_2_","paopao_3_3_","paopao_4_0_","paopao_4_1_","paopao_4_2_","paopao_4_3_","paopao_0_","paopao_1_","paopao_2_","paopao_3_","paopao_4_","paopao_5_0_","paopao_5_1_","paopao_5_2_","paopao_5_3_","bigWin_bg_","bigWin_halo","bigWin_light","win18_","smoke","doubleBg_","fireworks0_","fireworks1_","body19_","boom1_","die19_halo_","die19_light_","die19_move_","diebg21_","halo20_","lightning0_","lightning1_","lightning2_","lightning3_","route_","18_2_","18_5_","18_6_","bigZhiZhuMove","boom0_","halo18_","jinggao","redBoom","tubiao","bgLight_","moveMapLight","win18_","win19_","win20_","win21_","win11_","win16_","win17_"],f=[];for(i=0;i<this.fishs.length;i++)if((C=this.fishs[i])instanceof cc.SpriteAtlas){o.push(C.getSpriteFrames());var u=C.name.split(".")[0];c.CCLYConst.once.MapAtlas.set(u,C)}for(i=0;i<this.effectArr.length;i++){var C;(C=this.effectArr[i])instanceof cc.SpriteAtlas&&("UI"==(u=C.name.split(".")[0])&&(c.CCLYConst.once.UIAtals=C),n.push(C.getSpriteFrames()),c.CCLYConst.once.MapAtlas.set(u,C))}for(i=0;i<f.length;i++){var y=f[i];c.CCLYConst.once.MapEffects.set(y,this[y])}var g=c.CCLYConst.once.FishConfigs;for(i=0;i<g.length;i++){var _=g[i],L=(y=_.FishID,"1"===_.AnimType?c.GameLoadType.Skeleton:c.GameLoadType.Atlas);if(L===c.GameLoadType.Atlas){_.SwimActFPS=parseInt(_.SwimActFPS);var m=this.getAni(o,y+"_1_",L,cc.WrapMode.Loop,_.SwimActFPS);c.CCLYConst.once.MapSwims.set(y,m);var v=this.getAni(o,y+"_4_",L,cc.WrapMode.Loop,_.SwimActFPS);c.CCLYConst.once.MapEffects.set("ice_"+y,v);var I=this.findArrayFile(o,y+"_2_",L);I=this.desArray(I,[y+"_2_"]);var Y=this.findArrayFile(o,y+"_3_",L);Y=this.desArray(Y,[y+"_3_"]);var b="-1"==_.DeadActFPS?_.SwimActFPS:parseInt(_.DeadActFPS),F=s.default.createWithSpriteFrames(I.concat(Y),b,"animateFrameChange",null);F.name="die"+y+"_",F.wrapMode=cc.WrapMode.Normal,c.CCLYConst.once.MapDieanis.set(y,F)}else m="sk_"+y,c.CCLYConst.once.MapSwims.set(y,this[m])}for(i=0;i<h.length;i++){var B=h[i],T=(y="string"==typeof B?B:B.key,B.space||10),w=this.getAni(n,y,c.GameLoadType.Atlas,cc.WrapMode.Default,T);c.CCLYConst.once.MapEffects.set(y,w)}},o.prototype.convertVectorToPoint=function(e,t,o){return cc.v2(e.x+-(e.x-t.x)*o,e.y+-(e.y-t.y)*o)},o.prototype.makeBreakBezier2=function(e,t,o){if(t&&t.length){if(e<=0)return t[0];if(e>=1)return t[t.length-1];for(var n=0,i=this.cheekVectorOrTimeIndex(t,e,!0),a=[t[i.index-1],o[i.index-1],t[i.index]];n<1e3;){n++;for(var s=a.length-1,c=0;c<s;c++)if(a[c]=this.convertVectorToPoint(a[c],a[c+1],i.f),c===s-1&&(a.splice(s,a.length),1===a.length))return a[0]}}},o.prototype.cheekVectorOrTimeIndex=function(e,t,o){for(var n=0,i=[],a=1;a<e.length;a++){var s=100;if(!o){var c=e[a-1],r=e[a];s=Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2),s=Math.sqrt(s)}i.push(s),n+=s}var l=0,p=0;for(a=0;a<i.length;a++){p=a+1;var d=n*t,h=l+(s=i[a]);if(l<d&&d<=h)return{index:p,f:1-(h-d)/s};l=h}return null},o.prototype.desArray=function(e,t){void 0===t&&(t=[]);var o=t.concat(["die"]);return e.sort(function(e,t){for(var n=e.name,i="",a=0;a<o.length;a++)if(-1!==n.indexOf(o[a])){i=o[a];break}var s=n.split(i);n=s[s.length-1];var c=t.name,r=c.split(i);c=r[r.length-1];var l=Math.ceil(n),p=Math.ceil(c);return l>p?1:l<p?-1:0}),e},o.prototype.findArrayFile=function(e,t,o){for(var n=[],i=null,a=0;a<e.length;a++){var r=e[a];if(o===c.GameLoadType.Atlas)if(r instanceof Array)for(var l=0;l<r.length;l++){var p=r[l],d=p.name.split(t);this.same(t,p.name)&&""==d[0]&&s.default.isNumber(d[1])&&n.push(p)}else this.same(t,r.name)&&(d=r.name.split(t),s.default.isNumber(d[1])&&""==d[0]&&n.push(r));else r.name&&-1!==r.name.indexOf(t)&&(i=r)}return o===c.GameLoadType.Atlas?n:i},o.prototype.same=function(e,t){e=e.split(""),t=t.split("");for(var o=0;o<e.length;o++)if(e[o]!=t[o])return!1;return!0},o.prototype.getAni=function(e,t,o,n,i,a,c,r){if(void 0===n&&(n=cc.WrapMode.Loop),void 0===a&&(a=null),void 0===c&&(c=1),void 0===r&&(r=[]),i=i||10,0==r.length&&(r=this.findArrayFile(e,t,o),r=this.desArray(r,[t]),1!==c)){for(var l=[],p=0;p<c;p++)for(var d=0;d<r.length;d++)l.push(r[d]);r=l}var h=s.default.createWithSpriteFrames(r,i,"animateFrameChange",a);return h.name=t,h.wrapMode=n,h},a([p(cc.AudioClip)],o.prototype,"boom",void 0),a([p(cc.AudioClip)],o.prototype,"double",void 0),a([p(cc.AudioClip)],o.prototype,"bill_big",void 0),a([p(cc.AudioClip)],o.prototype,"effect_101",void 0),a([p(cc.AudioClip)],o.prototype,"effect_205",void 0),a([p(cc.AudioClip)],o.prototype,"click",void 0),a([p(cc.AudioClip)],o.prototype,"back",void 0),a([p(cc.AudioClip)],o.prototype,"bill_min",void 0),a([p(cc.AudioClip)],o.prototype,"die",void 0),a([p(cc.AudioClip)],o.prototype,"die_big",void 0),a([p(cc.AudioClip)],o.prototype,"die_small",void 0),a([p(cc.AudioClip)],o.prototype,"effect_108",void 0),a([p(cc.AudioClip)],o.prototype,"gold",void 0),a([p(cc.AudioClip)],o.prototype,"gold_effect",void 0),a([p(cc.AudioClip)],o.prototype,"gold_small",void 0),a([p(cc.AudioClip)],o.prototype,"lock",void 0),a([p(cc.AudioClip)],o.prototype,"weapon_change",void 0),a([p(cc.AudioClip)],o.prototype,"v1",void 0),a([p(cc.AudioClip)],o.prototype,"v2",void 0),a([p(cc.AudioClip)],o.prototype,"v3",void 0),a([p(cc.AudioClip)],o.prototype,"v4",void 0),a([p(cc.AudioClip)],o.prototype,"v5",void 0),a([p(cc.AudioClip)],o.prototype,"v6",void 0),a([p(cc.AudioClip)],o.prototype,"v7",void 0),a([p(cc.AudioClip)],o.prototype,"v8",void 0),a([p(cc.AudioClip)],o.prototype,"v9",void 0),a([p(cc.AudioClip)],o.prototype,"bg0",void 0),a([p(cc.AudioClip)],o.prototype,"bg1",void 0),a([p(cc.AudioClip)],o.prototype,"bg2",void 0),a([p([cc.JsonAsset])],o.prototype,"configs",void 0),a([p([cc.SpriteAtlas])],o.prototype,"fishs",void 0),a([p([cc.SpriteAtlas])],o.prototype,"effectArr",void 0),a([l],o)}(cc.Component);o.default=d,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYConst":"CCLYConst",PlayerInfo:void 0}],CCLYManager:[function(e,t,o){"use strict";cc._RF.push(t,"8a4a3dvo8RBdqwpnIhI9B4V","CCLYManager");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYScene"),r=e("./CCLYFish"),l=e("./CCLYBullet"),p=e("../../../Script/utils/Utils"),d=e("./CCLYNetWork"),h=cc._decorator,f=h.ccclass,u=h.property,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GameLayer=null,t.MusicDic={},t}var o;return i(t,e),o=t,Object.defineProperty(t,"once",{get:function(){return o.instance||(o.instance=new o),o.instance},enumerable:!1,configurable:!0}),t.destroyInstance=function(){o.instance&&(o.instance=null)},t.prototype.requestFishFire=function(e,t){var o=s.CCLYConst.once.BLevels[s.CCLYConst.once.BLevel],n=o*s.CCLYConst.once.RoomBet,i=this.codePoint(e),a={userid:s.CCLYConst.once.userId,bet:o,position:i,bulletId:p.default.generateMixed(20),isDrill:s.CCLYConst.once.IsDrill};s.CCLYConst.once.IsDrill?(a.bulletId=s.CCLYConst.once.BombId,a.boomWay=10,a.boomPercent=50):t&&(a.fishId=t),n<=s.CCLYConst.once.Entries?(this.ShotSelfBullet(a),d.default.once.send("fishShoot",a),s.CCLYConst.once.IsDrill=!1):(s.CCLYConst.once.IsLock&&this.GameLayer.MenuLayer.onClickedLock(),s.CCLYConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(),this.GameLayer.EffectLayer.showRecharge(!0))},t.prototype.showNetError=function(e){cc.isValid(o.once.GameLayer.node)&&(o.once.GameLayer.MenuLayer.LayerNetError.active=e,s.CCLYConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(!1))},t.prototype.requestLeaveRoom=function(){d.default.once.requestLeaveRoom()},t.prototype.requestRechargeAll=function(){var e=this.getUser();e&&e.wins&&e.wins>10&&d.default.once.send("chargeAll",JSON.stringify({}))},t.prototype.requestRechargeSum=function(e){var t=this.getUser();t&&t.wins&&t.wins>e&&d.default.once.send("chargeAll",{sum:e})},t.prototype.heartBeat=function(){},t.prototype.requestShotTarget=function(e,t,o,n,i,a){void 0===o&&(o=1),void 0===i&&(i=!1);var c={uid:s.CCLYConst.once.userId,fishId:e,bulletId:t,bulletType:o};n&&(c.lockFishId=n),i&&(c.format=1),a&&(c.from=a),d.default.once.send("fishHit",c)},t.prototype.requestChangeCannonBet=function(e){d.default.once.send("changePower",e)},t.prototype.CmdCCLYLordSettle=function(e){if(cc.log("CmdCCLYLordSettle: "+JSON.stringify(e)),e.bonus){e.bonus*=s.CCLYConst.once.RoomBet;var t=this.userConvertSeatId(e.userId);o.once.GameLayer.EffectLayer.addEffect({seatId:t,award:e.bonus,skillId:s.CCLYEffectType.Bill})}},t.prototype.rechargeAllResult=function(e){var t=this.userConvertSeatId(e.userId);s.CCLYConst.once.users[t].score=e.score,s.CCLYConst.once.users[t].wins=e.wins,e.userId==s.CCLYConst.once.userId&&(this.GameLayer.showRecharge(!0),s.CCLYConst.once.Entries=e.score,s.CCLYConst.once.Winning=e.wins),this.GameLayer.updateBalance(e.userId,e.score),this.GameLayer.updateDiamond(e.userId,e.wins)},t.prototype.CmdCCLYLord=function(e){cc.log("CmdCCLYLord: "+JSON.stringify(e));var t=this.userConvertIndex(e.userId);this.GameLayer.EffectLayer.addEffect({skillId:s.CCLYEffectType.Double,index:t,left:30})},t.prototype.CmdCCLYSmallBomb=function(e){cc.log("CmdCCLYSmallBomb: "+JSON.stringify(e)),o.once.GameLayer.EffectLayer.addEffect({seatId:e.seatId,award:e.award,skillId:s.CCLYEffectType.Bill,fid:e.fid,bombId:e.bombId});var t=200*s.CCLYConst.once.winScale.x,n=this.inCircleFishs(e.p,t);e.seatId===s.CCLYConst.once.seatId&&n.fishId.length>0&&(cc.log("inCircleFishs:"+JSON.stringify(n.fishId)),this.requestShotTarget(n.fishId,e.bulletId,3))},t.prototype.CmdCCLYBigBomb=function(e){cc.log("CmdCCLYBigBomb: "+JSON.stringify(e));var t=e.position;if(this.GameLayer.EffectLayer.addEffect({skillId:s.CCLYEffectType.BigBoom,position:t}),this.GameLayer.EffectLayer.addEffect({skillId:s.CCLYEffectType.BigBoomYanHua,position:t}),e.seatId===s.CCLYConst.once.seatId){var o=this.getBoomFishs();cc.log("getBoomFishs:"+JSON.stringify(o)),o.length>0&&this.requestShotTarget(o,e.bombId,3)}},t.prototype.CmdZZBoom=function(e){if(e.param.seatId===s.CCLYConst.once.seatId){var t=400*s.CCLYConst.once.winScale.x,o=this.inCircleFishs(e.node.convertToWorldSpaceAR(cc.v2(0,0)),t);o.fishId.length>0&&(cc.log("inCircleFishs:"+JSON.stringify(o.fishId)),this.requestShotTarget(o.fishId,e.param.bulletId,5)),d.default.once.send("broadcast",{bombId:e.param.bulletId,position:e.node.position,seatId:e.param.seatId})}},t.prototype.broadcast=function(e){if(e&&e.userdata){e=JSON.parse(e.userdata);var t=o.once.GameLayer.findZZBoomEffect(e.seatId,e.bombId);t&&t.zzBoom();var n=this.GameLayer.getUserByTable(e.seatId);n&&n.showZZ(!1)}},t.prototype.CmdBYFishSeatChange=function(e,t){t&&(t.userId=t.UserId),s.CCLYConst.once.users[e]=t,this.GameLayer.refreshTable(t)},t.prototype.CmdBYCannonChange=function(e){if(cc.log("CmdBYCannonChange: "+JSON.stringify(e)+",cg:"+typeof e),"string"==typeof e&&(e=JSON.parse(e)),e.userid==s.CCLYConst.once.userId)for(var t=0;t<s.CCLYConst.once.BLevels.length;t++)if(e.bet==s.CCLYConst.once.BLevels[t]){s.CCLYConst.once.BLevel=t;break}this.GameLayer.WeaponLayer.setWeaponGold(e.userid,e.bet),this.GameLayer.WeaponLayer.setLevelByUID(e.userid,e.bet)},t.prototype.CmdBYTable=function(e){var t=e.ResultData;s.CCLYConst.once.seatId=t.seatId,s.CCLYConst.once.userId=s.CCLYConst.once.PlayerInfo.playerId,s.CCLYConst.once.users={};for(var n=0;n<t.userList.length;n++){var i=t.userList[n];s.CCLYConst.once.users[i.seatId]=i,i.userId==s.CCLYConst.once.userId&&(s.CCLYConst.once.Entries=i.score,s.CCLYConst.once.diamond=i.wins)}s.CCLYConst.once.PlayerInfo.gameDisconnect=!1,s.CCLYConst.once.PlayerInfo.gameName="CCLYFish",s.CCLYConst.once.TableId=e.change_scene_type%3||0,o.once.checkSelfTableIndex(),this.GameLayer.changeSceneBg(s.CCLYConst.once.TableId,!1,s.CCLYConst.once.TableId),this.GameLayer.clearTableFishs(),this.GameLayer.refreshTable(!1),this.GameLayer&&this.GameLayer.EffectLayer&&this.GameLayer.WeaponLayer.LastFireTime<-999998&&(this.GameLayer.WeaponLayer.LastFireTime=-91),this.sendChangeScene()},t.prototype.sendChangeScene=function(){d.default.once.send("changeScene",{})},t.prototype.CmdByStageChange=function(e){var t={now:s.CCLYConst.once.TableId,anim:!0,later:e.change_scene_type,skillId:s.CCLYEffectType.Fast};this.GameLayer.EffectLayer.addEffect(t),s.CCLYConst.once.TableId=e.change_scene_type,cc.log("CmdByStageChange:"+JSON.stringify(e))},t.prototype.ShotSelfBullet=function(e){this.GameLayer&&this.GameLayer.WeaponLayer&&(e.balance=parseInt(e.bet)*s.CCLYConst.once.RoomBet,e.uid=e.userid=s.CCLYConst.once.userId,s.CCLYConst.once.BulletCount++,this.GameLayer.WeaponLayer.LastFireTime=0,e.seatId=this.userConvertSeatId(e.userid),e.touch=this.decodePoint(e.position),this.GameLayer.WeaponLayer.showWeapon(e))},t.prototype.CmdBYShot=function(e){if(this.GameLayer&&this.GameLayer.WeaponLayer){if(e.balance=parseInt(e.bet)*s.CCLYConst.once.RoomBet,e.uid=e.userid,e.seatId=this.userConvertSeatId(e.userid),e.userid==s.CCLYConst.once.userId)s.CCLYConst.once.Entries-=e.balance;else{if(e.fishId){var t=this.getFishByFishId(e.fishId);t instanceof r.default&&this.CmdBYLockFish(t,e.seatId)}else this.CmdBYUnlockFish(e.seatId);e.touch=this.decodePoint(e.position),this.GameLayer.WeaponLayer.showWeapon(e)}s.CCLYConst.once.users[e.seatId]&&(s.CCLYConst.once.users[e.seatId].score-=e.balance,this.GameLayer.updateBalance(e.userid,s.CCLYConst.once.users[e.seatId].score))}},t.prototype.CmdBYShotFish=function(e){var t=this.getAllFishByFishId(e.fishId),n=t[0],i=this.getTableByUID(e.userId);if(e.hitSocre*=s.CCLYConst.once.RoomBet,i&&n instanceof r.default){for(var a=parseInt(n.config.Skill),c={fishId:e.fishId,userId:e.userId,seatId:i.seatId,award:e.hitSocre,bomb:e.bomb,fid:n.fid,ScoreEffect:n.config.ScoreEffect,position:n.node.position,SettleType:n.config.SettleType,point:n.node.convertToWorldSpaceAR(cc.v2(0,0)),bombId:e.bombId,bulletId:e.bombId,fishType:n.config.fishType},d=0;d<t.length;d++){var h=t[d];h.goDie(),4!=e.butype&&5!=e.butype&&h.playDieAni(),5==e.butype&&(h.dieCD=2)}if(console.log("HitResult fish.config: "+JSON.stringify(n.config)),console.log("HitResult result: "+JSON.stringify(e)),a==s.CCLYEffectType.BigBoom&&this.CmdCCLYBigBomb(c),a==s.CCLYEffectType.Ice&&this.GameLayer.EffectLayer.addEffect({seatId:i.seatId,skillId:s.CCLYEffectType.Ice,position:c.position}),a==s.CCLYEffectType.TLBoom&&this.GameLayer.EffectLayer.addEffect({seatId:i.seatId,skillId:s.CCLYEffectType.TLBoom,position:c.position,angle:n.node.angle,bulletId:e.bombId}),a==s.CCLYEffectType.WGBoom&&this.GameLayer.EffectLayer.addEffect({seatId:i.seatId,skillId:s.CCLYEffectType.WGBoom,position:c.position,angle:n.node.angle,bulletId:e.bombId,fid:n.fid,bombId:e.bombId,award:c.award}),a==s.CCLYEffectType.XZBoom&&this.cmdXZBoom({seatId:i.seatId,skillId:s.CCLYEffectType.XZBoom,position:c.position,count:0,bulletId:e.bombId,fid:n.fid,bombId:e.bombId,award:c.award}),a==s.CCLYEffectType.ZZBoom&&this.GameLayer.EffectLayer.addEffect({seatId:i.seatId,skillId:s.CCLYEffectType.ZZBoom,position:c.position,bulletId:e.bombId,fid:n.fid,bombId:e.bombId,award:c.award,angle:n.node.angle}),4==e.butype){var f=e.sendFishs.indexOf(e.fishId),u=this.getFishByFishId(c.fishId),C=p.default.deepCopy(c);C.to=u.node.position,C.coinPosition=u.node.position,C.position=e.from,C.skillId=s.CCLYEffectType.XZBoom,C.delay=.2*f+1,C.sumTime=.2*e.sendFishs.length+1,this.GameLayer.EffectLayer.addEffect(C)}-1==[0,s.CCLYEffectType.WGBoom].indexOf(a)&&o.once.GameLayer.EffectLayer.addEffect({seatId:c.seatId,award:c.award,skillId:s.CCLYEffectType.Bill,fid:n.fid,bombId:e.bombId}),4!=e.butype&&(cc.log("paramparam",c),this.addResultCoin(c))}i&&s.CCLYConst.once.users[i.seatId]&&-1!=[0,1,2,6,7].indexOf(e.butype)&&(s.CCLYConst.once.PlayerInfo.useOneScore?(s.CCLYConst.once.users[i.seatId].score+=e.hitSocre,s.CCLYConst.once.Entries=s.CCLYConst.once.users[i.seatId].score,this.GameLayer.updateDiamond(i.userId,s.CCLYConst.once.users[i.seatId].score),this.GameLayer.updateBalance(i.userId,s.CCLYConst.once.users[i.seatId].score)):(s.CCLYConst.once.users[i.seatId].wins+=e.hitSocre,this.GameLayer.updateDiamond(i.userId,s.CCLYConst.once.users[i.seatId].wins)));var y=this.getBulletByBulletId(e.bombId);y instanceof l.default&&!y.isDrill&&this.GameLayer.despawnBullet(y)},t.prototype.addResultCoin=function(e){this.addSFX(e),this.showCoin(e),o.once.GameLayer.EffectLayer.addEffect({seatId:e.seatId,award:e.award,skillId:s.CCLYEffectType.SamllBill,fid:e.fid})},t.prototype.getBoomFishs=function(){for(var e=[],t=this.GameLayer.getFishs(),o=0;o<t.length;o++){var n=t[o];if(n.alive&&n.fid<11&&0==parseInt(n.config.Skill)&&(e.push(n.fishId),e.length>13))break}return e},t.prototype.cmdXZBoom=function(e){if(s.CCLYConst.once.seatId==e.seatId){var t=this.getBoomFishs();t.length>0&&this.requestShotTarget(t,e.bulletId,4,null,!1,e.position)}},t.prototype.createFish=function(e){var t=this.getFishConfig(e.fishType);if(e.fishes=e.fishes||[e.fishType],t){var n=p.default.generateMixed(20),i=e.fishPath%s.CCLYConst.once.FishPath.length,a=this.getFishPathByID(s.CCLYConst.once.FishPath[i].id),c=this.convertToGid(e.fishes.length),r=o.once.getFishPoints(t.FishID);t.fishType=e.fishType,t.propFish=e.propFish;for(var l=0;l<e.fishes.length;l++){var d={groupUuid:n,groupId:c,fid:e.fishes[l],fishId:e.fishId[0],config:t,index:l,skillId:"",FishPath:a,pathInterval:a.time,swimmingInterval:0,compensate:0,conlliderPoints:r};this.GameLayer.refreshFish(d)}}else cc.log("\u627e\u4e0d\u5230\u9c7c\u8be6\u60c5group.fishType---\x3e"+e.fishType)},t.prototype.convertToGid=function(e){for(var t=0;t<s.CCLYConst.once.FishGroups.length;t++){var o=s.CCLYConst.once.FishGroups[t];if(o.num==e)return o.id}return null},t.prototype.CmdBYLockFish=function(e,t){void 0===t&&(t=s.CCLYConst.once.seatId),e instanceof r.default&&e.pushLockSeat(t)&&(this.GameLayer.WeaponLayer.setLockFishByTid(t,e),t==s.CCLYConst.once.seatId&&this.playSFX("lock")),e instanceof r.default&&this.GameLayer.showUserLock(t,e.fid)},t.prototype.CmdBYUnlockFish=function(e){void 0===e&&(e=s.CCLYConst.once.seatId),this.GameLayer.WeaponLayer.setLockFishByTid(e),this.GameLayer.UnLockFishNtfType(e)},t.prototype.addSFX=function(e){if(e&&e.seatId===s.CCLYConst.once.seatId){var t="die_small";Math.floor(e.fid)>9&&(t="die"),Math.floor(e.fid)>19&&(t="die_big"),this.playSFX(t)}},t.prototype.getFishPathByID=function(e){for(var t=s.CCLYConst.once.FishPath,o=""+e||"1001",n=0;n<t.length;n++){var i=t[n];if(i.id===o){var a=i;return a.scale=1,a.points[0].x-a.points[a.points.length-1].x>0&&(a.scale=-1),a}}return null},t.prototype.getFishLayerIndex=function(e){for(var t=parseInt(e),o=[[1,2,3,4,5,6,7,10,11,12,13,14],[21],[19],[20],[18],[15,16],[17]],n=0;n<o.length;n++)if(-1!=o[n].indexOf(t))return n;return 0},t.prototype.getFishConfig=function(e){for(var t=0;t<s.CCLYConst.once.FishConfigs.length;t++)if(""+s.CCLYConst.once.FishConfigs[t].FishID==""+e)return p.default.deepCopy(s.CCLYConst.once.FishConfigs[t]);return null},t.prototype.getFishPoints=function(e){return s.CCLYConst.once.FishPoints[e]},t.prototype.getFishGroups=function(e){for(var t=0;t<s.CCLYConst.once.FishGroups.length;t++)if(""+s.CCLYConst.once.FishGroups[t].id==""+e)return s.CCLYConst.once.FishGroups[t];return null},t.prototype.getEffectByType=function(e){return s.CCLYConst.once.MapEffects.get(""+e)},t.prototype.getAtlasByType=function(e){return s.CCLYConst.once.MapAtlas.get(""+e)},t.prototype.getDeathAnimateByID=function(e){var t=s.CCLYConst.once.MapDieanis.get(""+e);if(!t)throw new Error("\u627e\u4e0d\u5230\u8be5\u9c7cID\u7684\u6b7b\u4ea1\u52a8\u753b");return t},t.prototype.getSwimAnimateByID=function(e){return s.CCLYConst.once.MapSwims.get(""+e)},t.prototype.initData=function(){cc.sys.isMobile?window.addEventListener("resize",this.onResized.bind(this)):cc.view.on("canvas-resize",this.onResized,this),this.onResized()},t.prototype.checkCompensate=function(e){var t=e.clientTime||Date.now(),o=void 0===e.seatId?s.CCLYConst.once.seatId:e.seatId,n=e.cToS?e.serverTime-t:t-e.serverTime,i=s.CCLYConst.once.MapCompensate.get(o);i||(i=e.cToS?n:-n,s.CCLYConst.once.MapCompensate.set(o,i));var a=e.cToS?n-i:n+i;return a<=0&&(i=e.cToS?i+a:i-a,s.CCLYConst.once.MapCompensate.set(o,i),a=0),a},t.prototype.convertPositionAngle=function(e){var t=cc.view.getVisibleSize(),o=t.width/2,n=t.height/2,i=e.x>o||e.x<-o,a=i?Math.abs(e.x)-o:0,s=e.y>n||e.y<-n?Math.abs(e.y)-n:0,c=i?360:180;return e.y>n&&(s=-s),e.x>o&&(a=-a),{out:a||s,x:a,y:s,jd:c,angle:c-e.angle}},t.prototype.calculateSpacePoint=function(e){var t=e.xySpeed,o=cc.view.getVisibleSize();if(void 0===e.xySpeed){var n=o.width*e.speed.x*e.space,i=o.height*e.speed.y*e.space;t=Math.sqrt(n*n+i*i)}var a=t*Math.sin(e.angle/180*Math.PI),s=t*Math.cos(e.angle/180*Math.PI);return cc.v2(a,s)},t.prototype.calculateNextBorderPoint=function(e){var t=cc.v2(e.point.x,e.point.y),o=cc.view.getVisibleSize(),n=Math.sin(e.angle/180*Math.PI),i=Math.cos(e.angle/180*Math.PI),a=n>0?o.width/2-t.x:-o.width/2-t.x,s=i>0?o.height/2-t.y:-o.height/2-t.y,c=e.speed.x*n,r=e.speed.y*i,l=Math.abs(a/c),p=Math.abs(s/r),d=Math.min(l,p);return t.x+=c*d,t.y+=r*d,{point:t,time:d}},t.prototype.inCircle=function(e,t,o){return cc.v2(e.x,e.y).sub(cc.v2(t.x,t.y)).mag()<=o},t.prototype.onResized=function(){s.CCLYConst.once.winScale=this.convertWindowScale()},t.prototype.checkSelfTableIndex=function(){for(var e in s.CCLYConst.once.users){var t=s.CCLYConst.once.users[e];t&&t.userId===s.CCLYConst.once.userId&&(s.CCLYConst.once.seatId=parseInt(t.seatId))}},t.prototype.getUser=function(e){void 0===e&&(e=404);var t=null;for(var o in 404==e&&(e=s.CCLYConst.once.seatId),s.CCLYConst.once.users){var n=s.CCLYConst.once.users[o];n&&n.seatId===e&&(t=n)}return t},t.prototype.flipWeaponY=function(e){return Math.max(s.CCLYConst.once.seatId,e)>1&&Math.min(s.CCLYConst.once.seatId,e)<=1},t.prototype.userConvertIndex=function(e){return this.tableConvertIndex(this.userConvertSeatId(e))},t.prototype.userConvertSeatId=function(e){var t=this.getTableByUID(e);return t?t.seatId:-1},t.prototype.tableConvertIndex=function(e){void 0===e&&(e=-1);var t=e>-1?e:s.CCLYConst.once.seatId;return s.CCLYConst.once.seatId>1&&(t=t>1?t-2:t+2),t},t.prototype.getTableByUID=function(e,t){var o=e||s.CCLYConst.once.userId;for(var n in s.CCLYConst.once.users){var i=s.CCLYConst.once.users[n];if(i&&""+i.userId==""+o)return t instanceof Function&&t(i),i}},t.prototype.showCoin=function(e){var t=p.default.deepCopy(e);if(t.self=e.seatId===s.CCLYConst.once.seatId,t.index=this.tableConvertIndex(e.seatId),parseFloat(e.award)>0){for(var o=0;o<1;o++){var n=p.default.deepCopy(t);n.i=o,this.GameLayer.addCoin(n)}this.showCoinLbAction(t)}},t.prototype.showCoinLbAction=function(e){var t=this;if(e.award&&parseFloat(e.award)>0){var o=this.GameLayer.addCoinLb(e);if(o instanceof cc.Node){o.opacity=255;var n=cc.spawn(cc.moveTo(.5,cc.v2(o.x,o.y+50)),cc.fadeIn(.3)),i=cc.spawn(cc.moveTo(1,cc.v2(o.x,o.y+100)).easing(cc.easeIn(3)),cc.fadeOut(1));o.runAction(cc.sequence(n,i,cc.callFunc(function(){t.GameLayer.despawnCoinLb(o)})))}}},t.prototype.checkLimitBorder=function(e){var t=cc.view.getVisibleSize(),o=e.x>=-t.width/2&&e.x<=t.width/2,n=e.y>=-t.height/2&&e.y<=t.height/2;return o&&n},t.prototype.inCircleFishs=function(e,t){void 0===t&&(t=100);for(var o=[],n=this.GameLayer.getFishs(),i=[],a=0;a<n.length;a++){var s=n[a],c=s.node.convertToNodeSpaceAR(cc.v2(e.x,e.y));if(s.alive)for(var r=0;r<s.colliders.length;r++){var l=s.colliders[r];if(s.fid<11&&this.inCircle(l,c,t)){if(s.beAttack(),!s.fishId){cc.log("f.fishId;;;;;");break}i.push(s),o.push(s.fishId);break}}}return{fishId:o,fish:i}},t.prototype.getMaxFish=function(){for(var e=this.GameLayer.getFishs(),t=null,o=e.length-1;o>=0;o--){var n=e[o],i=this.checkLimitBorder(n.node);if(n.alive&&i)if(t instanceof r.default){var a=parseFloat(n.config.Type),s=parseFloat(t.config.Type);4===a&&(a=6),4===s&&(s=6),a>s&&(t=n)}else t=n}return t},t.prototype.setLimitFire=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1),this.GameLayer.WeaponLayer.setTimelimit(e),t&&s.CCLYConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(!1)},t.prototype.onTouchWindow=function(e,t){if(this.GameLayer.WeaponLayer.timeLimit){this.GameLayer.WeaponLayer.setClickLimit(!1);var o=this.GameLayer.WeaponLayer.balanceLimit;this.setLimitFire(s.CCLYConst.once.FightLimit,!o),this.requestFishFire(e,t)}},t.prototype.showLockLineByTid=function(e,t){for(var o=0;o<t.length;o++){var n=t[o];this.GameLayer.WeaponLayer.showLockLineByTid(n,e)}},t.prototype.getFishByFishId=function(e){for(var t=this.GameLayer.getFishs(),o=0;o<t.length;o++){var n=t[o];if(e===n.fishId)return n}return null},t.prototype.getAllFishByFishId=function(e){for(var t=[],o=this.GameLayer.getFishs(),n=0;n<o.length;n++){var i=o[n];e===i.fishId&&t.push(i)}return t},t.prototype.getBulletByBulletId=function(e){for(var t=this.GameLayer.getBullets(),o=0;o<t.length;o++){var n=t[o];if(e===n.bulletId)return n}return null},t.prototype.removeEvents=function(){cc.sys.isMobile?window.removeEventListener("resize",this.onResized.bind(this)):cc.view.off("canvas-resize",this.onResized,this),this.unscheduleAllCallbacks()},t.prototype.getFrameByName=function(e){var t=null;return s.CCLYConst.once.MapAtlas.forEach(function(o){var n=o.getSpriteFrame(e);n&&(t=n)}),t},t.prototype.cheekVectorOrTimeIndex=function(e,t,o){for(var n=0,i=[],a=1;a<e.length;a++){var s=100;if(!o){var c=e[a-1],r=e[a];s=Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2),s=Math.sqrt(s)}i.push(s),n+=s}var l=0,p=0;for(a=0;a<i.length;a++){p=a+1;var d=n*t,h=l+(s=i[a]);if(l<d&&d<=h)return{index:p,f:1-(h-d)/s};l=h}return null},t.prototype.makeBreakBezier2=function(e,t,o){if(t&&t.length){if(e<=0)return t[0];if(e>=1)return t[t.length-1];for(var n=0,i=this.cheekVectorOrTimeIndex(t,e,!0),a=[t[i.index-1],o[i.index-1],t[i.index]];n<1e3;){n++;for(var s=a.length-1,c=0;c<s;c++)if(a[c]=this.convertVectorToPoint(a[c],a[c+1],i.f),c===s-1&&(a.splice(s,a.length),1===a.length))return a[0]}}},t.prototype.convertVectorToPoint=function(e,t,o){return cc.v2(e.x+-(e.x-t.x)*o,e.y+-(e.y-t.y)*o)},t.prototype.convertPointToAngle=function(e,t){var o=0,n=e.y-t.y,i=e.x-t.x;return 0===i?o=n>0?-90:90:(i<0&&n>0&&(o=180-180*Math.atan(n/i)/Math.PI),i<0&&n<0&&(o=180-180*Math.atan(n/i)/Math.PI),i>0&&n>0&&(o=270+180*Math.atan(i/n)/Math.PI),i>0&&n<0&&(o=90+180*Math.atan(i/n)/Math.PI)),o},t.prototype.convertWindowsizePath=function(e){for(var t=e,o=this.convertWindowScale(),n=0;n<t.length;n++){for(var i=0;i<t[n].points.length;i++)t[n].points[i].x*=o.x,t[n].points[i].y*=o.y;for(i=0;i<t[n].controls.length;i++)t[n].controls[i].x*=o.x,t[n].controls[i].y*=o.y}return t},t.prototype.convertWindowScale=function(){var e=cc.view.getVisibleSize(),t=e.width/1334,o=e.height/750;return cc.v2(t,o)},t.prototype.addBill=function(e){if(e&&this.GameLayer&&this.GameLayer.EffectLayer&&cc.isValid(this.GameLayer.node)&&Math.floor(e.SettleType)>=0){var t=(""+e.SettleType).split(""),o=e.seatId===s.CCLYConst.once.seatId,n=e.award;-1!==["1","0"].indexOf(t[0])&&-1!==["1","0"].indexOf(t[1])&&(t=o?[1]:[0]);for(var i=Math.floor(e.fid),a=0;a<t.length;a++){var c=Math.floor(t[a]),r=c;this.GameLayer.EffectLayer.addEffect({seatId:e.seatId,skillId:s.CCLYEffectType.Bill,type:c,fid:i,award:n,limit:r,number:e.number})}}},t.prototype.codePoint=function(e){return e||(e=cc.v2(0,0)),{x:1*e.x/s.CCLYConst.once.winScale.x,y:1*e.y/s.CCLYConst.once.winScale.y}},t.prototype.decodePoint=function(e){return e||(e=cc.v2(0,0)),{x:1*e.x*s.CCLYConst.once.winScale.x,y:1*e.y*s.CCLYConst.once.winScale.y}},t.prototype.playBGM=function(e,t){void 0===t&&(t=!0),e=e||this.MusicDic[404],t&&(this.MusicDic[404]=e),this.play(e,!0,!0)},t.prototype.stopBGM=function(){cc.audioEngine.stopAll()},t.prototype.playSFX=function(e){this.play(e,!1,!1)},t.prototype.stopSFX=function(e){this.MusicDic[e]&&cc.audioEngine.stop(this.MusicDic[e])},t.prototype.play=function(e,t,o){void 0===o&&(o=!1);var n=this.GameLayer.LoadingLayer[e];n&&(this.MusicDic[e]=o?cc.audioEngine.playMusic(n,t):cc.audioEngine.playEffect(n,t))},a([u(c.default)],t.prototype,"GameLayer",void 0),o=a([f],t)}(cc.Component);o.default=C,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYBullet":"CCLYBullet","./CCLYConst":"CCLYConst","./CCLYFish":"CCLYFish","./CCLYNetWork":"CCLYNetWork","./CCLYScene":"CCLYScene"}],CCLYMenu:[function(e,t,o){"use strict";cc._RF.push(t,"ce922TCnp5GVL5x/uKoPXFn","CCLYMenu");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=e("./CCLYNetWork"),l=cc._decorator,p=l.ccclass,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LayerNetError=null,t.LayerRule=null,t.sp_setup=null,t.an_auto=null,t.an_lock=null,t._mune=!1,t}return i(t,e),t.prototype.onLoad=function(){this._index=0,this.node.width=cc.winSize.width>1334?1334:cc.winSize.width,this.btn_auto=this.node.getChildByName("btn_auto"),this.btn_lock=this.node.getChildByName("btn_lock"),this.btn_jiasu=this.node.getChildByName("btn_jiasu"),this.btn_auto.on("click",this.onClickedAuto,this),this.btn_lock.on("click",this.onClickedLock,this),this.btn_jiasu.on("click",this.onClickedJiasu,this),this.node.getChildByName("btn_bill").on("click",this.onClickedBill,this),this.layer_mune=this.node.getChildByName("layer_mune"),cc.find("layer_mune/btn_back",this.node).on("click",this.onClickedBack,this),cc.find("layer_mune/btn_setup",this.node).on("click",this.onClickedSetup,this),cc.find("layer_mune/btn_rule",this.node).on("click",this.onClickedRule,this),this.btn_show=cc.find("layer_mune/btn_show/sp",this.node).getComponent(cc.Sprite),this.btn_show.node.parent.on("click",this.onClickedShow,this),cc.game.on(cc.game.EVENT_HIDE,this.onHide,this);var e=cc.sys.localStorage.getItem("CCLY_AudioVolume");this.setAudioVolume(null==e||e>0)},t.prototype.onHide=function(){console.log("\u6e38\u620f\u8fdb\u5165\u540e\u53f0"),s.CCLYConst.once.IsAuto&&this.onClickedAuto()},t.prototype.onResized=function(){},t.prototype.onClickedSetup=function(){c.default.once.playSFX("click"),cc.audioEngine.getMusicVolume()>0?this.setAudioVolume(!1):this.setAudioVolume(!0)},t.prototype.setAudioVolume=function(e){e?(this.sp_setup.spriteFrame=s.CCLYConst.once.UIAtals.getSpriteFrame("volume"),cc.audioEngine.setMusicVolume(1),cc.audioEngine.setEffectsVolume(1),cc.sys.localStorage.setItem("CCLY_AudioVolume",1)):(this.sp_setup.spriteFrame=s.CCLYConst.once.UIAtals.getSpriteFrame("mute"),cc.audioEngine.setMusicVolume(0),cc.audioEngine.setEffectsVolume(0),cc.sys.localStorage.setItem("CCLY_AudioVolume",0))},t.prototype.onClickedRule=function(){this.LayerRule.active=!this.LayerRule.active},t.prototype.onClickedShow=function(){c.default.once.playSFX("click"),this._mune=!this._mune,this.btn_show.spriteFrame=c.default.once.getFrameByName(this._mune?"fold":"spread");for(var e=[],t=0;t<3;t++)e[t]=cc.find("layer_mune/"+["btn_back","btn_setup","btn_rule"][t],this.node),e[t].stopAllActions(),e[t].active=this._mune,e[t].opacity=0,e[t].scale=1;if(this._mune)for(t=0;t<e.length;t++)e[t].runAction(cc.sequence(cc.delayTime(.1*t),cc.spawn(cc.sequence(cc.scaleTo(.05,1.2),cc.scaleTo(.05,1)),cc.fadeIn(.1))))},t.prototype.onclickedLeave=function(){r.default.once.levea()},t.prototype.onClickedBack=function(){c.default.once.playSFX("click"),c.default.once.requestLeaveRoom()},t.prototype.onClickedBill=function(){c.default.once.GameLayer.EffectLayer.addEffect({seatId:s.CCLYConst.once.seatId,skillId:s.CCLYEffectType.ZZBoom,position:cc.v2(0,0),angle:45,bulletId:"324325435",fid:21,bombId:"324325435",award:233})},t.prototype.onClickCloseRule=function(){c.default.once.playSFX("click"),this.LayerRule.active=!1},t.prototype.onClickedAuto=function(e){void 0===e&&(e=!0),e&&c.default.once.playSFX("click"),s.CCLYConst.once.IsAuto=!s.CCLYConst.once.IsAuto,s.CCLYConst.once.IsAuto?(this.an_auto.play("auto_"),this.btn_auto.opacity=255):(this.an_auto.stop(),this.btn_auto.opacity=200)},t.prototype.onClickedJiasu=function(e){void 0===e&&(e=!0),e&&c.default.once.playSFX("click"),s.CCLYConst.once.AutoLimit==s.CCLYFireSpeed.Speed0?(s.CCLYConst.once.AutoLimit=s.CCLYFireSpeed.Speed1,s.CCLYConst.once.FightLimit=s.CCLYFireSpeed.Speed1):(s.CCLYConst.once.AutoLimit=s.CCLYFireSpeed.Speed0,s.CCLYConst.once.FightLimit=s.CCLYFireSpeed.Speed0),this.btn_jiasu.opacity=s.CCLYConst.once.AutoLimit==s.CCLYFireSpeed.Speed1?255:200},t.prototype.onClickedLock=function(){c.default.once.playSFX("click"),s.CCLYConst.once.IsLock=!s.CCLYConst.once.IsLock,s.CCLYConst.once.IsLock?this.btn_lock.opacity=255:(c.default.once.CmdBYUnlockFish(),this.btn_lock.opacity=200)},t.prototype.onDestroy=function(){cc.game.off(cc.game.EVENT_HIDE,this.onHide,this)},a([d(cc.Node)],t.prototype,"LayerNetError",void 0),a([d(cc.Node)],t.prototype,"LayerRule",void 0),a([d(cc.Sprite)],t.prototype,"sp_setup",void 0),a([d(cc.Animation)],t.prototype,"an_auto",void 0),a([d(cc.Animation)],t.prototype,"an_lock",void 0),a([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager","./CCLYNetWork":"CCLYNetWork"}],CCLYNetWork:[function(e,t,o){"use strict";cc._RF.push(t,"49ddcyBgRdJI7l8BaIo4ng8","CCLYNetWork");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return i(t,e),o=t,t.prototype.onLoad=function(){o.once=this,GameConfig.SubGameMgr.subGameNet=this,this.send("loginGame",{})},t.prototype.start=function(){},t.prototype.send=function(e,t){void 0===t&&(t={}),window.sendNetWorkData&&(console.log("send cmd:"+e+",data:",t),window.sendNetWorkData(e,"string"==typeof t?t:JSON.stringify(t)))},t.prototype.requestLeaveRoom=function(){this.levea()},t.prototype.tryLeave=function(){this.levea()},t.prototype.levea=function(){Common.backHall("Are you sure you want to leave the game?",function(){})},t.prototype.addNetEvent=function(e,t){if("loginGameResult"==e){var o=this.changeResultJSON_Function(t);console.log("\u6e38\u620f\u767b\u9646\u6210\u529f======================="+JSON.stringify(o)),o.resultid?(s.CCLYConst.once.RoomBet=o.Obj.bet,s.CCLYConst.once.PlayerInfo.win_pool=o.Obj.winPool,s.CCLYConst.once.PlayerInfo.playerDiamond=o.Obj.wins,s.CCLYConst.once.PlayerInfo.playerId=o.Obj.id,s.CCLYConst.once.Entries=o.Obj.score,this.send("LoginRoom",{roomid:1})):this.tryLeave()}if("LoginRoomResult"==e&&(t=this.changeResultJSON_Function(t),cc.log("LoginRoomResult",t),t.ResultCode)){cc.log("LoginRoomResult------------------\x3e"+JSON.stringify(t)),s.CCLYConst.once.BLevels=t.ResultData.betList,c.default.once.CmdBYTable(t);for(var n=t.ResultData.userList,i=0;i<n.length;i++)c.default.once.CmdBYCannonChange(n[i])}if("HitResult"==e&&(o=this.changeResultJSON_Function(t),console.log("HitResult: ",o),1==o.ResultCode&&(4==o.hitInfo.bulletType&&(o.ResultData.from=o.hitInfo.from,o.ResultData.sendFishs=o.hitInfo.fishId,o.ResultData.butype=o.hitInfo.bulletType),c.default.once.CmdBYShotFish(o.ResultData))),"FishOut"==e&&(o=this.changeResultJSON_Function(t),c.default.once.createFish(o)),"fishShoot"==e&&(o=this.changeResultJSON_Function(t),c.default.once.CmdBYShot(o)),"getDownTimeResult"==e&&(o=this.changeResultJSON_Function(t),console.log("getDownTimeResult======================="+JSON.stringify(o))),"doubleEnd"==e&&(o=this.changeResultJSON_Function(t),c.default.once.CmdCCLYLordSettle(o)),"chargeAllResult"==e&&(o=this.changeResultJSON_Function(t),console.log("chargeAllResult",o),c.default.once.rechargeAllResult(o)),"playEnter"==e&&(o=this.changeResultJSON_Function(t)).ResultCode&&(cc.log("playEnter:"+JSON.stringify(t)),c.default.once.CmdBYFishSeatChange(o.ResultData.seatId,o.ResultData)),"broadcast"==e){o=this.changeResultJSON_Function(t);cc.log("broadcast:"+JSON.stringify(t)),c.default.once.broadcast(o)}if("PlayerOut"==e&&(o=this.changeResultJSON_Function(t),cc.log("PlayerOut:"+JSON.stringify(t)),c.default.once.CmdBYFishSeatChange(o.PlayerSeatId,null)),"changePowerResult"==e&&(o=this.changeResultJSON_Function(t),cc.log("changePowerResult :"+JSON.stringify(o)),c.default.once.CmdBYCannonChange(o)),"useSkillResult"==e&&(o=this.changeResultJSON_Function(t),console.log("useSkillResult",o)),"fishHit_boardResult"==e){var a=this.changeResultJSON_Function(t);a.uid==s.CCLYConst.once.PlayerInfo.playerId&&this.send("fishHit",a)}"fishSceneChange"==e&&(o=this.changeResultJSON_Function(t))&&(cc.log("fishSceneChange:"+JSON.stringify(t)),o.change_scene_type%=3,c.default.once.CmdByStageChange(o)),"disconnect"==e&&this.tryLeave()},t.prototype.changeResultJSON_Function=function(e){return JSON.parse(e)},t.prototype.onDestroy=function(){o.once=null},o=a([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYScene:[function(e,t,o){"use strict";cc._RF.push(t,"da480yOYBpByJaRYtq3d3xN","CCLYScene");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=e("./CCLYEffect"),l=e("./CCLYMenu"),p=e("./CCLYCoin"),d=e("./CCLYBullet"),h=e("./CCLYFish"),f=e("./CCLYFishNet"),u=e("./CCLYWeapon"),C=e("./CCLYEffectLayer"),y=e("./CCLYBill"),g=e("./CCLYUser"),_=e("./CCLYLoading"),L=e("../../../Script/utils/Utils"),m=cc._decorator,v=m.ccclass,I=m.property,Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LoadingLayer=null,t.MenuLayer=null,t.WeaponLayer=null,t.EffectLayer=null,t.RechargeLayer=null,t.RouteParent=null,t.FishParent=null,t.BulletParent=null,t.GoldParent=null,t.GoldLabelParent=null,t.NetParent=null,t.EffectSKParent=null,t.EffectParent=null,t.arr_fishs=[],t.arr_bullets=[],t.arr_effect=[],t.arr_coin=[],t.arr_seats=[],t}return i(t,e),t.prototype.onLoad=function(){this.LoadingLayer.loadFinish(),c.default.once.GameLayer=this,this.initView(),this.EffectLayer.defaultLight(this.node),c.default.once.initData(),this.loadFinish()},t.prototype.changeGold=function(e){return(parseFloat(e)/s.CCLYConst.once.PlayerInfo.exchangeRate).toFixed(2)},t.prototype.loadFinish=function(){this.initData();for(var e=0;e<this.arr_seats.length;e++)this.arr_seats[e].initUI(),this.arr_seats[e].cleanInfo();this.WeaponLayer.init()},t.prototype.initData=function(){this.arr_fishs=[],this.arr_bullets=[],this.arr_effect=[],this.arr_coin=[];var e=cc.find("layer_load/pr_net",this.node);e.addComponent(f.default);var t=cc.find("layer_load/pr_fish",this.node);t.addComponent(h.default);var o=cc.find("layer_load/pr_bullet",this.node);o.addComponent(d.default);var n=cc.find("layer_load/pr_effect",this.node);n.addComponent(r.default);var i=cc.find("layer_load/pr_coin",this.node);i.addComponent(p.default);var a=cc.find("layer_load/lb_coin",this.node),s=cc.find("layer_load/pr_bill",this.node);s.addComponent(y.default);var c=cc.find("layer_load/layer_route",this.node);this.pool_route=this.createPool(5,c),this.pool_fish=this.createPool(400,t),this.pool_bullet=this.createPool(300,o),this.pool_net=this.createPool(130,e),this.pool_coin=this.createPool(400,i),this.pool_effect=this.createPool(50,n),this.pool_bill=this.createPool(20,s),this.pool_coinlb=this.createPool(200,a)},t.prototype.createPool=function(e,t){var o=new cc.NodePool;o.prefab=t;for(var n=0;n<e;n++)o.put(cc.instantiate(t));return o},t.prototype.getNodeByPool=function(e){var t=e.get();return t||(t=cc.instantiate(e.prefab)),t},t.prototype.clearLockFishAllBullet=function(e){for(var t=this.getBullets(),o=0;o<t.length;o++){var n=t[o];n.lockFishId===e&&n.clearLockID()}},t.prototype.initView=function(){var e=s.CCLYConst.once.PlayerInfo.useOneScore?this.node.getChildByName("layer_users2").children:this.node.getChildByName("layer_users").children;this.arr_seats=[];for(var t=0;t<4;t++){var o=e[t].getComponent(g.default);this.arr_seats.push(o)}for(this.layer_bgs=this.node.getChildByName("layer_bgs"),t=0;t<5;t++){var n=this.RechargeLayer.getChildByName("btn_"+t);L.default.addClickEvent(n,this,L.default.getComponentName(this),"onClickedRecharge",t)}},t.prototype.getFishs=function(){return this.arr_fishs||[]},t.prototype.getBullets=function(){return this.arr_bullets||[]},t.prototype.changeSceneBg=function(e,t,o){void 0===e&&(e=0);var n="bg"+o%3;if(c.default.once.playBGM(n),e!=o){for(var i=this.layer_bgs.children,a=0;a<i.length;a++){var s=i[a],r=s.name==="layer_"+e&&t,l=s.name==="layer_"+o;s.active=r||l,s.active&&(s.setPosition(0,0),s.opacity=255,s.zIndex=l?0:1)}if(t){c.default.once.playSFX("effect_108");var p=this.layer_bgs.getChildByName("layer_"+e);p.stopAllActions();var d=p.getChildByName("bg");d.stopAllActions(),p.runAction(cc.moveTo(3,cc.v2(-2e3,0))),d.runAction(cc.sequence(cc.moveTo(3,cc.v2(2e3,0)),cc.callFunc(function(){d.setPosition(0,0),p.active=""+e==""+o})))}}},t.prototype.updateBalance=function(e,t){var o=c.default.once.getTableByUID(e);if(o){var n=this.getUserByTable(o.seatId);n&&n.updateBalance(t)}},t.prototype.updateDiamond=function(e,t){var o=c.default.once.getTableByUID(e);if(o){var n=this.getUserByTable(o.seatId);n&&n.updateDiamond(t)}},t.prototype.getUserByTable=function(e){for(var t=null,o=0;o<this.arr_seats.length;o++)this.arr_seats[o]._seatId===e&&(t=this.arr_seats[o]);return t},t.prototype.refreshTable=function(e){void 0===e&&(e=null);var t=[0,1,2,3];for(var o in s.CCLYConst.once.users){var n=s.CCLYConst.once.users[o];if(n){var i=parseInt(n.seatId);if(t.splice(t.indexOf(i),1),e&&n.userId!==e.userId)continue;var a=c.default.once.tableConvertIndex(i),r=c.default.once.userConvertIndex(s.CCLYConst.once.userId);cc.log("index======>"+a+"---selfIndex--\x3e"+r+"--u------\x3e"+JSON.stringify(n)),this.WeaponLayer.setConvertWeaponActive(n.userId,!0,null!=e),null!=e&&this.WeaponLayer.setLevelByUID(n.userId,0),this.arr_seats[a].refreshUserInfo(n),this.arr_seats[a].node.active=!0,n.userId==s.CCLYConst.once.userId?this.WeaponLayer.setWeaponGold(n.userId,s.CCLYConst.once.BLevels[s.CCLYConst.once.BLevel]):this.WeaponLayer.setWeaponGold(n.userId,n.bet)}}for(var l=0;l<t.length;l++)a=c.default.once.tableConvertIndex(t[l]),cc.log("cleanInfoByTid------\x3e"+a),this.arr_seats[a].cleanInfo(),this.WeaponLayer.cleanInfoByTid(t[l])},t.prototype.showUserLock=function(e,t){var o=c.default.once.tableConvertIndex(e),n=this.arr_seats[o];n&&n.showLockFish(t)},t.prototype.UnLockFishNtfType=function(e){var t=c.default.once.tableConvertIndex(e),o=this.arr_seats[t];o&&o.unLock()},t.prototype.updateFish=function(){var e=s.CCLYConst.once.FishConfigs[L.default.randomNum(0,s.CCLYConst.once.FishConfigs.length)].FishID,t=s.CCLYConst.once.FishGroups[7],o=t.id,n=s.CCLYConst.once.FishPath[0],i=c.default.once.getFishConfig(e),a=c.default.once.getFishPathByID(n.id),r=c.default.once.getFishPoints(e);r=L.default.deepCopy(r);for(var l=0;l<t.num;l++)this.refreshFish({config:i,FishPath:a,fid:e,groupId:o,index:l,compensate:0,swimmingInterval:0,pathInterval:n.time,conlliderPoints:r})},t.prototype.refreshFish=function(e){var t=e,o="layer_"+c.default.once.getFishLayerIndex(t.fid);if(30==parseInt(t.fid)&&cc.log("--------dsfdsfdsfdfsdfsdfsdfsdf"),this.pool_fish.size()<5&&cc.log("\u9c7c\u82d7\u62a5\u8b66"),t.config&&o)if(t.groups=c.default.once.getFishGroups(t.groupId),t.groups){if(!(t.groups&&t.groups.origin&&t.groups.points&&t.groups.points[t.index])){var n="!groups";return t.groups.origin||(n="!groups.origin"),t.groups.points||(n="!groups.points"),t.groups.points[t.index]||(n="!groups.points[param.index]"),void cc.log("\u627e\u4e0d\u5230\u9c7c\u7ec4\u914d\u7f6e\u4fe1\u606f ID\uff1a"+t.groupId+"  \u7f3a\u5931\u4fe1\u606f\uff1a"+n+"  param.index:"+t.index)}if(t.FishPath)if(t.swimAni=c.default.once.getSwimAnimateByID(t.fid),t.swimAni)if(t.dieAni=c.default.once.getDeathAnimateByID(t.fid),t.dieAni)if(t.iceAni=s.CCLYConst.once.MapEffects.get("ice_"+t.fid),t.iceAni){var i=this.getNodeByPool(this.pool_fish),a=i.getComponent(h.default);this.arr_fishs.push(a),i.parent=this.FishParent.getChildByName(o),a.init(t)}else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u51b0\u51bb\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u6b7b\u4ea1\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u8def\u5f84ID\uff1a"+t.pid)}else cc.log("\u627e\u4e0d\u5230\u9c7c\u7ec4\u914d\u7f6e\u4fe1\u606f ID\uff1a"+t.groupId);else cc.log("fishError\u627e\u4e0d\u5230\u9c7c\u7684\u4fe1\u606f ID\uff1a"+t.fid+"  "+!o)},t.prototype.getLockFishByFishId=function(e){for(var t=0;t<this.WeaponLayer.arr_locks.length;t++){var o=this.WeaponLayer.arr_locks[t];if(e===o.fishId)return o}return null},t.prototype.addNet=function(e,t,o,n){var i=this.getNodeByPool(this.pool_net),a=i.getComponent(f.default);i.zIndex=5e3,this.NetParent.addChild(i),a.init(e,t,o,n)},t.prototype.addEffect=function(e){if(cc.isValid(this.node)){var t=this.getNodeByPool(this.pool_effect),o=t.getComponent(r.default);this.EffectParent.addChild(t),e.parent=this.EffectSKParent,o.init(e),this.arr_effect.push(o)}},t.prototype.findZZBoomEffect=function(e,t){void 0===t&&(t=!1);for(var o=null,n=0;n<this.EffectParent.children.length;n++){var i=this.EffectParent.children[n].getComponent(r.default);i&&i.param&&i.param.skillId==s.CCLYEffectType.ZZBoom&&e==i.param.seatId&&(t&&t==i.param.bombId||!t)&&(o=i)}return o},t.prototype.addRoute=function(e){var t=this.getNodeByPool(this.pool_route);t.height=0,t.active=!0,t.nid=e.nid,t.parent=this.RouteParent,t.bulletId=e.bulletId,t.position=e.node.position,t.collisionCount=e.collisionCount,e.drillRoute=t},t.prototype.getEffectBySkillId=function(e,t){void 0===t&&(t=!0);for(var o=[],n=0;n<this.arr_effect.length;n++){var i=this.arr_effect[n];if(i.param&&i.param.skillId===e){if(!t)return i;o.push(i)}}return t?o:null},t.prototype.addBullet=function(e){var t=e;t.angle=t.angle||this.WeaponLayer.getWeaponRotationByTid(t.seatId);var o=this.WeaponLayer.getWeaponOutPositionByTid(t.seatId),n=this.getNodeByPool(this.pool_bullet),i=n.getComponent(d.default);n.zIndex=2e3,this.arr_bullets.push(i),t.point=t.point||this.BulletParent.convertToNodeSpaceAR(o),this.BulletParent.addChild(n),t.isDrill&&(t.lock=null),i.init(t)},t.prototype.showRecharge=function(){Common.showMessage("not enough balance")},t.prototype.onClickedRecharge=function(e,t){cc.log("onClickedRecharge----\x3e"+t),4==parseInt(t)?c.default.once.requestRechargeAll():c.default.once.requestRechargeSum([1,10,50,100][parseInt(t)])},t.prototype.addBill=function(e){var t=this.getNodeByPool(this.pool_bill);t.parent=this.EffectParent,t.position=e.position?this.EffectParent.convertToNodeSpaceAR(e.position):cc.v2(0,0),t.getComponent(y.default).show(e)},t.prototype.addCoin=function(e){var t=this.getNodeByPool(this.pool_coin);t.parent=e.parent||this.GoldParent,t.zIndex=1e4;var o=e,n=this.WeaponLayer.DoubleBg[o.index];if(n){var i=n.convertToWorldSpaceAR(cc.v2(0,0)),a=t.getComponent(p.default);o.to=i,a.init(o),this.arr_coin.push(a)}},t.prototype.addCoinLb=function(e){e||(e={});var t=this.getNodeByPool(this.pool_coinlb);if(t.parent=this.GoldLabelParent,e.position)t.position=e.position;else{var o=c.default.once.tableConvertIndex(e.seatId),n=this.arr_seats[o].getUserWinWorldPoint();t.position=t.parent.convertToNodeSpaceAR(n)}t.active=!0,t.zIndex=10001;var i=t.getComponent("CCLYLabel");return i.defaultNames="score1_",i.spriteAtlas=i.spriteAtlas||s.CCLYConst.once.UIAtals,i.string=c.default.once.GameLayer.changeGold(e.award)+" ",t},t.prototype.despawnBill=function(e){e.node&&this.pool_bill.put(e.node)},t.prototype.despawnBullet=function(e){e.seatId===s.CCLYConst.once.seatId&&s.CCLYConst.once.BulletCount--,e.setLockFishID(-1),e.node&&this.pool_bullet.put(e.node);var t=this.arr_bullets.indexOf(e);this.arr_bullets.splice(t,1),e.isDrill&&(this.despawnRoute(e.nid),e.drillRoute=null)},t.prototype.despawnEffect=function(e){e.clean();var t=this.arr_effect.indexOf(e);this.arr_effect.splice(t,1),this.pool_effect.put(e.node)},t.prototype.despawnRoute=function(e){for(var t=this.RouteParent.children.length-1;t>=0;t--){var o=this.RouteParent.children[t];o.nid==e&&this.pool_route.put(o)}},t.prototype.despawnCoin=function(e){e.node instanceof cc.Node&&(this.pool_coin.put(e.node),e.clean()),e instanceof cc.Node&&this.pool_coin.put(e);var t=this.arr_coin.indexOf(e);this.arr_coin.splice(t,1)},t.prototype.despawnCoinLb=function(e){e.node instanceof cc.Node&&(this.pool_coinlb.put(e.node),e.clean()),e instanceof cc.Node&&this.pool_coinlb.put(e)},t.prototype.clearTableFishs=function(){for(var e=this.FishParent.childrenCount-1;e>=0;e--){var t=this.FishParent.children[e].getComponent(h.default);t&&this.despawnFish(t)}},t.prototype.despawnFish=function(e){e.node&&e instanceof h.default&&(e.node.active=!1,this.pool_fish.put(e.node));var t=this.arr_fishs.indexOf(e);-1!==t&&this.arr_fishs.splice(t,1)},t.prototype.despawnNet=function(e){e.node&&this.pool_net.put(e.node)},t.prototype.update=function(e){if(cc.isValid(this.node)){(s.CCLYConst.once.HeartBeatCD-=e)<0&&(s.CCLYConst.once.HeartBeatCD=5,c.default.once.heartBeat());for(var t=[],o=0;o<this.arr_fishs.length;o++){var n=this.arr_fishs[o];if(n.updatexxx(e),n&&n.alive){var i=n.node.convertToWorldSpaceAR(cc.v2(0,0));t.push({fish:n,fwsp:i})}}for(var a=[],r=0;r<this.arr_bullets.length;r++){var l=this.arr_bullets[r];l.updatexxx(e);var p=l.node.convertToWorldSpaceAR(cc.v2(0,0)),d=cc.v2(p.x,p.y-50),h=cc.v2(p.x-20,p.y),f=cc.v2(p.x+20,p.y);a.push({bullet:l,bwsp:p,bwspDown:d,bwspLeft:h,bwspRight:f})}for(r=0;r<a.length;r++){var u=a[r];for(o=0;o<t.length;o++){var C=t[o],y=u.bwsp.sub(C.fwsp).mag();if((C.fish.radius>200?200:C.fish.radius)>y){var g=C.fish.getColliderPoints().ws;(y<50||C.fish==u.bullet.lockFish||L.default.rayCasting(u.bwsp,g)||L.default.rayCasting(u.bwspDown,g)||L.default.rayCasting(u.bwspLeft,g)||L.default.rayCasting(u.bwspRight,g))&&u.bullet.onCollision(C.fish)}}}a=null,t=null}},t.prototype.onDestroy=function(){var e=function(e){for(var t=0;t<e.length;t++){var o=e[t];o.node&&(o.node.removeFromParent(),o.node.destroy())}};e(this.arr_coin),e(this.arr_bullets),e(this.arr_fishs),e(this.arr_effect),s.CCLYConst.destroyInstance(),c.default.destroyInstance()},a([I(_.default)],t.prototype,"LoadingLayer",void 0),a([I(l.default)],t.prototype,"MenuLayer",void 0),a([I(u.default)],t.prototype,"WeaponLayer",void 0),a([I(C.default)],t.prototype,"EffectLayer",void 0),a([I(cc.Node)],t.prototype,"RechargeLayer",void 0),a([I(cc.Node)],t.prototype,"RouteParent",void 0),a([I(cc.Node)],t.prototype,"FishParent",void 0),a([I(cc.Node)],t.prototype,"BulletParent",void 0),a([I(cc.Node)],t.prototype,"GoldParent",void 0),a([I(cc.Node)],t.prototype,"GoldLabelParent",void 0),a([I(cc.Node)],t.prototype,"NetParent",void 0),a([I(cc.Node)],t.prototype,"EffectSKParent",void 0),a([I(cc.Node)],t.prototype,"EffectParent",void 0),a([v],t)}(cc.Component);o.default=Y,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYBill":"CCLYBill","./CCLYBullet":"CCLYBullet","./CCLYCoin":"CCLYCoin","./CCLYConst":"CCLYConst","./CCLYEffect":"CCLYEffect","./CCLYEffectLayer":"CCLYEffectLayer","./CCLYFish":"CCLYFish","./CCLYFishNet":"CCLYFishNet","./CCLYLoading":"CCLYLoading","./CCLYManager":"CCLYManager","./CCLYMenu":"CCLYMenu","./CCLYUser":"CCLYUser","./CCLYWeapon":"CCLYWeapon"}],CCLYUser:[function(e,t,o){"use strict";cc._RF.push(t,"efe13XiKFJEYZ9WAIjlJsWC","CCLYUser");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./CCLYConst"),c=e("./CCLYManager"),r=cc._decorator,l=r.ccclass,p=r.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._seatId=-1,t.lb_total=null,t.lb_gold=null,t.layer_zz=null,t}return i(t,e),t.prototype.initUI=function(){this.unLock(),this.node.getChildByName("btn_add").on("click",this.onClickedAdd,this)},t.prototype.onClickedAdd=function(){this._seatId==s.CCLYConst.once.seatId&&(c.default.once.GameLayer.showRecharge(!1),c.default.once.playSFX("click"))},t.prototype.refreshUserInfo=function(e){if(cc.log("uinfo----\x3e"+JSON.stringify(e)),e){this._seatId=e.seatId,this.node.getChildByName("btn_add").active=e.seatId==s.CCLYConst.once.seatId&&!s.CCLYConst.once.PlayerInfo.useOneScore,this.updateBalance(e.score),this.updateDiamond(e.wins),this.node.active=!0,this.lb_gold.node.parent.active=!0;var t=c.default.once.tableConvertIndex(this._seatId);this.node.x=.19*cc.view.getVisibleSize().width,this.node.x=t%2?this.node.x+297:-this.node.x-297}},t.prototype.updateBalance=function(e){e=e||0,this.lb_gold.string=c.default.once.GameLayer.changeGold(e)},t.prototype.updateDiamond=function(e){e=e||0,this.lb_total.string=c.default.once.GameLayer.changeGold(e)},t.prototype.onClickZZ=function(){var e=c.default.once.GameLayer.findZZBoomEffect(s.CCLYConst.once.seatId);e&&c.default.once.CmdZZBoom(e),this.showZZ(!1)},t.prototype.showZZ=function(e){this.layer_zz&&(this.layer_zz.active=e)},t.prototype.showLockFish=function(){},t.prototype.unLock=function(){},t.prototype.cleanInfo=function(){this.node.active=!1,this._seatId=-1,this.lb_total.string="",this.lb_gold.string="0",this.lb_gold.node.parent.active=!1,this.unLock()},t.prototype.getUserWorldPoint=function(){return this.node.convertToWorldSpaceAR(cc.v2(0,-30))},t.prototype.getUserWinWorldPoint=function(){return this.lb_gold.node.convertToWorldSpaceAR(cc.v2(0,-30))},a([p(cc.Label)],t.prototype,"lb_total",void 0),a([p(cc.Label)],t.prototype,"lb_gold",void 0),a([p(cc.Node)],t.prototype,"layer_zz",void 0),a([l],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./CCLYConst":"CCLYConst","./CCLYManager":"CCLYManager"}],CCLYWeapon:[function(e,t,o){"use strict";cc._RF.push(t,"523ebOI6hRJ9qQeUrOfNL+l","CCLYWeapon");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,o,s):i(t,o))||s);return a>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../../Script/utils/Utils"),c=e("./CCLYConst"),r=e("./CCLYFish"),l=e("./CCLYManager"),p=cc._decorator,d=p.ccclass,h=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SeatWaits=[],t.FishParent=null,t.arr_weaponAn=[],t.arr_weaponFire=[],t.WeaponUI=[],t.DoubleBg=[],t.arr_golds=[],t.spacingY=5,t.firstFire={set:function(e){e!==this._firstFire&&(this._firstFire=e,!this._firstFire&&this.GameLayer.MenuLayer._mune&&this.GameLayer.MenuLayer.onClickedShow())},get:function(){return this._firstFire}},t.arr_weapons=[],t.arr_lines=[],t.arr_circle=[],t.arrLevels=[],t.arr_locks=[c.CCLYConst.once.NotFound,c.CCLYConst.once.NotFound,c.CCLYConst.once.NotFound,c.CCLYConst.once.NotFound],t.arr_changes=[],t._limitTime=0,t.LastFireTime=0,t.AutoFire=!1,t}return i(t,e),t.prototype.onLoad=function(){},t.prototype.init=function(){this.initViewData(),this.FishParent.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.FishParent.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.FishParent.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.FishParent.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.FishParent._touchListener.setSwallowTouches(!1),this.schedule(this.speed0,c.CCLYFireSpeed.Speed0),this.schedule(this.speed1,c.CCLYFireSpeed.Speed1),this.firstFire=!0},t.prototype.speed1=function(){c.CCLYConst.once.FightLimit==c.CCLYFireSpeed.Speed1&&(this.limitFireCd(),this.checkAutoFire())},t.prototype.speed0=function(){c.CCLYConst.once.FightLimit==c.CCLYFireSpeed.Speed0&&(this.limitFireCd(),this.checkAutoFire())},t.prototype.limitFireCd=function(){this.checkAutoLock(),this._canFire=!0},t.prototype.checkAutoFire=function(){if(-1!=c.CCLYConst.once.seatId&&(c.CCLYConst.once.IsAuto||this.AutoFire)){var e=this.getWeaponOutPositionByTid(c.CCLYConst.once.seatId),t=l.default.once.tableConvertIndex(),o=this.arr_locks[t];o instanceof r.default&&(e=o.getWorldPoint()),this._touchPoint&&(e=this._touchPoint,this._touchPoint=null),l.default.once.onTouchWindow(e,o.fishId),this.firstFire=!1}},t.prototype.setWeaponGold=function(e,t){var o=l.default.once.userConvertIndex(e),n=this.arr_golds[o];if(n){var i=t*c.CCLYConst.once.RoomBet;n.string=l.default.once.GameLayer.changeGold(i),n.node.active=!0}},t.prototype.setConvertWeaponActive=function(e,t,o){void 0===o&&(o=!0);var n=l.default.once.userConvertIndex(e);try{var i=this.WeaponUI[n];if(i.active=this.arr_weaponAn[n].node.active=t,this.SeatWaits[n].active=!t,this.WeaponUI[n].getChildByName("btn_add").active=t&&c.CCLYConst.once.userId===e,this.WeaponUI[n].getChildByName("btn_minus").active=t&&c.CCLYConst.once.userId===e,c.CCLYConst.once.userId===e&&o){for(var a=[cc.fadeIn(.1)],s=0;s<8;s++)a.push(cc.moveTo(.5,cc.v2(0,s%2==0?160:190)));a.push(cc.fadeOut(.1));var r=i.getChildByName("sp_there");r.active=!0,r.stopAllActions(),r.runAction(cc.sequence(a))}}catch(p){cc.log("setConvertWeaponActive---\x3e"+JSON.stringify(p))}},t.prototype.initViewData=function(){for(var e=this.WeaponUI,t=0;t<4;t++){var o=e[t];o.getChildByName("sp_lock").getComponent(cc.Sprite).spriteFrame=l.default.once.getFrameByName("icon_locking");for(var n=cc.find("an_pao",o).getComponent(cc.Animation),i=n.node.children[0].getComponent(cc.Animation),a=0;a<8;a++){var s=l.default.once.getEffectByType("paotong"+a+"_");s.wrapMode=cc.WrapMode.Normal,n.addClip(s);var c=l.default.once.getEffectByType("fire"+a+"_");c.wrapMode=cc.WrapMode.Normal,i.addClip(c)}this.arr_weaponFire[t]=i;var r="onFinishFireAn"+t;i.on("finished",this[r],this);var p="onFinishWeaponAn"+t;n.on("finished",this[p],this),this.arr_weaponAn[t]=n,n.node.children[0].active=!1,o.getChildByName("double").active=!1,cc.find("btn_add",o).on("click",this.onClickedAdd,this),cc.find("btn_minus",o).on("click",this.onClicked__,this),cc.find("btn_add",o).active=!1,cc.find("btn_minus",o).active=!1,this.arr_golds.push(o.getChildByName("lb_level").getComponent("CCLYLabel")),this.arr_weapons.push(o.getChildByName("tip"));var d=o.getChildByName("layer_line").getComponent(cc.Layout);d.spacingY=this.spacingY,this.arr_lines.push(d);var h=o.getChildByName("sp_lock");this.arr_circle.push(h),this.arrLevels.push(0)}},t.prototype.setTimelimit=function(e){this._limitTime=e},Object.defineProperty(t.prototype,"timeLimit",{get:function(){return this._limitTime<=0&&this._canFire},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"balanceLimit",{get:function(){var e=this.getLevelCoinByUID();return c.CCLYConst.once.Entries>=e},enumerable:!1,configurable:!0}),t.prototype.setClickLimit=function(e){this._canFire=e},t.prototype.paramAniName=function(e){return e<0&&(e=0),e>3&&(e=3),"paotong"+e+"_0"},t.prototype.getLevelCoinByUID=function(e){void 0===e&&(e=404);var t=404===e?c.CCLYConst.once.userId:e,o=l.default.once.userConvertIndex(t);return parseFloat(this.arr_golds[o].string)},t.prototype.refreshWeaponByIndex=function(e,t){var o=this.arrLevels[e];if(void 0!==o){var n=this.paramAniName(o,t);this.arr_weaponAn[e].node.getComponent(cc.Sprite).spriteFrame=c.CCLYConst.once.UIAtals.getSpriteFrame(n)}},t.prototype.showChangeWeaponByIndex=function(e){var t=this.arrLevels[e],o=this.paramAniName(t,1);this.arr_weaponAn[e].node.getComponent(cc.Sprite).spriteFrame=c.CCLYConst.once.UIAtals.getSpriteFrame(o)},t.prototype.setLevelByUID=function(e,t){var o=l.default.once.userConvertIndex(e);l.default.once.playSFX("weapon_change");var n;n=t<=5?0:t<=20?1:t<=50?2:3,l.default.once.playSFX("weapon_change"),this.arrLevels[o]=n,this.showChangeWeaponByIndex(o)},t.prototype.cleanInfoByTid=function(e){var t=l.default.once.tableConvertIndex(e);this.arrLevels[t]=0,this.showDoubleByIndex(t,0),this.arr_weaponAn[t].node.active=!1,this.arr_golds[t].node.active=!1,this.DoubleBg[t].active=!1,this.WeaponUI[t].active=!1,this.SeatWaits[t].active=!0,this.setLockFishByTid(e)},t.prototype.hideLockLineByIndex=function(e){var t=this.arr_lines[e];t&&(t.node.active=!1,this.arr_circle[e].active=!1)},t.prototype.showLockLineByTid=function(e,t){if(t instanceof r.default){var o=t.getWorldPoint(),n=l.default.once.tableConvertIndex(e);this.changeWeaponRotationByTid(o,e,!1);var i=this.arr_weapons[n],a=this.arr_circle[n];a.position=i.parent.convertToNodeSpaceAR(o),a.active=!0;var s=this.arr_lines[n];s.node.angle=i.angle;var p=this.getWeaponOutPositionByTid(e,10);s.node.position=s.node.parent.convertToNodeSpaceAR(p),s.node.scale=1;var d=o.sub(p).mag()-10;s.height=d;var h=d/(17+this.spacingY);h=Math.ceil(h)-1;for(var f=s.node.children.length,u=0;u<h||u<f;u++){var C=s.node.children[u];C||((C=cc.instantiate(s.node.children[0])).active=!1,C.getComponent(cc.Sprite).spriteFrame=c.CCLYConst.once.UIAtals.getSpriteFrame("line01")),C.scale=1,s.node!==C.parent&&(C.parent=s.node),C.active!==u<h&&(C.active=u<h)}s.node.active=!0}},t.prototype.getConvertWeaponRotationByTid=function(e,t,o){void 0===o&&(o=0);var n=l.default.once.tableConvertIndex(t),i=this.arr_weapons[n];if(cc.isValid(i)){var a=o,s=i.convertToWorldSpaceAR(cc.v2(0,a));return l.default.once.convertPointToAngle(s,e)-90}},t.prototype.getWeaponRotationByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_weapons[t].angle},t.prototype.getWeaponLowerPositionByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_weapons[t].convertToWorldSpaceAR(cc.v2(0,0))},t.prototype.onTouchStart=function(e,t){l.default.once.playSFX("click");var o=e.getLocation(),n=l.default.once.tableConvertIndex(),i=this.WeaponUI[n],a=i.getChildByName("btn_add").convertToWorldSpaceAR(cc.v2(0,0)),s=i.getChildByName("btn_minus").convertToWorldSpaceAR(cc.v2(0,0));a.sub(o).mag()<50||s.sub(o).mag()<50||-1!=c.CCLYConst.once.seatId&&(c.CCLYConst.once.IsAuto&&this.onTouchMove(e),this.getLockFishByTid(c.CCLYConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.CCLYConst.once.seatId),t instanceof r.default&&c.CCLYConst.once.IsLock&&(cc.log("\u70b9\u51fb\uff1a"+t.config.Name),l.default.once.CmdBYLockFish(t)),this.clickFire(o),this.AutoFire=!0)},t.prototype.onTouchMove=function(e){-1!=c.CCLYConst.once.seatId&&(this._touchPoint=e.getLocation(),this.getLockFishByTid(c.CCLYConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.CCLYConst.once.seatId))},t.prototype.onTouchEnd=function(e){this.AutoFire=!1,-1!=c.CCLYConst.once.seatId&&(this.getLockFishByTid(c.CCLYConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.CCLYConst.once.seatId))},t.prototype.clickFire=function(e){this._limitTime>0||-1===c.CCLYConst.once.seatId||(c.CCLYConst.once.IsAuto?this._touchPoint=e:l.default.once.onTouchWindow(e))},t.prototype.changeWeaponRotationByTid=function(e,t,o){void 0===o&&(o=!0);var n=l.default.once.tableConvertIndex(t);if(this.arr_weapons[n]&&this.arr_weaponAn[n]){n>1&&o&&(e.y=cc.view.getVisibleSize().height-e.y);var i=-this.getConvertWeaponRotationByTid(e,t);this.arr_weapons[n].angle=i,this.arr_weaponAn[n].node.angle=i}},t.prototype.getWeaponOutPositionByTid=function(e,t){void 0===t&&(t=c.CCLYConst.once.WeaponHight);var o=l.default.once.tableConvertIndex(e);return this.arr_weapons[o].convertToWorldSpaceAR(cc.v2(0,t))},t.prototype.getLockFishByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_locks[t]},t.prototype.onClickedAdd=function(){l.default.once.playSFX("click"),this.changeWeaponBet(1)},t.prototype.onClicked__=function(){l.default.once.playSFX("click"),this.changeWeaponBet(-1)},t.prototype.changeWeaponBet=function(e){var t=c.CCLYConst.once.BLevel;(t+=e)>=c.CCLYConst.once.BLevels.length&&(t=0),t<0&&(t=c.CCLYConst.once.BLevels.length-1),l.default.once.requestChangeCannonBet(JSON.stringify({userid:c.CCLYConst.once.userId,bet:c.CCLYConst.once.BLevels[t]}))},t.prototype.showWeapon=function(e){var t=s.default.deepCopy(e),o=l.default.once.userConvertIndex(t.userid),n=this.getLockFishByTid(t.seatId);if(t.userid!=c.CCLYConst.once.userId){var i=n instanceof r.default?n.getWorldPoint():cc.v2(t.touch.x,t.touch.y);this.changeWeaponRotationByTid(i,t.seatId)}var a=this.arrLevels[o];if(this.arr_weaponAn[o].play("paotong"+a+"_"),this.arr_weaponFire[o].node.active=!0,this.arr_weaponFire[o].play("fire"+a+"_"),t.lock=n.fishId,t.level=a,l.default.once.GameLayer.addBullet(t),t.seatId===c.CCLYConst.once.seatId){a<1&&(a=1);var p=t.isDrill?"s208":"v"+a;l.default.once.playSFX(p),this.firstFire=!1,l.default.once.GameLayer.EffectLayer.showLable(this._limitTime)}},t.prototype.setLockFishByTid=function(e,t){var o=l.default.once.tableConvertIndex(e),n=this.getLockFishByTid(e);n instanceof r.default&&n.popLockTid(e),this.hideLockLineByIndex(o),t instanceof r.default?this.arr_locks[o]=t:this.arr_locks[o]=c.CCLYConst.once.NotFound},t.prototype.cleanFishAllWeaponLock=function(e){for(var t=0;t<4;t++){var o=this.getLockFishByTid(t);e.fishId===o.fishId&&this.setLockFishByTid(t)}},t.prototype.touchFishIsLock=function(e){var t=this.getLockFishByTid(c.CCLYConst.once.seatId);return c.CCLYConst.once.IsLock&&(t instanceof r.default&&t.fishId!==e.fishId||!(t instanceof r.default))},t.prototype.showDoubleByIndex=function(e,t){void 0===t&&(t=30);var o=this.DoubleBg[e];o.active=!0,o.stopAllActions(),o.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){o.active=!1})))},t.prototype.checkAutoLock=function(){if(-1!=c.CCLYConst.once.seatId&&c.CCLYConst.once.IsLock&&!(this.getLockFishByTid(c.CCLYConst.once.seatId)instanceof r.default)){var e=l.default.once.getMaxFish();e instanceof r.default&&l.default.once.CmdBYLockFish(e)}},t.prototype.update=function(e){cc.isValid(this.node)&&(this.LastFireTime-=e,this._limitTime-=e,this.LastFireTime<-999998||(this.LastFireTime<-60&&l.default.once.GameLayer.EffectLayer.showLable(this.LastFireTime),this.LastFireTime<-91&&this.LastFireTime>-190&&(this.LastFireTime=-999999,l.default.once.GameLayer.MenuLayer.onClickedBack())))},t.prototype.onFinishWeaponAn0=function(){this.refreshWeaponByIndex(0,1)},t.prototype.onFinishWeaponAn1=function(){this.refreshWeaponByIndex(1,1)},t.prototype.onFinishWeaponAn2=function(){this.refreshWeaponByIndex(2,1)},t.prototype.onFinishWeaponAn3=function(){this.refreshWeaponByIndex(3,1)},t.prototype.onFinishFireAn0=function(){this.arr_weaponFire[0].node.active=!1},t.prototype.onFinishFireAn1=function(){this.arr_weaponFire[1].node.active=!1},t.prototype.onFinishFireAn2=function(){this.arr_weaponFire[2].node.active=!1},t.prototype.onFinishFireAn3=function(){this.arr_weaponFire[3].node.active=!1},t.prototype.onDestroy=function(){this.unschedule(this.speed0),this.unschedule(this.speed1)},a([h([cc.Node])],t.prototype,"SeatWaits",void 0),a([h(cc.Node)],t.prototype,"FishParent",void 0),a([h([cc.Node])],t.prototype,"WeaponUI",void 0),a([h([cc.Node])],t.prototype,"DoubleBg",void 0),a([d],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./CCLYConst":"CCLYConst","./CCLYFish":"CCLYFish","./CCLYManager":"CCLYManager"}]},{},["CCLYBill","CCLYBullet","CCLYCoin","CCLYConst","CCLYEffect","CCLYEffectLayer","CCLYFish","CCLYFishNet","CCLYLabel","CCLYLoading","CCLYManager","CCLYMenu","CCLYNetWork","CCLYScene","CCLYUser","CCLYWeapon"]);