window.__require=function e(t,o,n){function i(a,c){if(!o[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var p=o[a]={exports:{}};t[a][0].call(p.exports,function(e){return i(t[a][1][e]||e)},p,p.exports,e,t,o,n)}return o[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({FISHMANBill:[function(e,t,o){"use strict";cc._RF.push(t,"d5e58ihuyFOPbB3u1pIuZHl","FISHMANBill");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANManager"),c=cc._decorator,r=c.ccclass,l=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onLoad=function(){this.layer_min=this.node.getChildByName("layer_min"),this.an_fish=this.layer_min.getChildByName("an_fish").getComponent(cc.Animation),this.sp_fish=this.layer_min.getChildByName("an_fish").getComponent(cc.Sprite),this.lb_gold0=this.layer_min.getChildByName("lb_gold").getComponent("FISHMANLabel"),this.an_bg=this.layer_min.getChildByName("an_bg").getComponent(cc.Animation),this.win=this.layer_min.getChildByName("win");var e=a.default.once.getEffectByType("buleLightEff_");e.wrapMode=cc.WrapMode.Loop,this.an_bg.addClip(e),this.an_bg.on("finished",this.onFinishAnimate,this)},t.prototype.show=function(e){var t=this;this.param=e,this.node.active=!0,this.win.active=!0,this.win.opacity=0,this.seatId=e.seatId,this.layer_min.active=!0,this.layer_min.scale=1.2,a.default.once.playSFX("bill_min"),this.lb_gold0.string=e.award?a.default.once.GameLayer.changeGold(e.award):"",this.an_fish.node.active=!0,this.an_fish.node.scale=1,this.an_bg.play("buleLightEff_");var o=[20,21,22,25,26,27,29,30].indexOf(e.fid);this.sp_fish.node.scale=1,20==e.fid&&(this.sp_fish.node.scale=.65),21==e.fid&&(this.sp_fish.node.scale=.57),22==e.fid&&(this.sp_fish.node.scale=.45),27==e.fid&&(this.sp_fish.node.scale=1.5),-1==o&&cc.log("ssssssssssssssssss"),this.sp_fish.spriteFrame=a.default.once.GameLayer.LoadingLayer.billSPS[o],this.win.runAction(cc.sequence(cc.delayTime(1),cc.fadeIn(.1))),this.scheduleOnce(function(){t.clean(),a.default.once.GameLayer.EffectLayer.onFinishEffect(t.param),a.default.once.GameLayer.despawnBill(t)},2)},t.prototype.onFinishAnimate=function(){},t.prototype.clean=function(){this.node.stopAllActions(),this.unscheduleAllCallbacks()},s([r],t)}(cc.Component));o.default=l,cc._RF.pop()},{"./FISHMANManager":"FISHMANManager"}],FISHMANBullet:[function(e,t,o){"use strict";cc._RF.push(t,"aeec5zuIzxJwbPZ/BUhFH1x","FISHMANBullet");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANFish"),r=e("./FISHMANManager"),l=cc._decorator,p=l.ccclass,h=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.seatId=0,t.bulletId=0,t.angle=0,t.level=0,t.collisionCount=0,t.initTime=0,t._lastUpdateTime=0,t.lockFishId=a.FISHMANConst.once.NotFound,t.radius=0,t}return i(t,e),t.prototype.onLoad=function(){this.node.zIndex=-1,this.sp=this.node.getComponent(cc.Sprite),this.radius=a.FISHMANConst.once.BulletRadius,this.an_bullet=this.node.getComponent(cc.Animation)},t.prototype.init=function(e){var t=Date.now();this.initTime=t,this.seatId=e.seatId,this.bulletId=e.bulletId,this.bxy=null,this.drillRoute=null,this.isDrill=e.isDrill,this.boomWay=e.boomWay,this.nid=e.nid,this.boomPercent=e.boomPercent,this.node.stopAllActions(),this.angle=-e.angle,this.node.angle=e.angle,this.node.position=e.point,this.level=e.level,e.level<1&&(e.level=1),e.level>4&&(e.level=4),this.collisionCount=0,this._enableUpdate=!0,this.node.scale=e.isDrill?1.1:1.5,this.node.active=!0,this.setLockFishID(e.lock),this.sp.spriteFrame=e.isDrill?a.FISHMANConst.once.UIAtals.getSpriteFrame("sickleHalo"):a.FISHMANConst.once.UIAtals.getSpriteFrame("Bullet"+this.seatId+"_"+e.level),this.node.children[0].getComponent(cc.Sprite).spriteFrame=e.isDrill?a.FISHMANConst.once.UIAtals.getSpriteFrame("sickle"):null,e.isDrill&&(this.node.runAction(cc.repeatForever(cc.rotateBy(.25,100))),this.addNewRoute()),this._lastUpdateTime=this.initTime},t.prototype.setLockFishID=function(e){this.lockFish=r.default.once.GameLayer.getLockFishByFishId(e),this.lockFish instanceof c.default?this.lockFishId=e:this.lockFishId=a.FISHMANConst.once.NotFound},t.prototype.setOutPosition=function(e){this.angle=e.angle,this.node.x+=e.x,this.node.y+=e.y},t.prototype.calculateDrillBoomPoint=function(){if(++this.collisionCount==this.boomWay&&this.isDrill){var e=cc.v2(this.node.x,this.node.y),t=cc.view.getVisibleSize(),o=Math.sin(this.angle/180*Math.PI),n=Math.cos(this.angle/180*Math.PI),i=o>0?t.width/2-e.x:-t.width/2-e.x,s=n>0?t.height/2-e.y:-t.height/2-e.y,c=a.FISHMANConst.once.BulletSpeed.x*o,r=a.FISHMANConst.once.BulletSpeed.y*n,l=Math.abs(i/c*this.boomPercent/100),p=Math.abs(s/r*this.boomPercent/100);e.x+=c*Math.min(l,p),e.y+=r*Math.min(l,p),this.bxy=e}},t.prototype.updatexxx=function(){if(this._enableUpdate){if(this.lockFish instanceof c.default){var e=this.lockFish.getWorldPoint(),t=this.node.convertToWorldSpaceAR(cc.v2(0,0));this.angle=r.default.once.convertPointToAngle(t,e)-90}var o=Date.now(),n=(o-this._lastUpdateTime)/1e3;this._lastUpdateTime=o;var i=cc.v2(a.FISHMANConst.once.BulletSpeed.x,a.FISHMANConst.once.BulletSpeed.y);this.isDrill&&(i.x*=.2,i.y*=.2);var s=r.default.once.calculateSpacePoint({angle:this.angle,space:n,speed:i});this.node.x+=s.x,this.node.y+=s.y;var l=r.default.once.convertPositionAngle({x:this.node.x,y:this.node.y,angle:this.angle});if(l.out?(this.clearLockID(),this.setOutPosition(l),this.calculateDrillBoomPoint(),this.addNewRoute()):this.checkDrillBoom(s.x,s.y),this.node.angle=-this.angle,this.isDrill&&this.drillRoute){this.drillRoute.angle=-this.angle;var p=this.drillRoute.position.sub(this.node.position).mag();this.drillRoute.height=p}}},t.prototype.addNewRoute=function(){this.isDrill&&r.default.once.GameLayer.EffectLayer.addEffect({skillId:a.FISHMANEffectType.TLBoomRoute,nid:this.nid})},t.prototype.checkDrillBoom=function(e,t){if(this.bxy&&this.isDrill){var o=this.node.x>this.bxy.x&&e>0||this.node.x<this.bxy.x&&e<0,n=this.node.y>this.bxy.y&&t>0||this.node.y<this.bxy.y&&t<0;(o||n)&&(this.node.position=this.bxy,this.lowerNet(!1))}},t.prototype.beAttackFish=function(e){e&&e.alive&&e.beAttack()},t.prototype.clearLockID=function(){this.setLockFishID(-1)},t.prototype.lowerNet=function(e,t){void 0===e&&(e=!0),this._enableUpdate=!1,e&&(t=t||this.node.convertToWorldSpaceAR(cc.v2(0,0)),r.default.once.GameLayer.addNet(t,this.level,this.node.angle,this.seatId)),this.an_bullet.currentClip&&this.an_bullet.removeClip(this.an_bullet.currentClip,!0),r.default.once.GameLayer.despawnBullet(this)},t.prototype.sendHitFishReqType=function(e){if(e instanceof c.default&&this.seatId===a.FISHMANConst.once.seatId){var t=this.isDrill?3:1;if(this.isDrill&&parseInt(e.config.Skill)>0)return;if(2==e.config.propFish&&(t=7,this.isDrill))return;var o=this.lockFish instanceof c.default?this.lockFish.fishId:null;r.default.once.requestShotTarget(e.fishId,this.bulletId,t,o)}},t.prototype.onCollision=function(e){var t=this.lockFishId===e.fishId;if((this._enableUpdate||t)&&(this.lockFishId===a.FISHMANConst.once.NotFound||t)){if(!this.isDrill){var o=t?e.getWorldPoint():null;this.lowerNet(!0,o)}this.sendHitFishReqType(e),this.beAttackFish(e)}},s([p],t)}(cc.Component));o.default=h,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANFish":"FISHMANFish","./FISHMANManager":"FISHMANManager"}],FISHMANCoin:[function(e,t,o){"use strict";cc._RF.push(t,"b0bcaQ6JndEgqmBq3bNsHU4","FISHMANCoin");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onLoad=function(){this.sb_bg=this.node.getComponent(cc.Sprite),this.an_bg=this.node.getComponent(cc.Animation);var e=c.default.once.getEffectByType("bubble_");e.wrapMode=cc.WrapMode.Normal,this.an_bg.addClip(e),this.an_bg.on("finished",this.onFinishAn,this)},t.prototype.onFinishAn=function(){var e=this.param?"smallFood"+this.param.fid:null;cc.log("onFinishAn",e,this.param),this.sb_bg.spriteFrame=a.FISHMANConst.once.MapAtlas.get("paopao").getSpriteFrame(e)},t.prototype.clean=function(){this.node.stopAllActions(),this.node.active=!1},t.prototype.init=function(e){var t=this;this.clean(),this.node.active=!0,this.an_bg.play("bubble_"),this.param=e;var o=cc.v2(e.position.x,e.position.y);this.node.setPosition(o);var n=e.i;this.node.setScale(1.2),this.node.opacity=0;var i=cc.sequence(cc.fadeIn(.03),cc.moveBy(.12,cc.v2(0,1)).easing(cc.easeOut(3)),cc.moveBy(.1,cc.v2(0,-1)).easing(cc.easeIn(3))),s=cc.spawn(i,cc.scaleTo(.3,1.2)),a=this.node.parent.convertToNodeSpaceAR(e.to),r=cc.v2((o.x+a.x)/2,o.y+50),l=cc.bezierTo(2,[o,r,a]),p=cc.spawn(l.easing(cc.easeOut(2)),cc.scaleTo(2,.84)),h=cc.callFunc(function(){var t="gold_small";e.fid>9&&(t="gold"),e.fid>19&&(t="gold_big"),e.skillId>100&&(t="gold_effect"),c.default.once.playSFX(t)}),d=cc.callFunc(function(){c.default.once.playSFX("back")}),f=c.default.once.GameLayer.getUserByTable(e.seatId);f&&(a=this.node.parent.convertToNodeSpaceAR(f.getUserWinWorldPoint()));var u=cc.callFunc(function(){0===n&&c.default.once.showCoinLbAction({position:a,award:e.award,self:e.self}),c.default.once.GameLayer.despawnCoin(t)}),y=[];n*=.07,y.push(cc.delayTime(n));var I=!e.skillId,g=e.self&&0===e.i;I&&g&&y.push(h),y.push(s),y.push(cc.delayTime(.7)),I&&g&&y.push(d),y.push(p),y.push(u),this.node.runAction(cc.sequence(y))},s([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANConst:[function(e,t,o){"use strict";var n;cc._RF.push(t,"6b88aMu+CJMiYNqwS6ft5Wo","FISHMANConst"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoadType=o.FISHMANConst=o.FISHMANEffectType=o.FISHMANFireSpeed=o.FISHMANFishStatus=void 0,function(e){e[e.Die=0]="Die",e[e.Live=1]="Live"}(o.FISHMANFishStatus||(o.FISHMANFishStatus={})),function(e){e[e.Speed0=.2]="Speed0",e[e.Speed1=.1]="Speed1"}(n=o.FISHMANFireSpeed||(o.FISHMANFireSpeed={})),function(e){e[e.ZZBoom=1026]="ZZBoom",e[e.ZZBoom4Child=10261]="ZZBoom4Child",e[e.ZZBoomBoList=10262]="ZZBoomBoList",e[e.ZZBoomBo=10263]="ZZBoomBo",e[e.FOOD=1029]="FOOD",e[e.LOCAL_BOOM=1024]="LOCAL_BOOM",e[e.FULL_BOOM=1025]="FULL_BOOM",e[e.DIAN_WANG=1030]="DIAN_WANG",e[e.PI_KA_QIU=1027]="PI_KA_QIU",e[e.PKQLight=10281]="PKQLight",e[e.None=0]="None",e[e.Fast=100]="Fast",e[e.Bill=120]="Bill",e[e.SamllBill=1201]="SamllBill"}(o.FISHMANEffectType||(o.FISHMANEffectType={}));var i=function(){function e(){this.NotFound=999999999,this.CoinRotationTime=.06,this.FishRedDuring=.15,this.NetMaxTime=.2,this.BulletSpeed={x:.6,y:.6},this.BoomR=200,this.IsDrillR=200,this.LastFishSD=[],this.AutoLimit=n.Speed0,this.FightLimit=n.Speed0,this.WeaponHight=110,this.BorderCount=4,this.BulletRadius=25,this.FireCD=180,this.compensate=0,this.MapCompensate=new Map,this.IsDrill=!1,this.BombId="",this.Round=101,this.BulletCount=0,this.NetUp=0,this.NetDown=0,this.winScale=cc.v2(1,1),this.IsAuto=!1,this.IsLock=!1,this.HeartBeatCD=0,this.MapAtlas=new Map,this.MapSwims=new Map,this.MapDieanis=new Map,this.MapEffects=new Map,this.diamond=0,this.RoomBet=1,this.BLevel=0,this.BLevels=[1,2,3,4,5],this.CannonBets=[],this.seatId=-1,this.userId=-1,this.TableId=-1,this.Entries=0,this.Winning=0,this.users={},this.UIAtals=null}return Object.defineProperty(e,"once",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e.destroyInstance=function(){e._instance&&(e._instance=null,delete e._instance)},e}();o.FISHMANConst=i,function(e){e[e.Sprite=0]="Sprite",e[e.Atlas=1]="Atlas",e[e.Skeleton=2]="Skeleton",e[e.ParticleAsset=3]="ParticleAsset",e[e.Prefab=4]="Prefab",e[e.Json=5]="Json"}(o.GameLoadType||(o.GameLoadType={})),cc._RF.pop()},{}],FISHMANEffectLayer:[function(e,t,o){"use strict";cc._RF.push(t,"c6d02nKHZRPQ6QWUedqvKXP","FISHMANEffectLayer");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=e("../../../Script/utils/Utils"),l=cc._decorator,p=l.ccclass,h=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.an_waves=null,t.lb_fire=null,t.layer_recharge=null,t.sp_haicao=null,t.layer_paopao=[],t.bill_cd=0,t}return i(t,e),t.prototype.onLoad=function(){this.initEvents()},t.prototype.initEvents=function(){this.map_info=new Map;for(var e=0;e<4;e++)this.map_info.set(e,[]);for(this.map_sameinfo=new Map,e=0;e<4;e++)this.map_sameinfo.set(e,[]);for(this.lb_max=this.node.getChildByName("lb_max"),this.lb_ms=this.node.getChildByName("lb_ms").getComponent(cc.Label),e=0;e<this.layer_paopao.length;e++)for(var t=this.layer_paopao[e],o=0;o<t.children.length;o++)t.children[o].active=!1},t.prototype.showNetMs=function(){this.lb_ms.string="\u5ef6\u8fdf\uff1a"+(a.FISHMANConst.once.NetUp+a.FISHMANConst.once.NetDown)},t.prototype.prefixInteger=function(e,t){return(e/Math.pow(10,t)).toFixed(t).substr(2)},t.prototype.showLable=function(e){this.lb_fire.node.parent.active=e<-60;var t=Math.ceil(90+e)<0?0:Math.ceil(90+e);this.lb_fire.string="Since you have'nt fired in a minute, you will leave the game in "+t+" s"},t.prototype.showRecharge=function(){Common.showMessage("not enough balance")},t.prototype.onClickedCloseRechargeTip=function(){this.layer_recharge.active=!1,this.layer_recharge.opacity=255,this.layer_recharge.stopAllActions()},t.prototype.defaultLight=function(e){var t="0;0;1000".split(";"),o=t[0]||0,n=t[1]||0,i=e.convertToWorldSpaceAR(cc.v2(parseFloat(o+""),parseFloat(n+""))),s=t[2]||1500;this.initLight(i,s)},t.prototype.initLight=function(e,t){this.v2Light=e,this.lightHeight=parseFloat(t)},t.prototype.pushFishEffect=function(e,t,o,n){for(var i=0;i<e.length;i++){var s=r.default.deepCopy(o),a=e[i];a.alive&&(a.pushEffect(t,s),n&&s.fishId!==a.fishId&&(s.target=a.node.position,s.playSFX=0===i,s.end=i===e.length-1,c.default.once.GameLayer.addEffect(s)))}},t.prototype.addEffect=function(e){var t=this;if(cc.isValid(this.node)){var o=r.default.deepCopy(e);if(o.skillId===a.FISHMANEffectType.FULL_BOOM){c.default.once.playSFX("boom");for(var n=cc.view.getVisibleSize(),i=0;i<15;i++){var s=r.default.deepCopy(o),l=i%5*n.width*1/6+1*n.width/7-n.width/2,p=Math.floor(i/5)*n.height*1/4+1*n.height/4-n.height/2;s.position=cc.v2(l,.6*-n.height),s.delayTime=0,s.i=i,s.target=cc.v2(l,p),c.default.once.GameLayer.addEffect(s)}}if(o.skillId===a.FISHMANEffectType.PI_KA_QIU&&(c.default.once.playSFX("double"),c.default.once.GameLayer.addEffect(o)),o.skillId===a.FISHMANEffectType.PKQLight&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.FOOD&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.ZZBoom&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.ZZBoom4Child&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.ZZBoomBo&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.ZZBoomBoList&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.DIAN_WANG&&c.default.once.GameLayer.addEffect(o),o.skillId===a.FISHMANEffectType.Fast){o.duringTime=o.time||2,this.pushFishEffect(c.default.once.GameLayer.getFishs(),a.FISHMANEffectType.Fast,o);var h=cc.view.getVisibleSize().width/2-20;this.sp_haicao.node.stopAllActions(),this.sp_haicao.node.active=!0,this.sp_haicao.node.opacity=0;var d=-h-70,f=500/-d/2+3;d-=1e3;var u=cc.callFunc(function(){t.sp_haicao.node.setPosition(h,0),t.sp_haicao.node.opacity=255,c.default.once.GameLayer.changeSceneBg(o.now,o.anim,o.later)}),y=cc.callFunc(function(){t.sp_haicao.node.active=!1,c.default.once.sendChangeScene()}),I=[cc.delayTime(o.duringTime),u,cc.moveTo(f,cc.v2(d,0)),cc.delayTime(2),y];this.sp_haicao.node.runAction(cc.sequence(I))}if(o.skillId===a.FISHMANEffectType.Bill){o.index=c.default.once.tableConvertIndex(o.seatId),o.nid=r.default.generateMixed(20);var g=this.map_info.get(o.seatId)||[];o.position=c.default.once.GameLayer.WeaponLayer.getWeaponOutPositionByTid(o.seatId,0),o.position.y=o.index>1?o.position.y-138:o.position.y+138,o.limit=o.limit||o.type,g.push(o),this.map_info.set(o.seatId,g),this.checkPlayBill(o)}o.skillId===a.FISHMANEffectType.SamllBill&&(o.index=c.default.once.tableConvertIndex(o.seatId),o.nid=r.default.generateMixed(20),g=this.map_sameinfo.get(o.seatId)||[],cc.log("array  ",g,o.seatId),g.push(o),this.map_sameinfo.set(o.seatId,g))}},t.prototype.checkPlayBill=function(e){var t=this.map_info.get(e.seatId),o=function(e,t,o,n){for(var i=!0,s=0,a=0,c=0;c<e.length;c++)e[c].limit===t&&o!==e[c].nid&&(i=!1),e[c].limit===t&&s++,e[c].limit!==t||e[c].playing||a++;return i&&n||a===s&&0!==a};if(t)for(var n=0;n<t.length;n++){var i=t[n];o(t,i.limit,i.nid,!i.playing)&&(t[n].playing=!0,this.map_info.set(e.seatId,t),c.default.once.playSFX("bill_big"),c.default.once.GameLayer.addBill(t[n]))}},t.prototype.onFinishEffect=function(e){if(-1!==[a.FISHMANEffectType.Bill].indexOf(e.skillId)){for(var t=this.map_info.get(e.seatId),o=0;o<t.length;o++)if(t[o].nid===e.nid){t.splice(o,1);break}this.map_info.set(e.seatId,t),this.checkPlayBill(e)}},t.prototype.refreshSmallBill=function(){for(var e=this,t=function(t){var n=o.map_sameinfo.get(t);if(n.length>0){var i=o.layer_paopao[t];if(n.length>0&&n[0].show){var s=i.children[0];s.stopAllActions(),s.runAction(cc.sequence(cc.spawn(cc.fadeOut(.1),cc.scaleTo(.3,0,1)),cc.callFunc(function(){s.active=!1,i.removeChild(s),i.addChild(s),n.splice(0,1),e.map_sameinfo.set(t,n)})))}for(var c=0;c<4;c++){var r=i.children[c];r.scale=1,r.opacity=255,r.active=n.length>c,n.length>c&&(r.getComponent(cc.Sprite).spriteFrame=a.FISHMANConst.once.MapAtlas.get("paopao").getSpriteFrame("smallFood"+n[c].fid),r.getChildByName("lb").getComponent("FISHMANLabel").string=n[c].award,n[c].show||(r.opacity=0,r.stopAllActions(),r.runAction(cc.fadeIn(.3))),n[c].show=!0)}}},o=this,n=0;n<4;n++)t(n)},t.prototype.updateShadowEffect=function(e,t){var o=e.x-this.v2Light.x,n=e.y-this.v2Light.y,i=cc.v2(0,0),s=e.sub(this.v2Light).mag(),a=(t+this.lightHeight)*s/this.lightHeight;return i.x=e.x+o*(a/s-1),i.y=e.y+n*(a/s-1),i},t.prototype.update=function(e){this.bill_cd-=e,this.bill_cd<0&&(this.bill_cd=1,this.refreshSmallBill())},t.prototype.onDestroy=function(){},s([h(cc.Animation)],t.prototype,"an_waves",void 0),s([h(cc.Label)],t.prototype,"lb_fire",void 0),s([h(cc.Node)],t.prototype,"layer_recharge",void 0),s([h(sp.Skeleton)],t.prototype,"sp_haicao",void 0),s([h([cc.Node])],t.prototype,"layer_paopao",void 0),s([p],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANEffect:[function(e,t,o){"use strict";cc._RF.push(t,"e005aO/mFhDNJ9XJts8oJ10","FISHMANEffect");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../../../Script/utils/Utils"),c=e("./FISHMANConst"),r=e("./FISHMANFish"),l=e("./FISHMANManager"),p=cc._decorator,h=p.ccclass,d=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"an_effect",{get:function(){var e=this.node.getChildByName("an_effect").getComponent(cc.Animation);return e.on("finished",this.onFinishAnimate,this),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"an_1",{get:function(){return this.node.getChildByName("sp_1").getComponent(cc.Animation)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"an_0",{get:function(){return this.node.getChildByName("sp_0").getComponent(cc.Animation)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"an_2",{get:function(){return this.node.getChildByName("sp_2").getComponent(cc.Animation)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.sp_effect=this.node.getChildByName("an_effect").getComponent(cc.Sprite),this.sp_2=this.node.getChildByName("sp_2").getComponent(cc.Sprite),this.sp_1=this.node.getChildByName("sp_1").getComponent(cc.Sprite),this.sp_0=this.node.getChildByName("sp_0").getComponent(cc.Sprite),this.sp_3=this.node.getChildByName("sp_3").getComponent(cc.Sprite),this.sp_0.node.on("click",this.onClickedEffect,this)},t.prototype.init=function(e){var t=this;this.node.position=e.position||cc.v2(0,0),this.node.angle=0,this.node.active=!0,e.parent=!1,this.node.zIndex=0,this.param=e,this.node.scale=1,this.node.stopAllActions(),this.node.opacity=255,this.sp_0.node.children[0].active=!1,this._enableUpdate=!1;for(var o=0;o<this.node.children.length;o++){var n=this.node.children[o].getComponent(cc.Sprite),i=this.node.children[o].getComponent(cc.Animation);i.stop(),i.pause(),n.node.active=!0,n.spriteFrame=null,n.node.scale=1,n.node.stopAllActions(),n.node.opacity=255,n.node.color=cc.Color.WHITE,n.node.rotation=0,n.node.anchorX=.5,n.node.setPosition(0,0)}if(e.skillId===c.FISHMANEffectType.FOOD){this.sp_2.spriteFrame=c.FISHMANConst.once.MapAtlas.get("effects4").getSpriteFrame("RedTurntable"),this.sp_2.node.setPosition(0,-85),this.sp_2.node.runAction(cc.rotateBy(3,180)),this.sp_3.spriteFrame=c.FISHMANConst.once.MapAtlas.get("effects4").getSpriteFrame("29hand"),this.sp_3.node.setPosition(0,-77);var s=l.default.once.getEffectByType("die29_");s.wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(s),this.an_effect.play(s.name),this.node.opacity=0,this.node.runAction(cc.sequence(cc.fadeIn(.15),cc.delayTime(2),cc.callFunc(function(){t.onFinishEffect()})))}var p="",h=cc.WrapMode.Normal;if(e.skillId===c.FISHMANEffectType.FULL_BOOM){l.default.once.playSFX("boom");var d=l.default.once.getEffectByType("spBullet_unmatchedBomb_");d.wrapMode=cc.WrapMode.Loop,this.an_2.addClip(d),this.an_2.play(d.name);var f=l.default.once.getEffectByType("unmatchedBombEff_");f.wrapMode=cc.WrapMode.Normal,this.an_effect.addClip(f),this.node.runAction(cc.sequence(cc.delayTime(e.delayTime),cc.moveTo(1,e.target),cc.callFunc(function(){t.an_2.node.active=!1,t.an_effect.play(f.name)})))}if(e.skillId==c.FISHMANEffectType.ZZBoom){l.default.once.playSFX("boss"),this.sp_0.node.children[0].active=!0,this.angle=e.angle;var u=l.default.once.getEffectByType("octopusBombM_");if(u.wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(u),this.an_effect.play(u.name),this.an_effect.node.angle=180,this._lastUpdateTime=this._initTime=Date.now(),this._enableUpdate=!0,e.seatId==c.FISHMANConst.once.seatId){var y=l.default.once.GameLayer.getUserByTable(e.seatId);y&&y.showZZ(!0)}}if(e.skillId==c.FISHMANEffectType.ZZBoomBo){this.sp_0.spriteFrame=c.FISHMANConst.once.MapAtlas.get("effects2").getSpriteFrame("Firework4_c"),this.sp_0.node.scale=4;var I=[cc.v2(-150,-150),cc.v2(-150,150),cc.v2(150,-150),cc.v2(150,150),cc.v2(0,0)];this.sp_0.node.runAction(cc.sequence(cc.spawn(cc.rotateBy(1.5,480),cc.scaleTo(1.5,1)),cc.callFunc(function(){t.sp_0.spriteFrame=null,l.default.once.playSFX("effect_205");for(var o=a.default.deepCopy(e),n=0;n<I.length;n++)o.position=cc.v2(t.node.x+I[n].x,t.node.y+I[n].y),o.i=n,o.skillId=c.FISHMANEffectType.ZZBoomBoList,l.default.once.GameLayer.EffectLayer.addEffect(o);t.onFinishEffect()})))}if(e.skillId==c.FISHMANEffectType.ZZBoomBoList){this.sp_0.spriteFrame=c.FISHMANConst.once.MapAtlas.get("effects2").getSpriteFrame("Firework3_c");var g=l.default.once.getEffectByType("explosionEff1_");g.wrapMode=cc.WrapMode.Normal,this.an_effect.addClip(g),this.an_effect.play(g.name),this.an_effect.node.scale=2.5,this.sp_0.node.opacity=0,this.sp_0.node.scale=0,this.sp_0.node.runAction(cc.sequence(cc.spawn(cc.scaleTo(.5,1),cc.fadeIn(.1)),cc.delayTime(1),cc.callFunc(function(){t.onFinishEffect()})))}if(e.skillId==c.FISHMANEffectType.DIAN_WANG){this.sp_3.spriteFrame=c.FISHMANConst.once.MapAtlas.get("effects1").getSpriteFrame("lightningSmall_c"),this.sp_3.node.scale=2;var F=[];for(o=0;o<10;o++){var v=o%2?255:150;F.push(cc.fadeTo(.5,v)),F.push(cc.callFunc(function(){l.default.once.CmdFISHMANDW(t.param,!1)}))}this.sp_3.node.runAction(cc.spawn(cc.sequence(F),cc.rotateBy(4,90)));var _=l.default.once.getEffectByType("lightningCross_");_.wrapMode=cc.WrapMode.Loop,this.an_2.addClip(_),this.an_2.play("lightningCross_");var m=l.default.once.getEffectByType("LightningCircle_");m.wrapMode=cc.WrapMode.Loop,this.an_effect.addClip(m),this.an_effect.play("LightningCircle_"),this.an_effect.node.setScale(.5);var S=l.default.once.getEffectByType("LightningCircle_");S.wrapMode=cc.WrapMode.Loop,this.an_1.addClip(S),this.an_1.play("LightningCircle_");var A=l.default.once.getEffectByType("LightningCircle_");A.wrapMode=cc.WrapMode.Loop,this.an_0.addClip(A),this.an_0.play("LightningCircle_"),this.an_0.node.scale=1.25,this.scheduleOnce(function(){t.onFinishEffect()},4)}if(e.skillId==c.FISHMANEffectType.LOCAL_BOOM&&(p="unmatchedBombEff_",this.an_effect.node.scale=2,this.node.position=e.position,h=cc.WrapMode.Normal,this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){t.onFinishEffect()})))),e.skillId==c.FISHMANEffectType.PKQLight){var N=l.default.once.getEffectByType("ChainLightningEff_");N.wrapMode=cc.WrapMode.Loop,this.an_effect.node.scale=1,this.an_effect.addClip(N),this.an_effect.play(N.name),this.an_effect.node.runAction(cc.sequence(cc.delayTime(4),cc.callFunc(function(){t.onFinishEffect()})))}if(e.skillId==c.FISHMANEffectType.PI_KA_QIU){var M=cc.v2(e.to.x,e.to.y).sub(cc.v2(e.position.x,e.position.y)).mag(),C=M<165?165:M<415?415:M<830?830:1245,b="singleLightningEff"+(M<165?0:M<415?1:M<830?2:3)+"_",H=l.default.once.getEffectByType(b);H.wrapMode=cc.WrapMode.Loop,this.an_effect.node.anchorX=0,this.an_effect.addClip(H);var L=M/C;this.an_effect.node.scaleX=L;var B=l.default.once.convertPointToAngle(e.to,e.position);this.node.angle=-B,this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(e.delay),cc.fadeIn(.01),cc.callFunc(function(){t.an_effect.play(H.name)}),cc.delayTime(.5),cc.callFunc(function(){var o=l.default.once.getFishByFishId(e.fishId);o instanceof r.default&&(o.playDieAni(),e.position=e.coinPosition,l.default.once.addResultCoin(e)),t.an_effect.stop(),t.onFinishEffect()})))}if(""!=p){var w=l.default.once.getEffectByType(p);w.wrapMode=h,this.an_effect.addClip(w),this.an_effect.play(w.name)}},t.prototype.onFinishAnimate=function(){this.onFinishEffect()},t.prototype.onFinishEffect=function(){l.default.once.GameLayer.EffectLayer.onFinishEffect(this.param),l.default.once.GameLayer.despawnEffect(this),this.param.skillId===c.FISHMANEffectType.FULL_BOOM&&0==this.param.i&&this.param.seatId==c.FISHMANConst.once.seatId&&l.default.once.CmdFISHMANBigBomb(this.param)},t.prototype.onClickedEffect=function(){this.param&&this.param.clicked},t.prototype.clean=function(){this.unscheduleAllCallbacks(),this.node.stopAllActions(),this.param&&(this.param.clicked=!0);for(var e=0;e<this.node.children.length;e++){var t=this.node.children[e].getComponent(cc.Sprite);t.spriteFrame=null,t.node.stopAllActions(),t.node.removeComponent(cc.Animation),t.node.addComponent(cc.Animation)}},t.prototype.setOutPosition=function(e){this.angle=e.angle,this.node.x+=e.x,this.node.y+=e.y},t.prototype.zzBoom=function(){var e=this;this.sp_0.node.children[0].active=!1,this._enableUpdate=!1;var t=a.default.deepCopy(this.param);t.position=this.node.position,t.skillId=c.FISHMANEffectType.ZZBoomBo,l.default.once.GameLayer.EffectLayer.addEffect(t),this.node.runAction(cc.sequence(cc.fadeOut(1),cc.callFunc(function(){e.onFinishEffect()})))},t.prototype.update=function(){if(this._enableUpdate){var e=Date.now(),t=(e-this._lastUpdateTime)/1e3;this._lastUpdateTime=e,(e-this._initTime)/1e3>5&&this.param.skillId==c.FISHMANEffectType.ZZBoom&&(this._enableUpdate=!1,this.param.seatId==c.FISHMANConst.once.seatId&&l.default.once.CmdZZBoom(this));var o=cc.v2(.5*c.FISHMANConst.once.BulletSpeed.x,.5*c.FISHMANConst.once.BulletSpeed.y),n=l.default.once.calculateSpacePoint({angle:this.angle,space:t,speed:o});this.node.x+=n.x,this.node.y+=n.y;var i=l.default.once.convertPositionAngle({x:this.node.x,y:this.node.y,angle:this.angle});i.out&&this.setOutPosition(i),this.node.angle=-this.angle}},s([h],t)}(cc.Component));o.default=d,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANConst":"FISHMANConst","./FISHMANFish":"FISHMANFish","./FISHMANManager":"FISHMANManager"}],FISHMANFishNet:[function(e,t,o){"use strict";cc._RF.push(t,"ec512ZDyAVPfb2e/+4huILQ","FISHMANFishNet");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.netRedius=70,t}return i(t,e),t.prototype.onLoad=function(){this.sp_net=this.node.getComponent(cc.Sprite),this.an_net=this.node.getComponent(cc.Animation);for(var e=1;e<=4;e++)for(var t=1;t<=4;t++){var o=c.default.once.getEffectByType("Net"+e+"_"+t+"_");o.wrapMode=cc.WrapMode.Normal,this.an_net.addClip(o)}this.an_net.on("finished",this.onFinishNet,this)},t.prototype.onFinishNet=function(){c.default.once.GameLayer?c.default.once.GameLayer.despawnNet(this):this.node.destroy()},t.prototype.init=function(e,t,o,n){this.node.position=this.node.parent.convertToNodeSpaceAR(e),this.node.active=!0,this.node.angle=o,this.sp_net.spriteFrame=null,(t+=1)>4&&(t=4),t<1&&(t=1),this.an_net.play("Net"+(n+1)+"_"+t+"_"),this.node.opacity=255,this.node.scale=.8;var i=[],s=cc.scaleTo(a.FISHMANConst.once.NetMaxTime,.9);i.push(s);var c=cc.scaleTo(2*a.FISHMANConst.once.NetMaxTime/3,.8);i.push(c),i.push(cc.fadeOut(.1));var r=cc.callFunc(this.onFinishNet.bind(this));i.push(r),this.node.runAction(cc.sequence(i))},t.prototype.onDestroy=function(){this.an_net.clear()},s([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANFish:[function(e,t,o){"use strict";cc._RF.push(t,"d0c0cdxYp9MyaByikNBrbll","FISHMANFish");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../../../Script/utils/Utils"),c=e("./FISHMANConst"),r=e("./FISHMANManager"),l=cc._decorator,p=l.ccclass,h=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fid=-1,t.fishId=-1,t.index=-1,t._state=c.FISHMANFishStatus.Die,t._outBorder=!1,t.skillId=-1,t.enbaleMove=!0,t.lastPosition=null,t.initTime=0,t._lastUpdateTime=0,t.swimTime=10,t.leaveTime=0,t.mapEffects=new Map,t.radius=0,t.dieCD=0,t}return i(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e,this.checkLock()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outBorder",{get:function(){return this._outBorder},set:function(e){this._outBorder=e,this.checkLock()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.initView()},t.prototype.initView=function(){this.sp_fish=this.node.getChildByName("sp_fish").getComponent(cc.Sprite),this.sp_effect=this.node.getChildByName("sp_effect").getComponent(cc.Sprite),this.sp_shadow=this.node.getChildByName("sp_shadow").getComponent(cc.Sprite),this.an_fish=this.sp_fish.node.getComponent(cc.Animation),this.an_effect=this.sp_effect.node.getComponent(cc.Animation),this.an_fish.on("finished",this.onFinishAnimate,this),this.sp_fish.node.on(cc.Node.EventType.TOUCH_START,this.onClickFish,this),this.sp_effect.node.on(cc.Node.EventType.TOUCH_START,this.onClickFish,this)},t.prototype.onClickFish=function(e){r.default.once.GameLayer.WeaponLayer.onTouchStart(e,this)},t.prototype.init=function(e){this.params=e,this.node.active=!0,this.flipY=c.FISHMANConst.once.seatId>1,this.fid=e.fid,this.fishId=e.fishId,this.index=e.index,this.skillId=e.skillId,this.swimTime=e.pathInterval,this.initTime=Date.now()-e.compensate-1e3*e.swimmingInterval,this.config=e.config,this.FishPath=e.FishPath;var t=e.groups.points[this.index];if(this.gpoint=cc.v2(e.groups.origin.x+t.x,e.groups.origin.y+t.y),this.colliders=e.conlliderPoints,this.resetInfo(),this.refreshSwimAni(),this.an_fish.play(this.params.swimAni.name),18==e.config.fishType||19==e.config.fishType){this.an_fish.node.runAction(cc.repeatForever(cc.rotateBy(2,360)));for(var o=1;o<4;o++){var n=this.node.getChildByName("sp_fish"+o).getComponent(cc.Animation);n.node.active=!0;var i=a.default.randomNum(0,14),s=r.default.once.getSwimAnimateByID(i);s.wrapMode=cc.WrapMode.Loop,n.addClip(s),n.play(s.name)}}else this.an_fish.node.stopAllActions(),this.an_fish.node.angle=0;this.node.runAction(cc.fadeIn(.1))},t.prototype.refreshSwimAni=function(){for(var e=[this.params.swimAni,this.params.dieAni,this.params.iceAni],t=0;t<e.length;t++){var o=e[t];o.wrapMode=1==t?cc.WrapMode.Normal:cc.WrapMode.Loop,this.an_fish.addClip(o),this.an_fish.play(o.name)}},t.prototype.getColliderPoints=function(){for(var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=[],o=0;o<this.colliders.length;o++)t.push(cc.v2(e.x+this.colliders[o].x,e.y+this.colliders[o].y));return{ws:t,zIndex:this.node.zIndex}},t.prototype.resetInfo=function(){this.node.scale=1,this.sp_fish.spriteFrame=null,this.sp_shadow.spriteFrame=null,this.node.opacity=0,this.sp_fish.node.color=cc.Color.WHITE,this.an_fish.node.stopAllActions(),this._lastUpdateTime=Date.now(),this.setState(c.FISHMANFishStatus.Live),this.dieCD=9999999999,this.outBorder=r.default.once.checkLimitBorder(this.node),this.cleanLockWeapons(),this.enbaleMove=!0,this.mapEffects=null,this.mapEffects=new Map,this.node.zIndex=parseFloat(this.config.Layer||0),this.leaveTime=this.swimTime,this.node.angle=this.FishPath.scale<0?180:0;var e=parseFloat(this.config.Scale),t=this.FishPath.scale*parseFloat(this.config.Scale);this.sp_fish.node.setScale(e,t),this.sp_shadow.node.setScale(e,t);for(var o=1;o<4;o++)this.node.getChildByName("sp_fish"+o).active=!1;var n=r.default.once.convertWindowScale();for(o=0;o<this.colliders.length;o++){var i=this.colliders[o],s=i.x*e*n.x,a=i.y*t*n.y;this.radius=Math.max(this.radius,cc.v2(s,a).mag())}this.lastPosition=cc.v2(this.FishPath.points[0].x,this.FishPath.points[0].y),this.node.setPosition(this.lastPosition.x,this.lastPosition.y)},t.prototype.animateFrameChange=function(){this.setShadowSpriteFrame()},t.prototype.getShadowWorldPoint=function(){return this.sp_shadow.node.convertToWorldSpaceAR(cc.v2(0,0))},t.prototype.getWorldPoint=function(){var e={1053:cc.v2(130,0),1036:cc.v2(200,0),1038:cc.v2(50,0),1047:cc.v2(70,0),1019:cc.v2(70,0),1039:cc.v2(100,0)}[this.fid]||cc.v2(0,0);return this.node.convertToWorldSpaceAR(e)},t.prototype.setShadowSpriteFrame=function(){if(this.sp_shadow.spriteFrame!=this.sp_fish.spriteFrame){var e=2!=this.config.propFish&&this.sp_effect.node.active?.5:1;this.sp_shadow.node.scaleX=e*this.sp_shadow.node.scaleX,this.sp_shadow.node.scaleY=e*this.sp_shadow.node.scaleY,this.sp_shadow.spriteFrame=this.sp_effect.node.active?this.sp_effect.spriteFrame:this.sp_fish.spriteFrame}},t.prototype.updateShadowEffect=function(){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=r.default.once.GameLayer.EffectLayer.updateShadowEffect(e,parseFloat(this.config.Layer)),o=this.sp_shadow.node.parent.convertToNodeSpaceAR(t);this.sp_shadow.node.setPosition(o.x,o.y),this.setShadowSpriteFrame()},t.prototype.getSwimF=function(e){return e-this.initTime},t.prototype.pushEffect=function(e,t){if(e===c.FISHMANEffectType.Ice&&(this.mapEffects.set(e,{init:Date.now(),duringTime:t.duringTime}),this.an_fish.play(this.params.iceAni.name)),e===c.FISHMANEffectType.Fast){var o=this.leaveTime/t.duringTime;this.mapEffects.set(e,o)}},t.prototype.runCurrent=function(e,t){e.currentClip&&e[t](e.currentClip.name)},t.prototype.popEffect=function(e){this.mapEffects.get(e)&&(this.mapEffects.delete(e),e===c.FISHMANEffectType.Ice&&(this.alive?this.an_fish.play(this.params.swimAni.name):this.playDieAni()))},t.prototype.setState=function(e){this.state=e},t.prototype.onFinishAnimate=function(){var e=this.an_fish.currentClip;e&&-1!==e.name.indexOf("die")&&this.despawnFish()},t.prototype.pushLockSeat=function(e){return-1===this.lockWeapons.indexOf(e)&&(this.lockWeapons.push(e),!0)},t.prototype.popLockTid=function(e){var t=this.lockWeapons.indexOf(e);-1!==t&&this.lockWeapons.splice(t,1)},t.prototype.cleanLockWeapons=function(){this.lockWeapons=[]},t.prototype.calculateFPoint=function(e){if(e<=1){var t=Math.ceil(this.FishPath.points.length*e);t>this.FishPath.points.length-1&&(t=this.FishPath.points.length-1);var o=this.FishPath.points[t],n=o.y+this.gpoint.y;this.flipY&&(n=-n);var i=this.gpoint.x+o.x;return cc.v2(i*c.FISHMANConst.once.winScale.x,n*c.FISHMANConst.once.winScale.y)}return cc.v2(1e5,1e5)},t.prototype.updateDegree=function(){var e=cc.v2(this.node.x,this.node.y),t=r.default.once.convertPointToAngle(e,this.lastPosition);this.node.angle=-t,this.lastPosition=e},t.prototype.beAttack=function(){var e=this;this.sp_fish.node.color=cc.Color.BLACK.fromHEX("#FD8484"),this.node.stopActionByTag(c.FISHMANConst.once.FishAttackAniTag);var t=cc.sequence([cc.delayTime(c.FISHMANConst.once.FishRedDuring),cc.callFunc(function(){e.sp_fish.node.color=cc.Color.WHITE})]);t.setTag(c.FISHMANConst.once.FishAttackAniTag),this.node.runAction(t)},t.prototype.playDieAni=function(){this.an_fish.play(this.params.dieAni.name)},t.prototype.goDie=function(){this.enbaleMove=!1,this.dieCD=5,this.setState(c.FISHMANFishStatus.Die)},Object.defineProperty(t.prototype,"alive",{get:function(){return this.state===c.FISHMANFishStatus.Live},enumerable:!1,configurable:!0}),t.prototype.checkDespawn=function(){this.leaveTime<0&&this.despawnFish()},t.prototype.clearLock=function(){r.default.once.GameLayer.clearLockFishAllBullet(this.fishId),r.default.once.GameLayer.WeaponLayer.cleanFishAllWeaponLock(this),this.cleanLockWeapons()},t.prototype.despawnFish=function(){this.sp_effect.node.stopAllActions(),this.clearLock(),this.unscheduleAllCallbacks(),this.mapEffects=new Map;var e=this.an_fish.getClips();if(e)for(var t=e.length-1;t>=0;t--)this.an_fish.removeClip(e[t],!0);var o=this.an_effect.getClips();if(o)for(t=0;t<o.length;t++)this.an_effect.removeClip(o[t],!0);this.an_effect.node.stopAllActions(),this.node.active=!1,r.default.once.GameLayer?r.default.once.GameLayer.despawnFish(this):this.node.destroy()},t.prototype.checkLock=function(){this.outBorder&&this.alive||this.clearLock()},t.prototype.updateEffect=function(e){var t=this,o=e;if(this.mapEffects.size<=0)return o;var n=Date.now();return this.mapEffects.forEach(function(e,i){var s=t.mapEffects.get(i);i===c.FISHMANEffectType.Fast&&(o*=s),i==c.FISHMANEffectType.Ice&&((n-s.init)/1e3>=s.duringTime&&t.popEffect(i),o=0)}),o},t.prototype.updatexxx=function(e){if(-1!==this.fid){var t=this.updateEffect(e);if(this.enbaleMove){var o=this.updateTime(t);this.updatePonint(o)}(this.dieCD-=e)<0&&this.despawnFish(),this.lastPosition.sub(cc.v2(this.node.x,this.node.y)).mag()>2&&("1"===this.config.Rotation&&this.updateDegree(),this.updateShadowEffect()),this.outBorder=r.default.once.checkLimitBorder(this.node),this.updateLockWeapon()}},t.prototype.updateTime=function(e,t){void 0===t&&(t=!0);var o=this._lastUpdateTime+1e3*e;t&&(this._lastUpdateTime=o);var n=this.getSwimF(o)/1e3;return this.leaveTime=this.swimTime-n,n/this.swimTime},t.prototype.updatePonint=function(e){if(e<=1){var t=this.calculateFPoint(e);this.node.x=t.x,this.node.y=t.y}else this.checkDespawn()},t.prototype.updateLockWeapon=function(){this.lockWeapons.length>0&&r.default.once.showLockLineByTid(this,this.lockWeapons)},t.prototype.onDestroy=function(){},s([p],t)}(cc.Component));o.default=h,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANLabel:[function(e,t){"use strict";cc._RF.push(t,"f3e9aDDe55DY4CfJfAQ1Cvo","FISHMANLabel");var o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2});cc.Class({editor:!1,extends:cc.Component,properties:{_layout:{get:function(){var e=this.node.getComponent(cc.Layout);return e||((e=this.node.addComponent(cc.Layout)).type=1),e}},string:{default:"",notify:function(){this._updateWordArt()}},alignType:{type:o,default:o.CENTER,notify:function(){this._checkAnchorX()}},defaultNames:{default:"2"},spriteAtlas:{type:cc.SpriteAtlas,default:null}},onLoad:function(){this._checkAnchorX()},_checkAnchorX:function(){this.alignType===o.CENTER?this.node.anchorX=.5:this.node.anchorX=this.alignType===o.RIGHT?1:0},_updateWordArt:function(){if(!this.spriteAtlas)return cc.log("\u65e0\u6548\u7684 spriteAtlas \u56fe\u96c6\u8d44\u6e90\uff01");this._names=this.defaultNames.split(","),this.setWordArt()},setWordArt:function(){try{for(var e=(""+this.string).split(""),t=this.node.children,n=0,i=0;i<e.length||i<t.length;i++){var s=t[i];if(s||((a=(s=new cc.Node).addComponent(cc.Sprite)).trim=!0,a.sizeMode=cc.Sprite.SizeMode.TRIMMED,a.type=cc.Sprite.Type.SIMPLE),s.parent||(s.parent=this.node),s.active=i<e.length,s.active){var a=s.getComponent(cc.Sprite),c=e[this.alignType!==o.CENTER?e.length-1-i:i];if(c=this._names[0]+c,this._names[1]&&(c+=this._names[1]),void 0===c)return void cc.log("\u56fe\u96c6\u8d44\u6e90spriteAtlas \u627e\u4e0d\u5230\u56fe\u7247\u540d\u79f0\uff1a"+c+"\uff01");a.spriteFrame=this.spriteAtlas.getSpriteFrame(""+c),n+=s.width}}n+=(e.length+1)*this._layout.spacingX,this._layout.paddingLeft=this._layout.spacingX,this._layout.paddingRight=this._layout.spacingX,this.node.width=n,this.alignType===o.RIGHT&&(this._layout.horizontalDirection=1),this.alignType===o.LEFT&&(this._layout.horizontalDirection=1),this.alignType===o.CENTER&&(this._layout.horizontalDirection=0)}catch(r){console.log(r)}}}),cc._RF.pop()},{}],FISHMANLoading:[function(e,t,o){"use strict";cc._RF.push(t,"a0b3en5nmVDuacDTYtOVWju","FISHMANLoading");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../../../Script/utils/Utils"),c=e("./FISHMANConst"),r=cc._decorator,l=r.ccclass,p=r.property,h=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.boom=null,e.boss=null,e.double=null,e.bill_big=null,e.effect_101=null,e.effect_205=null,e.click=null,e.back=null,e.bill_min=null,e.die=null,e.die_big=null,e.die_small=null,e.effect_108=null,e.gold=null,e.gold_effect=null,e.gold_small=null,e.lock=null,e.weapon_change=null,e.v1=null,e.v2=null,e.v3=null,e.v4=null,e.v5=null,e.v6=null,e.v7=null,e.v8=null,e.v9=null,e.bg0=null,e.bg1=null,e.bg2=null,e.configs=[],e.fishs=[],e.effectArr=[],e.billSPS=[],e}return i(o,t),o.prototype.onLoad=function(){c.FISHMANConst.once.PlayerInfo=e("PlayerInfo").getInstant,c.FISHMANConst.once.PlayerInfo.fishBetList&&(c.FISHMANConst.once.BLevels=c.FISHMANConst.once.PlayerInfo.fishBetList),c.FISHMANConst.once.RoomBet=c.FISHMANConst.once.PlayerInfo.RoomBet,this.loadFinish()},o.prototype.loadFinish=function(){c.FISHMANConst.once.FishConfigs=this.configs[1].json;var e=this.configs[2].json.data,t=this.configs[0].json;c.FISHMANConst.once.FishGroups=t.data,c.FISHMANConst.once.FishPoints=this.configs[3].json;var o=[],n=[];c.FISHMANConst.once.FishPath=[];for(var i=0;i<300&&!(e.length<=i);i++){for(var s=e[i],r=[],l=0;l<=1500;l++){var p=l/1500,h=this.makeBreakBezier2(p,s.points,s.controls);r.push(h)}s.time=s.time>30?30:s.time,c.FISHMANConst.once.FishPath.push({id:s.id,points:r,time:s.time,scale:1})}var d=["bubble_","electricBomb_","energyCannon_","fireFrameEff_","LightningCircle_","octopusBomb_","unmatchedBomb_","unmatchedBombEff_","unmatchedBombTip_","ChainLightningEff_","explosionEff1_","Firework1_","singleLightningEff_","broken_blue_","broken_red_","buleLightEff_","ChainLightningWinEff_","lightningCross_","luckyEff1_","octopusBombM_","octopusWinEff_","rainbowLightEff_","treasure_","singleLightningEff0_","singleLightningEff1_","singleLightningEff2_","singleLightningEff3_","MysteriousDinner_","30star_","die29","twinkle29_","gameLogo_en_","die29_","Net1_1_","Net1_2_","Net1_3_","Net1_4_","Net2_1_","Net2_2_","Net2_3_","Net2_4_","Net3_1_","Net3_2_","Net3_3_","Net3_4_","Net4_1_","Net4_2_","Net4_3_","Net4_4_",{key:"Fire1_",space:25},{key:"Fire2_",space:25},{key:"Fire3_",space:25},{key:"Fire4_",space:25},{key:"Gun1_",space:10},{key:"Gun2_",space:10},{key:"Gun3_",space:10},{key:"Gun4_",space:10},{key:"spBullet_electricBomb_",space:25},{key:"spBullet_unmatchedBomb_",space:25}],f=[];for(i=0;i<this.fishs.length;i++)if((y=this.fishs[i])instanceof cc.SpriteAtlas){o.push(y.getSpriteFrames());var u=y.name.split(".")[0];c.FISHMANConst.once.MapAtlas.set(u,y)}for(i=0;i<this.effectArr.length;i++){var y;(y=this.effectArr[i])instanceof cc.SpriteAtlas&&("paotai"==(u=y.name.split(".")[0])&&(c.FISHMANConst.once.UIAtals=y),n.push(y.getSpriteFrames()),c.FISHMANConst.once.MapAtlas.set(u,y))}for(i=0;i<f.length;i++){var I=f[i];c.FISHMANConst.once.MapEffects.set(I,this[I])}var g=c.FISHMANConst.once.FishConfigs;for(i=0;i<g.length;i++){var F=g[i],v=(I=F.FishID,"1"===F.AnimType?c.GameLoadType.Skeleton:c.GameLoadType.Atlas);if(v===c.GameLoadType.Atlas){F.SwimActFPS=parseInt(F.SwimActFPS);var _=this.getAni(o,I+"_",v,cc.WrapMode.Loop,F.SwimActFPS);c.FISHMANConst.once.MapSwims.set(I,_);var m=this.getAni(o,"frozen"+I,v,cc.WrapMode.Loop,F.SwimActFPS);c.FISHMANConst.once.MapEffects.set("frozen"+I,m);var S=this.findArrayFile(o,"die"+I+"_",v);S=this.desArray(S,["die"+I+"_"]);var A="-1"==F.DeadActFPS?F.SwimActFPS:parseInt(F.DeadActFPS);0==S.length&&(S=this.findArrayFile(o,I+"_",v));var N=a.default.createWithSpriteFrames(S,A,"animateFrameChange",null);N.name="die"+I+"_",N.wrapMode=cc.WrapMode.Normal,c.FISHMANConst.once.MapDieanis.set(I,N)}else _="sk_"+I,c.FISHMANConst.once.MapSwims.set(I,this[_])}for(i=0;i<d.length;i++){var M=d[i],C=(I="string"==typeof M?M:M.key,M.space||10),b=this.getAni(n,I,c.GameLoadType.Atlas,cc.WrapMode.Default,C);c.FISHMANConst.once.MapEffects.set(I,b)}},o.prototype.convertVectorToPoint=function(e,t,o){return cc.v2(e.x+-(e.x-t.x)*o,e.y+-(e.y-t.y)*o)},o.prototype.makeBreakBezier2=function(e,t,o){if(t&&t.length){if(e<=0)return t[0];if(e>=1)return t[t.length-1];for(var n=0,i=this.cheekVectorOrTimeIndex(t,e,!0),s=[t[i.index-1],o[i.index-1],t[i.index]];n<1e3;){n++;for(var a=s.length-1,c=0;c<a;c++)if(s[c]=this.convertVectorToPoint(s[c],s[c+1],i.f),c===a-1&&(s.splice(a,s.length),1===s.length))return s[0]}}},o.prototype.cheekVectorOrTimeIndex=function(e,t,o){for(var n=0,i=[],s=1;s<e.length;s++){var a=100;if(!o){var c=e[s-1],r=e[s];a=Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2),a=Math.sqrt(a)}i.push(a),n+=a}var l=0,p=0;for(s=0;s<i.length;s++){p=s+1;var h=n*t,d=l+(a=i[s]);if(l<h&&h<=d)return{index:p,f:1-(d-h)/a};l=d}return null},o.prototype.desArray=function(e,t){void 0===t&&(t=[]);var o=t.concat(["die"]);return e.sort(function(e,t){for(var n=e.name,i="",s=0;s<o.length;s++)if(-1!==n.indexOf(o[s])){i=o[s];break}var a=n.split(i);n=a[a.length-1];var c=t.name,r=c.split(i);c=r[r.length-1];var l=Math.ceil(n),p=Math.ceil(c);return l>p?1:l<p?-1:0}),e},o.prototype.findArrayFile=function(e,t,o){for(var n=[],i=null,s=0;s<e.length;s++){var r=e[s];if(o===c.GameLoadType.Atlas)if(r instanceof Array)for(var l=0;l<r.length;l++){var p=r[l],h=p.name.split(t);this.same(t,p.name)&&""==h[0]&&a.default.isNumber(h[1])&&n.push(p)}else this.same(t,r.name)&&(h=r.name.split(t),a.default.isNumber(h[1])&&""==h[0]&&n.push(r));else r.name&&-1!==r.name.indexOf(t)&&(i=r)}return o===c.GameLoadType.Atlas?n:i},o.prototype.same=function(e,t){e=e.split(""),t=t.split("");for(var o=0;o<e.length;o++)if(e[o]!=t[o])return!1;return!0},o.prototype.getAni=function(e,t,o,n,i,s,c,r){if(void 0===n&&(n=cc.WrapMode.Loop),void 0===s&&(s=null),void 0===c&&(c=1),void 0===r&&(r=[]),i=i||10,0==r.length&&(r=this.findArrayFile(e,t,o),r=this.desArray(r,[t]),1!==c)){for(var l=[],p=0;p<c;p++)for(var h=0;h<r.length;h++)l.push(r[h]);r=l}var d=a.default.createWithSpriteFrames(r,i,"animateFrameChange",s);return d.name=t,d.wrapMode=n,d},s([p(cc.AudioClip)],o.prototype,"boom",void 0),s([p(cc.AudioClip)],o.prototype,"boss",void 0),s([p(cc.AudioClip)],o.prototype,"double",void 0),s([p(cc.AudioClip)],o.prototype,"bill_big",void 0),s([p(cc.AudioClip)],o.prototype,"effect_101",void 0),s([p(cc.AudioClip)],o.prototype,"effect_205",void 0),s([p(cc.AudioClip)],o.prototype,"click",void 0),s([p(cc.AudioClip)],o.prototype,"back",void 0),s([p(cc.AudioClip)],o.prototype,"bill_min",void 0),s([p(cc.AudioClip)],o.prototype,"die",void 0),s([p(cc.AudioClip)],o.prototype,"die_big",void 0),s([p(cc.AudioClip)],o.prototype,"die_small",void 0),s([p(cc.AudioClip)],o.prototype,"effect_108",void 0),s([p(cc.AudioClip)],o.prototype,"gold",void 0),s([p(cc.AudioClip)],o.prototype,"gold_effect",void 0),s([p(cc.AudioClip)],o.prototype,"gold_small",void 0),s([p(cc.AudioClip)],o.prototype,"lock",void 0),s([p(cc.AudioClip)],o.prototype,"weapon_change",void 0),s([p(cc.AudioClip)],o.prototype,"v1",void 0),s([p(cc.AudioClip)],o.prototype,"v2",void 0),s([p(cc.AudioClip)],o.prototype,"v3",void 0),s([p(cc.AudioClip)],o.prototype,"v4",void 0),s([p(cc.AudioClip)],o.prototype,"v5",void 0),s([p(cc.AudioClip)],o.prototype,"v6",void 0),s([p(cc.AudioClip)],o.prototype,"v7",void 0),s([p(cc.AudioClip)],o.prototype,"v8",void 0),s([p(cc.AudioClip)],o.prototype,"v9",void 0),s([p(cc.AudioClip)],o.prototype,"bg0",void 0),s([p(cc.AudioClip)],o.prototype,"bg1",void 0),s([p(cc.AudioClip)],o.prototype,"bg2",void 0),s([p([cc.JsonAsset])],o.prototype,"configs",void 0),s([p([cc.SpriteAtlas])],o.prototype,"fishs",void 0),s([p([cc.SpriteAtlas])],o.prototype,"effectArr",void 0),s([p([cc.SpriteFrame])],o.prototype,"billSPS",void 0),s([l],o)}(cc.Component);o.default=h,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANConst":"FISHMANConst",PlayerInfo:void 0}],FISHMANManager:[function(e,t,o){"use strict";cc._RF.push(t,"469a7RPrytMXL+rmG8XCVTz","FISHMANManager");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANScene"),r=e("./FISHMANFish"),l=e("./FISHMANBullet"),p=e("../../../Script/utils/Utils"),h=e("./FISHMANNetWork"),d=cc._decorator,f=d.ccclass,u=d.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GameLayer=null,t.MusicDic={},t}var o;return i(t,e),o=t,Object.defineProperty(t,"once",{get:function(){return o.instance||(o.instance=new o),o.instance},enumerable:!1,configurable:!0}),t.destroyInstance=function(){o.instance&&(o.instance=null)},t.prototype.requestFishFire=function(e,t){var o=a.FISHMANConst.once.BLevels[a.FISHMANConst.once.BLevel],n=o*a.FISHMANConst.once.RoomBet,i=this.codePoint(e),s={userid:a.FISHMANConst.once.userId,bet:o,position:i,bulletId:p.default.generateMixed(20),isDrill:a.FISHMANConst.once.IsDrill};a.FISHMANConst.once.IsDrill?(s.bulletId=a.FISHMANConst.once.BombId,s.boomWay=10,s.boomPercent=50):t&&(s.fishId=t),n<=a.FISHMANConst.once.Entries?(this.ShotSelfBullet(s),h.default.once.send("fishShoot",s),a.FISHMANConst.once.IsDrill=!1):(a.FISHMANConst.once.IsLock&&this.GameLayer.MenuLayer.onClickedLock(),a.FISHMANConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(),this.GameLayer.EffectLayer.showRecharge(!0))},t.prototype.requestLeaveRoom=function(){h.default.once.requestLeaveRoom()},t.prototype.requestRechargeAll=function(){var e=this.getUser();e&&e.wins&&e.wins>10&&h.default.once.send("chargeAll",JSON.stringify({}))},t.prototype.requestRechargeSum=function(e){var t=this.getUser();t&&t.wins&&t.wins>e&&h.default.once.send("chargeAll",{sum:e})},t.prototype.heartBeat=function(){h.default.once.send("heart_beat",{})},t.prototype.requestShotTarget=function(e,t,o,n,i,s){void 0===o&&(o=1),void 0===i&&(i=!1);var c={uid:a.FISHMANConst.once.userId,fishId:e,bulletId:t,bulletType:o};n&&(c.lockFishId=n),i&&(c.format=1),s&&(c.from=s),h.default.once.send("fishHit",c)},t.prototype.requestChangeCannonBet=function(e){h.default.once.send("changePower",e)},t.prototype.rechargeAllResult=function(e){var t=this.userConvertSeatId(e.userId);a.FISHMANConst.once.users[t].score=e.score,a.FISHMANConst.once.users[t].wins=e.wins,e.userId==a.FISHMANConst.once.userId&&(this.GameLayer.showRecharge(!0),a.FISHMANConst.once.Entries=e.score,a.FISHMANConst.once.Winning=e.wins),this.GameLayer.updateBalance(e.userId,e.score),this.GameLayer.updateDiamond(e.userId,e.wins)},t.prototype.CmdFISHMANSmallBomb=function(e){cc.log("CmdFISHMANSmallBomb: "+JSON.stringify(e)),this.GameLayer.EffectLayer.addEffect({seatId:e.seatId,skillId:a.FISHMANEffectType.LOCAL_BOOM,position:e.position});var t=200*a.FISHMANConst.once.winScale.x,o=this.inCircleFishs(e.point,t);e.seatId===a.FISHMANConst.once.seatId&&o.fishId.length>0&&(cc.log("inCircleFishs:"+JSON.stringify(o.fishId)),this.requestShotTarget(o.fishId,e.bulletId,3))},t.prototype.CmdFISHMANDW=function(e,t){void 0===t&&(t=!0),cc.log("CmdFISHMANDW: "+JSON.stringify(e)),t&&(e.skillId=a.FISHMANEffectType.DIAN_WANG,this.GameLayer.EffectLayer.addEffect(e));var o=278*a.FISHMANConst.once.winScale.x,n=this.inCircleFishs(e.point,o);e.seatId===a.FISHMANConst.once.seatId&&n.fishId.length>0&&(cc.log("CmdFISHMANDW:"+JSON.stringify(n.fishId)),this.requestShotTarget(n.fishId,e.bulletId,3))},t.prototype.CmdFISHMANBigBomb=function(e){if(cc.log("CmdFISHMANBigBomb111: "+JSON.stringify(e)),e.seatId===a.FISHMANConst.once.seatId){var t=this.getBoomFishs();cc.log("CmdFISHMANBigBomb sss:"+JSON.stringify(t)),t.length>0&&this.requestShotTarget(t,e.bombId,3)}},t.prototype.CmdZZBoom=function(e){if(e.param.seatId===a.FISHMANConst.once.seatId){var t=400*a.FISHMANConst.once.winScale.x,o=this.inCircleFishs(e.node.convertToWorldSpaceAR(cc.v2(0,0)),t);o.fishId.length>0&&(cc.log("inCircleFishs:"+JSON.stringify(o.fishId)),this.requestShotTarget(o.fishId,e.param.bulletId,5)),h.default.once.send("broadcast",{bombId:e.param.bulletId,position:e.node.position,seatId:e.param.seatId})}},t.prototype.showNetError=function(e){cc.isValid(o.once.GameLayer.node)&&(o.once.GameLayer.MenuLayer.LayerNetError.active=e,a.FISHMANConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(!1))},t.prototype.broadcast=function(e){if(e&&e.userdata){e=JSON.parse(e.userdata);var t=o.once.GameLayer.findZZBoomEffect(e.seatId,e.bombId);t&&t.zzBoom();var n=this.GameLayer.getUserByTable(e.seatId);n&&n.showZZ(!1)}},t.prototype.CmdBYFishSeatChange=function(e,t){t&&(t.userId=t.UserId),a.FISHMANConst.once.users[e]=t,this.GameLayer.refreshTable(t)},t.prototype.CmdBYCannonChange=function(e){if(cc.log("CmdBYCannonChange: "+JSON.stringify(e)+",cg:"+typeof e),"string"==typeof e&&(e=JSON.parse(e)),e.userid==a.FISHMANConst.once.userId)for(var t=0;t<a.FISHMANConst.once.BLevels.length;t++)if(e.bet==a.FISHMANConst.once.BLevels[t]){a.FISHMANConst.once.BLevel=t;break}this.GameLayer.WeaponLayer.setWeaponGold(e.userid,e.bet),this.GameLayer.WeaponLayer.setLevelByUID(e.userid,e.bet)},t.prototype.CmdBYTable=function(e){var t=e.ResultData;a.FISHMANConst.once.seatId=t.seatId,a.FISHMANConst.once.userId=a.FISHMANConst.once.PlayerInfo.playerId,a.FISHMANConst.once.users={};for(var n=0;n<t.userList.length;n++){var i=t.userList[n];a.FISHMANConst.once.users[i.seatId]=i,i.userId==a.FISHMANConst.once.userId&&(a.FISHMANConst.once.Entries=i.score,a.FISHMANConst.once.diamond=i.wins)}a.FISHMANConst.once.PlayerInfo.gameDisconnect=!1,a.FISHMANConst.once.PlayerInfo.gameName="FISHMANFish",a.FISHMANConst.once.TableId=e.change_scene_type%3||0,o.once.checkSelfTableIndex(),this.GameLayer.changeSceneBg(a.FISHMANConst.once.TableId,!1,a.FISHMANConst.once.TableId),this.GameLayer.clearTableFishs(),this.GameLayer.refreshTable(!1),this.GameLayer&&this.GameLayer.EffectLayer&&this.GameLayer.WeaponLayer.LastFireTime<-999998&&(this.GameLayer.WeaponLayer.LastFireTime=-91),this.sendChangeScene()},t.prototype.sendChangeScene=function(){h.default.once.send("changeScene",{})},t.prototype.CmdByStageChange=function(e){var t={now:a.FISHMANConst.once.TableId,anim:!0,later:e.change_scene_type,skillId:a.FISHMANEffectType.Fast};this.GameLayer.EffectLayer.addEffect(t),a.FISHMANConst.once.TableId=e.change_scene_type,cc.log("CmdByStageChange:"+JSON.stringify(e))},t.prototype.ShotSelfBullet=function(e){this.GameLayer&&this.GameLayer.WeaponLayer&&(e.balance=parseInt(e.bet)*a.FISHMANConst.once.RoomBet,e.uid=e.userid=a.FISHMANConst.once.userId,a.FISHMANConst.once.BulletCount++,this.GameLayer.WeaponLayer.LastFireTime=0,e.seatId=this.userConvertSeatId(e.userid),e.touch=this.decodePoint(e.position),this.GameLayer.WeaponLayer.showWeapon(e))},t.prototype.CmdBYShot=function(e){if(this.GameLayer&&this.GameLayer.WeaponLayer){if(e.balance=parseInt(e.bet)*a.FISHMANConst.once.RoomBet,e.uid=e.userid,e.seatId=this.userConvertSeatId(e.userid),e.userid==a.FISHMANConst.once.userId)a.FISHMANConst.once.Entries-=e.balance;else{if(e.fishId){var t=this.getFishByFishId(e.fishId);t instanceof r.default&&this.CmdBYLockFish(t,e.seatId)}else this.CmdBYUnlockFish(e.seatId);e.touch=this.decodePoint(e.position),this.GameLayer.WeaponLayer.showWeapon(e)}a.FISHMANConst.once.users[e.seatId]&&(a.FISHMANConst.once.users[e.seatId].score-=e.balance,this.GameLayer.updateBalance(e.userid,a.FISHMANConst.once.users[e.seatId].score))}},t.prototype.CmdBYShotFish=function(e){var t=this.getAllFishByFishId(e.fishId),n=t[0],i=this.getTableByUID(e.userId);if(e.hitSocre*=a.FISHMANConst.once.RoomBet,i&&n instanceof r.default){for(var s=parseInt(n.config.Skill),c={fishId:e.fishId,userId:e.userId,seatId:i.seatId,award:e.hitSocre,bomb:e.bomb,fid:n.fid,ScoreEffect:n.config.ScoreEffect,position:n.node.position,SettleType:n.config.SettleType,point:n.node.convertToWorldSpaceAR(cc.v2(0,0)),bombId:e.bombId,bulletId:e.bombId,fishType:n.config.fishType},h=0;h<t.length;h++){var d=t[h];d.goDie(),4!=e.butype&&5!=e.butype&&d.playDieAni(),5==e.butype&&(d.dieCD=2)}if(console.log("HitResult fish.config: "+JSON.stringify(n.config)),console.log("HitResult result: "+JSON.stringify(e)),s==a.FISHMANEffectType.FULL_BOOM&&(c.skillId=a.FISHMANEffectType.FULL_BOOM,this.GameLayer.EffectLayer.addEffect(c)),s==a.FISHMANEffectType.FOOD&&(c.skillId=a.FISHMANEffectType.FOOD,this.GameLayer.EffectLayer.addEffect(c)),s==a.FISHMANEffectType.DIAN_WANG&&this.CmdFISHMANDW(c),s==a.FISHMANEffectType.PI_KA_QIU&&this.cmdXZBoom({seatId:i.seatId,skillId:a.FISHMANEffectType.PI_KA_QIU,position:c.position,count:0,bulletId:e.bombId,fid:n.fid,bombId:e.bombId,award:c.award}),s==a.FISHMANEffectType.ZZBoom&&this.GameLayer.EffectLayer.addEffect({seatId:i.seatId,skillId:a.FISHMANEffectType.ZZBoom,position:c.position,bulletId:e.bombId,fid:n.fid,bombId:e.bombId,award:c.award,angle:n.node.angle}),4==e.butype){var f=e.sendFishs.indexOf(e.fishId),u=this.getFishByFishId(c.fishId),y=p.default.deepCopy(c);y.to=u.node.position,y.coinPosition=u.node.position,y.position=e.from,y.skillId=a.FISHMANEffectType.PI_KA_QIU,y.delay=.2*f+1,y.sumTime=.2*e.sendFishs.length+1,this.GameLayer.EffectLayer.addEffect(y)}n.fid>19&&o.once.GameLayer.EffectLayer.addEffect({seatId:c.seatId,award:c.award,skillId:a.FISHMANEffectType.Bill,fid:n.fid,bombId:e.bombId}),4!=e.butype&&this.addResultCoin(c)}i&&a.FISHMANConst.once.users[i.seatId]&&-1!=[0,1,2,6,7].indexOf(e.butype)&&(a.FISHMANConst.once.PlayerInfo.useOneScore?(a.FISHMANConst.once.users[i.seatId].score+=e.hitSocre,a.FISHMANConst.once.Entries=a.FISHMANConst.once.users[i.seatId].score,this.GameLayer.updateDiamond(i.userId,a.FISHMANConst.once.users[i.seatId].score),this.GameLayer.updateBalance(i.userId,a.FISHMANConst.once.users[i.seatId].score)):(a.FISHMANConst.once.users[i.seatId].wins+=e.hitSocre,this.GameLayer.updateDiamond(i.userId,a.FISHMANConst.once.users[i.seatId].wins)));var I=this.getBulletByBulletId(e.bombId);I instanceof l.default&&!I.isDrill&&this.GameLayer.despawnBullet(I)},t.prototype.addResultCoin=function(e){this.addSFX(e),this.showCoin(e),o.once.GameLayer.EffectLayer.addEffect({seatId:e.seatId,award:e.award,skillId:a.FISHMANEffectType.SamllBill,fid:e.fid})},t.prototype.getBoomFishs=function(){for(var e=[],t=this.GameLayer.getFishs(),o=0;o<t.length;o++){var n=t[o];if(n.alive&&n.fid<18&&0==parseInt(n.config.Skill)&&(e.push(n.fishId),e.length>13))break}return e},t.prototype.cmdXZBoom=function(e){if(a.FISHMANConst.once.seatId==e.seatId){var t=this.getBoomFishs();t.length>0&&this.requestShotTarget(t,e.bulletId,4,null,!1,e.position),e.skillId=a.FISHMANEffectType.PKQLight,this.GameLayer.EffectLayer.addEffect(e)}},t.prototype.createFish=function(e){var t=this.getFishConfig(e.fishType);if(e.fishes=e.fishes||[e.fishType],t){var n=p.default.generateMixed(20),i=e.fishPath%a.FISHMANConst.once.FishPath.length,s=this.getFishPathByID(a.FISHMANConst.once.FishPath[i].id),c=this.convertToGid(e.fishes.length),r=o.once.getFishPoints(t.FishID);18!=t.fishType&&19!=t.fishType||cc.log("SSSSSSSSSSSSSSSSSSSSSSSSSSS"),t.fishType=e.fishType,t.propFish=e.propFish;for(var l=0;l<e.fishes.length;l++){var h={groupUuid:n,groupId:c,fid:e.fishes[l],fishId:e.fishId[0],config:t,index:l,skillId:"",FishPath:s,pathInterval:s.time,swimmingInterval:0,compensate:0,conlliderPoints:r};this.GameLayer.refreshFish(h)}}else cc.log("\u627e\u4e0d\u5230\u9c7c\u8be6\u60c5group.fishType---\x3e"+e.fishType)},t.prototype.convertToGid=function(e){for(var t=0;t<a.FISHMANConst.once.FishGroups.length;t++){var o=a.FISHMANConst.once.FishGroups[t];if(o.num==e)return o.id}return null},t.prototype.CmdBYLockFish=function(e,t){void 0===t&&(t=a.FISHMANConst.once.seatId),e instanceof r.default&&e.pushLockSeat(t)&&(this.GameLayer.WeaponLayer.setLockFishByTid(t,e),t==a.FISHMANConst.once.seatId&&this.playSFX("lock")),e instanceof r.default&&this.GameLayer.showUserLock(t,e.fid)},t.prototype.CmdBYUnlockFish=function(e){void 0===e&&(e=a.FISHMANConst.once.seatId),this.GameLayer.WeaponLayer.setLockFishByTid(e),this.GameLayer.UnLockFishNtfType(e)},t.prototype.addSFX=function(e){if(e&&e.seatId===a.FISHMANConst.once.seatId){var t="die_small";Math.floor(e.fid)>9&&(t="die"),Math.floor(e.fid)>19&&(t="die_big"),this.playSFX(t)}},t.prototype.getFishPathByID=function(e){for(var t=a.FISHMANConst.once.FishPath,o=""+e||"1001",n=0;n<t.length;n++){var i=t[n];if(i.id===o){var s=i;return s.scale=1,s.points[0].x-s.points[s.points.length-1].x>0&&(s.scale=-1),s}}return null},t.prototype.getFishLayerIndex=function(e){for(var t=parseInt(e),o=[[0,1,2,3,4,5,6,7,10,11,12,13,14,15,26],[19,20],[21],[25,27],[29,30],[16,17,18]],n=0;n<o.length;n++)if(-1!=o[n].indexOf(t))return n;return 0},t.prototype.getFishConfig=function(e){for(var t=0;t<a.FISHMANConst.once.FishConfigs.length;t++)if(""+a.FISHMANConst.once.FishConfigs[t].FishID==""+e)return p.default.deepCopy(a.FISHMANConst.once.FishConfigs[t]);return null},t.prototype.getFishPoints=function(e){return a.FISHMANConst.once.FishPoints[e]},t.prototype.getFishGroups=function(e){for(var t=0;t<a.FISHMANConst.once.FishGroups.length;t++)if(""+a.FISHMANConst.once.FishGroups[t].id==""+e)return a.FISHMANConst.once.FishGroups[t];return null},t.prototype.getEffectByType=function(e){return a.FISHMANConst.once.MapEffects.get(""+e)},t.prototype.getAtlasByType=function(e){return a.FISHMANConst.once.MapAtlas.get(""+e)},t.prototype.getDeathAnimateByID=function(e){var t=a.FISHMANConst.once.MapDieanis.get(""+e);if(!t)throw new Error("\u627e\u4e0d\u5230\u8be5\u9c7cID\u7684\u6b7b\u4ea1\u52a8\u753b");return t},t.prototype.getSwimAnimateByID=function(e){return a.FISHMANConst.once.MapSwims.get(""+e)},t.prototype.initData=function(){cc.sys.isMobile?window.addEventListener("resize",this.onResized.bind(this)):cc.view.on("canvas-resize",this.onResized,this),this.onResized()},t.prototype.checkCompensate=function(e){var t=e.clientTime||Date.now(),o=void 0===e.seatId?a.FISHMANConst.once.seatId:e.seatId,n=e.cToS?e.serverTime-t:t-e.serverTime,i=a.FISHMANConst.once.MapCompensate.get(o);i||(i=e.cToS?n:-n,a.FISHMANConst.once.MapCompensate.set(o,i));var s=e.cToS?n-i:n+i;return s<=0&&(i=e.cToS?i+s:i-s,a.FISHMANConst.once.MapCompensate.set(o,i),s=0),s},t.prototype.convertPositionAngle=function(e){var t=cc.view.getVisibleSize(),o=t.width/2,n=t.height/2,i=e.x>o||e.x<-o,s=i?Math.abs(e.x)-o:0,a=e.y>n||e.y<-n?Math.abs(e.y)-n:0,c=i?360:180;return e.y>n&&(a=-a),e.x>o&&(s=-s),{out:s||a,x:s,y:a,jd:c,angle:c-e.angle}},t.prototype.calculateSpacePoint=function(e){var t=e.xySpeed,o=cc.view.getVisibleSize();if(void 0===e.xySpeed){var n=o.width*e.speed.x*e.space,i=o.height*e.speed.y*e.space;t=Math.sqrt(n*n+i*i)}var s=t*Math.sin(e.angle/180*Math.PI),a=t*Math.cos(e.angle/180*Math.PI);return cc.v2(s,a)},t.prototype.calculateNextBorderPoint=function(e){var t=cc.v2(e.point.x,e.point.y),o=cc.view.getVisibleSize(),n=Math.sin(e.angle/180*Math.PI),i=Math.cos(e.angle/180*Math.PI),s=n>0?o.width/2-t.x:-o.width/2-t.x,a=i>0?o.height/2-t.y:-o.height/2-t.y,c=e.speed.x*n,r=e.speed.y*i,l=Math.abs(s/c),p=Math.abs(a/r),h=Math.min(l,p);return t.x+=c*h,t.y+=r*h,{point:t,time:h}},t.prototype.inCircle=function(e,t,o){return cc.v2(e.x,e.y).sub(cc.v2(t.x,t.y)).mag()<=o},t.prototype.onResized=function(){a.FISHMANConst.once.winScale=this.convertWindowScale()},t.prototype.checkSelfTableIndex=function(){for(var e in a.FISHMANConst.once.users){var t=a.FISHMANConst.once.users[e];t&&t.userId===a.FISHMANConst.once.userId&&(a.FISHMANConst.once.seatId=parseInt(t.seatId))}},t.prototype.getUser=function(e){void 0===e&&(e=404);var t=null;for(var o in 404==e&&(e=a.FISHMANConst.once.seatId),a.FISHMANConst.once.users){var n=a.FISHMANConst.once.users[o];n&&n.seatId===e&&(t=n)}return t},t.prototype.flipWeaponY=function(e){return Math.max(a.FISHMANConst.once.seatId,e)>1&&Math.min(a.FISHMANConst.once.seatId,e)<=1},t.prototype.userConvertIndex=function(e){return this.tableConvertIndex(this.userConvertSeatId(e))},t.prototype.userConvertSeatId=function(e){var t=this.getTableByUID(e);return t?t.seatId:-1},t.prototype.tableConvertIndex=function(e){void 0===e&&(e=-1);var t=e>-1?e:a.FISHMANConst.once.seatId;return a.FISHMANConst.once.seatId>1&&(t=t>1?t-2:t+2),t},t.prototype.getTableByUID=function(e,t){var o=e||a.FISHMANConst.once.userId;for(var n in a.FISHMANConst.once.users){var i=a.FISHMANConst.once.users[n];if(i&&""+i.userId==""+o)return t instanceof Function&&t(i),i}},t.prototype.showCoin=function(e){var t=p.default.deepCopy(e);if(t.self=e.seatId===a.FISHMANConst.once.seatId,t.index=this.tableConvertIndex(e.seatId),parseFloat(e.award)>0){for(var o=0;o<1;o++){var n=p.default.deepCopy(t);n.i=o,this.GameLayer.addCoin(n)}this.showCoinLbAction(t)}},t.prototype.showCoinLbAction=function(e){var t=this;if(e.award&&parseFloat(e.award)>0){var o=this.GameLayer.addCoinLb(e);if(o instanceof cc.Node){o.opacity=255;var n=cc.spawn(cc.moveTo(.5,cc.v2(o.x,o.y+50)),cc.fadeIn(.3)),i=cc.spawn(cc.moveTo(1,cc.v2(o.x,o.y+100)).easing(cc.easeIn(3)),cc.fadeOut(1));o.runAction(cc.sequence(n,i,cc.callFunc(function(){t.GameLayer.despawnCoinLb(o)})))}}},t.prototype.checkLimitBorder=function(e){var t=cc.view.getVisibleSize(),o=e.x>=-t.width/2&&e.x<=t.width/2,n=e.y>=-t.height/2&&e.y<=t.height/2;return o&&n},t.prototype.inCircleFishs=function(e,t){void 0===t&&(t=100);for(var o=[],n=this.GameLayer.getFishs(),i=[],s=0;s<n.length;s++){var a=n[s],c=a.node.convertToNodeSpaceAR(cc.v2(e.x,e.y));if(a.alive)for(var r=0;r<a.colliders.length;r++){var l=a.colliders[r];if(a.fid<20&&this.inCircle(l,c,t)){if(a.beAttack(),!a.fishId){cc.log("f.fishId;;;;;");break}i.push(a),o.push(a.fishId);break}}}return{fishId:o,fish:i}},t.prototype.getMaxFish=function(){var e=this.GameLayer.getFishs(),t=e.length-1;if(t<0)return null;for(var o=e[0],n=t;n>0;n--){var i=e[n],s=this.checkLimitBorder(i.node);i.alive&&s&&parseInt(i.config.Rate)>parseInt(o.config.Rate)&&(o=i)}return o},t.prototype.setLimitFire=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1),this.GameLayer.WeaponLayer.setTimelimit(e),t&&a.FISHMANConst.once.IsAuto&&this.GameLayer.MenuLayer.onClickedAuto(!1)},t.prototype.onTouchWindow=function(e,t){if(this.GameLayer.WeaponLayer.timeLimit){this.GameLayer.WeaponLayer.setClickLimit(!1);var o=this.GameLayer.WeaponLayer.balanceLimit;this.setLimitFire(a.FISHMANConst.once.FightLimit,!o),cc.log("onTouchWindow"),this.requestFishFire(e,t)}},t.prototype.showLockLineByTid=function(e,t){for(var o=0;o<t.length;o++){var n=t[o];this.GameLayer.WeaponLayer.showLockLineByTid(n,e)}},t.prototype.getFishByFishId=function(e){for(var t=this.GameLayer.getFishs(),o=0;o<t.length;o++){var n=t[o];if(e===n.fishId)return n}return null},t.prototype.getAllFishByFishId=function(e){for(var t=[],o=this.GameLayer.getFishs(),n=0;n<o.length;n++){var i=o[n];e===i.fishId&&t.push(i)}return t},t.prototype.getBulletByBulletId=function(e){for(var t=this.GameLayer.getBullets(),o=0;o<t.length;o++){var n=t[o];if(e===n.bulletId)return n}return null},t.prototype.removeEvents=function(){cc.sys.isMobile?window.removeEventListener("resize",this.onResized.bind(this)):cc.view.off("canvas-resize",this.onResized,this),this.unscheduleAllCallbacks()},t.prototype.getFrameByName=function(e){var t=null;return a.FISHMANConst.once.MapAtlas.forEach(function(o){var n=o.getSpriteFrame(e);n&&(t=n)}),t},t.prototype.cheekVectorOrTimeIndex=function(e,t,o){for(var n=0,i=[],s=1;s<e.length;s++){var a=100;if(!o){var c=e[s-1],r=e[s];a=Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2),a=Math.sqrt(a)}i.push(a),n+=a}var l=0,p=0;for(s=0;s<i.length;s++){p=s+1;var h=n*t,d=l+(a=i[s]);if(l<h&&h<=d)return{index:p,f:1-(d-h)/a};l=d}return null},t.prototype.makeBreakBezier2=function(e,t,o){if(t&&t.length){if(e<=0)return t[0];if(e>=1)return t[t.length-1];for(var n=0,i=this.cheekVectorOrTimeIndex(t,e,!0),s=[t[i.index-1],o[i.index-1],t[i.index]];n<1e3;){n++;for(var a=s.length-1,c=0;c<a;c++)if(s[c]=this.convertVectorToPoint(s[c],s[c+1],i.f),c===a-1&&(s.splice(a,s.length),1===s.length))return s[0]}}},t.prototype.convertVectorToPoint=function(e,t,o){return cc.v2(e.x+-(e.x-t.x)*o,e.y+-(e.y-t.y)*o)},t.prototype.convertPointToAngle=function(e,t){var o=0,n=e.y-t.y,i=e.x-t.x;return 0===i?o=n>0?-90:90:(i<0&&n>0&&(o=180-180*Math.atan(n/i)/Math.PI),i<0&&n<0&&(o=180-180*Math.atan(n/i)/Math.PI),i>0&&n>0&&(o=270+180*Math.atan(i/n)/Math.PI),i>0&&n<0&&(o=90+180*Math.atan(i/n)/Math.PI)),o},t.prototype.convertWindowsizePath=function(e){for(var t=e,o=this.convertWindowScale(),n=0;n<t.length;n++){for(var i=0;i<t[n].points.length;i++)t[n].points[i].x*=o.x,t[n].points[i].y*=o.y;for(i=0;i<t[n].controls.length;i++)t[n].controls[i].x*=o.x,t[n].controls[i].y*=o.y}return t},t.prototype.convertWindowScale=function(){var e=cc.view.getVisibleSize(),t=e.width/1334,o=e.height/750;return cc.v2(t,o)},t.prototype.addBill=function(e){if(e&&this.GameLayer&&this.GameLayer.EffectLayer&&cc.isValid(this.GameLayer.node)&&Math.floor(e.SettleType)>=0){var t=(""+e.SettleType).split(""),o=e.seatId===a.FISHMANConst.once.seatId,n=e.award;-1!==["1","0"].indexOf(t[0])&&-1!==["1","0"].indexOf(t[1])&&(t=o?[1]:[0]);for(var i=Math.floor(e.fid),s=0;s<t.length;s++){var c=Math.floor(t[s]),r=c;this.GameLayer.EffectLayer.addEffect({seatId:e.seatId,skillId:a.FISHMANEffectType.Bill,type:c,fid:i,award:n,limit:r,number:e.number})}}},t.prototype.codePoint=function(e){return e||(e=cc.v2(0,0)),{x:1*e.x/a.FISHMANConst.once.winScale.x,y:1*e.y/a.FISHMANConst.once.winScale.y}},t.prototype.decodePoint=function(e){return e||(e=cc.v2(0,0)),{x:1*e.x*a.FISHMANConst.once.winScale.x,y:1*e.y*a.FISHMANConst.once.winScale.y}},t.prototype.playBGM=function(e,t){void 0===t&&(t=!0),e=e||this.MusicDic[404],t&&(this.MusicDic[404]=e),this.play(e,!0,!0)},t.prototype.stopBGM=function(){cc.audioEngine.stopAll()},t.prototype.playSFX=function(e){this.play(e,!1,!1)},t.prototype.stopSFX=function(e){this.MusicDic[e]&&cc.audioEngine.stop(this.MusicDic[e])},t.prototype.play=function(e,t,o){void 0===o&&(o=!1);var n=this.GameLayer.LoadingLayer[e];n&&(this.MusicDic[e]=o?cc.audioEngine.playMusic(n,t):cc.audioEngine.playEffect(n,t))},s([u(c.default)],t.prototype,"GameLayer",void 0),o=s([f],t)}(cc.Component);o.default=y,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANBullet":"FISHMANBullet","./FISHMANConst":"FISHMANConst","./FISHMANFish":"FISHMANFish","./FISHMANNetWork":"FISHMANNetWork","./FISHMANScene":"FISHMANScene"}],FISHMANMenu:[function(e,t,o){"use strict";cc._RF.push(t,"bd763dd3LpMIrfm77SNfBQr","FISHMANMenu");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=e("./FISHMANNetWork"),l=cc._decorator,p=l.ccclass,h=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LayerNetError=null,t.LayerRule=null,t.an_auto=null,t.an_lock=null,t._mune=!1,t}return i(t,e),t.prototype.onLoad=function(){this._index=0,this.node.width=cc.winSize.width>1334?1334:cc.winSize.width,this.btn_auto=this.node.getChildByName("btn_auto"),this.btn_lock=this.node.getChildByName("btn_lock"),this.btn_jiasu=this.node.getChildByName("btn_jiasu"),this.btn_auto.on("click",this.onClickedAuto,this),this.btn_lock.on("click",this.onClickedLock,this),this.btn_jiasu.on("click",this.onClickedJiasu,this),this.node.getChildByName("btn_bill").on("click",this.onClickedBill,this),this.layer_mune=this.node.getChildByName("layer_mune"),cc.find("layer_mune/btn_back",this.node).on("click",this.onClickedBack,this),cc.find("layer_mune/btn_setup",this.node).on("click",this.onClickedSetup,this),cc.find("layer_mune/btn_setup/close",this.node).active=!1,cc.find("layer_mune/btn_rule",this.node).on("click",this.onClickedRule,this),this.btn_show=cc.find("layer_mune/btn_show/show",this.node),this.btn_show.parent.on("click",this.onClickedShow,this),this.btn_hide=cc.find("layer_mune/btn_show/hide",this.node),this.btn_hide.active=!1,cc.game.on(cc.game.EVENT_HIDE,this.onHide,this);var e=cc.sys.localStorage.getItem("FISHMAN_AudioVolume");this.setAudioVolume(null==e||e>0)},t.prototype.onHide=function(){console.log("\u6e38\u620f\u8fdb\u5165\u540e\u53f0"),a.FISHMANConst.once.IsAuto&&this.onClickedAuto()},t.prototype.onclickedLeave=function(){r.default.once.levea()},t.prototype.onResized=function(){},t.prototype.onClickedSetup=function(){c.default.once.playSFX("click"),cc.audioEngine.getMusicVolume()>0?this.setAudioVolume(!1):this.setAudioVolume(!0)},t.prototype.setAudioVolume=function(e){e?(cc.audioEngine.setMusicVolume(1),cc.audioEngine.setEffectsVolume(1),cc.sys.localStorage.setItem("FISHMAN_AudioVolume",1)):(cc.audioEngine.setMusicVolume(0),cc.audioEngine.setEffectsVolume(0),cc.sys.localStorage.setItem("FISHMAN_AudioVolume",0)),cc.find("layer_mune/btn_setup/open",this.node).active=e,cc.find("layer_mune/btn_setup/close",this.node).active=!e},t.prototype.onClickedRule=function(){this.LayerRule.active=!this.LayerRule.active},t.prototype.onClickedShow=function(){c.default.once.playSFX("click"),this._mune=!this._mune,this.btn_show.active=!this._mune,this.btn_hide.active=!this.btn_show.active;for(var e=[],t=0;t<3;t++)e[t]=cc.find("layer_mune/"+["btn_back","btn_setup","btn_rule"][t],this.node),e[t].stopAllActions(),e[t].active=this._mune,e[t].opacity=0,e[t].scale=1;if(this._mune)for(t=0;t<e.length;t++)e[t].runAction(cc.sequence(cc.delayTime(.1*t),cc.spawn(cc.sequence(cc.scaleTo(.05,1.2),cc.scaleTo(.05,1)),cc.fadeIn(.1))))},t.prototype.onClickedBack=function(){c.default.once.playSFX("click"),c.default.once.requestLeaveRoom()},t.prototype.onClickedBill=function(){for(var e=[20,21,22,25,26,27,29,30],t=0;t<e.length;t++)c.default.once.GameLayer.EffectLayer.addEffect({seatId:0,award:100,skillId:a.FISHMANEffectType.Bill,fid:e[t],bombId:"000000000000000000000000000"})},t.prototype.onClickCloseRule=function(){c.default.once.playSFX("click"),this.LayerRule.active=!1},t.prototype.onClickedAuto=function(e){void 0===e&&(e=!0),e&&c.default.once.playSFX("click"),a.FISHMANConst.once.IsAuto=!a.FISHMANConst.once.IsAuto,a.FISHMANConst.once.IsAuto?(this.an_auto.play("auto_"),this.btn_auto.opacity=255):(this.an_auto.stop(),this.btn_auto.opacity=200)},t.prototype.onClickedJiasu=function(e){void 0===e&&(e=!0),e&&c.default.once.playSFX("click"),a.FISHMANConst.once.AutoLimit==a.FISHMANFireSpeed.Speed0?(a.FISHMANConst.once.AutoLimit=a.FISHMANFireSpeed.Speed1,a.FISHMANConst.once.FightLimit=a.FISHMANFireSpeed.Speed1):(a.FISHMANConst.once.AutoLimit=a.FISHMANFireSpeed.Speed0,a.FISHMANConst.once.FightLimit=a.FISHMANFireSpeed.Speed0),this.btn_jiasu.opacity=a.FISHMANConst.once.AutoLimit==a.FISHMANFireSpeed.Speed1?255:200},t.prototype.onClickedLock=function(){c.default.once.playSFX("click"),a.FISHMANConst.once.IsLock=!a.FISHMANConst.once.IsLock,a.FISHMANConst.once.IsLock?this.btn_lock.opacity=255:(c.default.once.CmdBYUnlockFish(),this.btn_lock.opacity=200)},t.prototype.onDestroy=function(){cc.game.off(cc.game.EVENT_HIDE,this.onHide,this)},s([h(cc.Node)],t.prototype,"LayerNetError",void 0),s([h(cc.Node)],t.prototype,"LayerRule",void 0),s([h(cc.Animation)],t.prototype,"an_auto",void 0),s([h(cc.Animation)],t.prototype,"an_lock",void 0),s([p],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager","./FISHMANNetWork":"FISHMANNetWork"}],FISHMANNetWork:[function(e,t,o){"use strict";cc._RF.push(t,"0f2f0ycBOtJVbxQT8PtjxfC","FISHMANNetWork");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=cc._decorator,l=r.ccclass,p=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return i(t,e),o=t,t.prototype.onLoad=function(){o.once=this,GameConfig.SubGameMgr.subGameNet=this,this.send("loginGame",{})},t.prototype.start=function(){},t.prototype.send=function(e,t){window.sendNetWorkData&&(console.log("send cmd:"+e+",data:",t),window.sendNetWorkData(e,"string"==typeof t?t:JSON.stringify(t)))},t.prototype.requestLeaveRoom=function(){this.levea()},t.prototype.tryLeave=function(){this.levea()},t.prototype.levea=function(){Common.backHall("Are you sure you want to leave the game?",function(){})},t.prototype.addNetEvent=function(e,t){if("loginGameResult"==e){var o=this.changeResultJSON_Function(t);console.log("\u6e38\u620f\u767b\u9646\u6210\u529f======================="+JSON.stringify(o)),o.resultid?(a.FISHMANConst.once.RoomBet=o.Obj.bet,a.FISHMANConst.once.PlayerInfo.win_pool=o.Obj.winPool,a.FISHMANConst.once.PlayerInfo.playerDiamond=o.Obj.wins,a.FISHMANConst.once.PlayerInfo.playerId=o.Obj.id,a.FISHMANConst.once.Entries=o.Obj.score,this.send("LoginRoom",{roomid:1})):this.tryLeave()}if("LoginRoomResult"==e&&(t=this.changeResultJSON_Function(t),cc.log("LoginRoomResult",t),t.ResultCode)){cc.log("LoginRoomResult------------------\x3e"+JSON.stringify(t)),a.FISHMANConst.once.BLevels=t.ResultData.betList,c.default.once.CmdBYTable(t);for(var n=t.ResultData.userList,i=0;i<n.length;i++)c.default.once.CmdBYCannonChange(n[i])}if("HitResult"==e&&(console.log("HitResult: "+JSON.stringify(t)),1==(o=this.changeResultJSON_Function(t)).ResultCode&&(o.hitInfo&&4==o.hitInfo.bulletType&&(o.ResultData.from=o.hitInfo.from,o.ResultData.sendFishs=o.hitInfo.fishId,o.ResultData.butype=o.hitInfo.bulletType),c.default.once.CmdBYShotFish(o.ResultData))),"FishOut"==e){o=this.changeResultJSON_Function(t);c.default.once.createFish(o)}if("fishShoot"==e){o=this.changeResultJSON_Function(t);c.default.once.CmdBYShot(o)}if("getDownTimeResult"==e&&(o=this.changeResultJSON_Function(t),console.log("getDownTimeResult======================="+JSON.stringify(o))),"doubleEnd"==e&&(o=this.changeResultJSON_Function(t)),"chargeAllResult"==e&&(o=this.changeResultJSON_Function(t),console.log("chargeAllResult",o),c.default.once.rechargeAllResult(o)),"playEnter"==e&&(o=this.changeResultJSON_Function(t)).ResultCode&&(cc.log("playEnter:"+JSON.stringify(t)),c.default.once.CmdBYFishSeatChange(o.ResultData.seatId,o.ResultData)),"broadcast"==e&&(o=this.changeResultJSON_Function(t),cc.log("broadcast:"+JSON.stringify(t)),c.default.once.broadcast(o)),"PlayerOut"==e&&(o=this.changeResultJSON_Function(t),cc.log("PlayerOut:"+JSON.stringify(t)),c.default.once.CmdBYFishSeatChange(o.PlayerSeatId,null)),"changePowerResult"==e&&(o=this.changeResultJSON_Function(t),cc.log("changePowerResult :"+JSON.stringify(o)),c.default.once.CmdBYCannonChange(o)),"useSkillResult"==e&&(o=this.changeResultJSON_Function(t),console.log("useSkillResult",o)),"fishHit_boardResult"==e){var s=this.changeResultJSON_Function(t);s.uid==a.FISHMANConst.once.PlayerInfo.playerId&&this.send("fishHit",s)}"fishSceneChange"==e&&(o=this.changeResultJSON_Function(t))&&(cc.log("fishSceneChange:"+JSON.stringify(t)),o.change_scene_type%=3,c.default.once.CmdByStageChange(o))},t.prototype.changeResultJSON_Function=function(e){return JSON.parse(e)},t.prototype.onDestroy=function(){o.once=null},o=s([l],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANScene:[function(e,t,o){"use strict";cc._RF.push(t,"8c595yLJr5CMIdorCqSOtC2","FISHMANScene");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=e("./FISHMANEffect"),l=e("./FISHMANMenu"),p=e("./FISHMANCoin"),h=e("./FISHMANBullet"),d=e("./FISHMANFish"),f=e("./FISHMANFishNet"),u=e("./FISHMANWeapon"),y=e("./FISHMANEffectLayer"),I=e("./FISHMANBill"),g=e("./FISHMANUser"),F=e("./FISHMANLoading"),v=e("../../../Script/utils/Utils"),_=cc._decorator,m=_.ccclass,S=_.property,A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LoadingLayer=null,t.MenuLayer=null,t.WeaponLayer=null,t.EffectLayer=null,t.RechargeLayer=null,t.FishParent=null,t.BulletParent=null,t.GoldParent=null,t.GoldLabelParent=null,t.NetParent=null,t.EffectSKParent=null,t.EffectParent=null,t.arr_fishs=[],t.arr_bullets=[],t.arr_effect=[],t.arr_coin=[],t.arr_seats=[],t}return i(t,e),t.prototype.onLoad=function(){this.LoadingLayer.loadFinish(),c.default.once.GameLayer=this,this.initView(),this.EffectLayer.defaultLight(this.node),c.default.once.initData(),this.loadFinish()},t.prototype.changeGold=function(e){return(parseFloat(e)/a.FISHMANConst.once.PlayerInfo.exchangeRate).toFixed(2)},t.prototype.loadFinish=function(){this.initData();for(var e=0;e<this.arr_seats.length;e++)this.arr_seats[e].initUI(),this.arr_seats[e].cleanInfo();this.WeaponLayer.init()},t.prototype.initData=function(){this.arr_fishs=[],this.arr_bullets=[],this.arr_effect=[],this.arr_coin=[];var e=cc.find("layer_load/pr_net",this.node);e.addComponent(f.default);var t=cc.find("layer_load/pr_fish",this.node);t.addComponent(d.default);var o=cc.find("layer_load/pr_bullet",this.node);o.addComponent(h.default);var n=cc.find("layer_load/pr_effect",this.node);n.addComponent(r.default);var i=cc.find("layer_load/pr_coin",this.node);i.addComponent(p.default);var s=cc.find("layer_load/lb_coin",this.node),a=cc.find("layer_load/pr_bill",this.node);a.addComponent(I.default),this.pool_fish=this.createPool(400,t),this.pool_bullet=this.createPool(300,o),this.pool_net=this.createPool(130,e),this.pool_coin=this.createPool(400,i),this.pool_effect=this.createPool(50,n),this.pool_bill=this.createPool(20,a),this.pool_coinlb=this.createPool(200,s)},t.prototype.createPool=function(e,t){var o=new cc.NodePool;o.prefab=t;for(var n=0;n<e;n++)o.put(cc.instantiate(t));return o},t.prototype.getNodeByPool=function(e){var t=e.get();return t||(t=cc.instantiate(e.prefab)),t},t.prototype.clearLockFishAllBullet=function(e){for(var t=this.getBullets(),o=0;o<t.length;o++){var n=t[o];n.lockFishId===e&&n.clearLockID()}},t.prototype.initView=function(){var e=a.FISHMANConst.once.PlayerInfo.useOneScore?this.node.getChildByName("layer_users2").children:this.node.getChildByName("layer_users").children;this.arr_seats=[];for(var t=0;t<4;t++){var o=e[t].getComponent(g.default);this.arr_seats.push(o)}for(this.layer_bgs=this.node.getChildByName("layer_bgs"),t=0;t<5;t++){var n=this.RechargeLayer.getChildByName("btn_"+t);v.default.addClickEvent(n,this,v.default.getComponentName(this),"onClickedRecharge",t)}},t.prototype.getFishs=function(){return this.arr_fishs||[]},t.prototype.getBullets=function(){return this.arr_bullets||[]},t.prototype.changeSceneBg=function(e,t,o){void 0===e&&(e=0);var n="bg"+o%3;if(c.default.once.playBGM(n),e!=o){for(var i=this.layer_bgs.children,s=0;s<i.length;s++){var a=i[s],r=a.name==="layer_"+e&&t,l=a.name==="layer_"+o;a.active=r||l,a.active&&(a.setPosition(0,0),a.opacity=255,a.zIndex=l?0:1)}if(t){c.default.once.playSFX("effect_108");var p=this.layer_bgs.getChildByName("layer_"+e);p.stopAllActions();var h=p.getChildByName("bg");h.stopAllActions(),p.runAction(cc.moveTo(3,cc.v2(-2e3,0))),h.runAction(cc.sequence(cc.moveTo(3,cc.v2(2e3,0)),cc.callFunc(function(){h.setPosition(0,0),p.active=""+e==""+o})))}}},t.prototype.updateBalance=function(e,t){var o=c.default.once.getTableByUID(e);if(o){var n=this.getUserByTable(o.seatId);n&&n.updateBalance(t)}},t.prototype.updateDiamond=function(e,t){var o=c.default.once.getTableByUID(e);if(o){var n=this.getUserByTable(o.seatId);n&&n.updateDiamond(t)}},t.prototype.getUserByTable=function(e){for(var t=null,o=0;o<this.arr_seats.length;o++)this.arr_seats[o]._seatId===e&&(t=this.arr_seats[o]);return t},t.prototype.refreshTable=function(e){void 0===e&&(e=null);var t=[0,1,2,3];for(var o in a.FISHMANConst.once.users){var n=a.FISHMANConst.once.users[o];if(n){var i=parseInt(n.seatId);if(t.splice(t.indexOf(i),1),e&&n.userId!==e.userId)continue;var s=c.default.once.tableConvertIndex(i),r=c.default.once.userConvertIndex(a.FISHMANConst.once.userId);cc.log("index======>"+s+"---selfIndex--\x3e"+r+"--u------\x3e"+JSON.stringify(n)),this.WeaponLayer.setConvertWeaponActive(n.userId,!0,null!=e),null!=e&&this.WeaponLayer.setLevelByUID(n.userId,0),this.arr_seats[s].refreshUserInfo(n),this.arr_seats[s].node.active=!0,n.userId==a.FISHMANConst.once.userId?this.WeaponLayer.setWeaponGold(n.userId,a.FISHMANConst.once.BLevels[a.FISHMANConst.once.BLevel]):this.WeaponLayer.setWeaponGold(n.userId,n.bet)}}for(var l=0;l<t.length;l++)s=c.default.once.tableConvertIndex(t[l]),cc.log("cleanInfoByTid------\x3e"+s),this.arr_seats[s].cleanInfo(),this.WeaponLayer.cleanInfoByTid(t[l])},t.prototype.showUserLock=function(e,t){var o=c.default.once.tableConvertIndex(e),n=this.arr_seats[o];n&&n.showLockFish(t)},t.prototype.UnLockFishNtfType=function(e){var t=c.default.once.tableConvertIndex(e),o=this.arr_seats[t];o&&o.unLock()},t.prototype.updateFish=function(){var e=a.FISHMANConst.once.FishConfigs[v.default.randomNum(0,a.FISHMANConst.once.FishConfigs.length)].FishID,t=a.FISHMANConst.once.FishGroups[7],o=t.id,n=a.FISHMANConst.once.FishPath[0],i=c.default.once.getFishConfig(e),s=c.default.once.getFishPathByID(n.id),r=c.default.once.getFishPoints(e);r=v.default.deepCopy(r);for(var l=0;l<t.num;l++)this.refreshFish({config:i,FishPath:s,fid:e,groupId:o,index:l,compensate:0,swimmingInterval:0,pathInterval:n.time,conlliderPoints:r})},t.prototype.refreshFish=function(e){var t=e,o="layer_"+c.default.once.getFishLayerIndex(t.fid);if(30==parseInt(t.fid)&&cc.log("--------dsfdsfdsfdfsdfsdfsdfsdf"),this.pool_fish.size()<5&&cc.log("\u9c7c\u82d7\u62a5\u8b66"),t.config&&o)if(t.groups=c.default.once.getFishGroups(t.groupId),t.groups){if(!(t.groups&&t.groups.origin&&t.groups.points&&t.groups.points[t.index])){var n="!groups";return t.groups.origin||(n="!groups.origin"),t.groups.points||(n="!groups.points"),t.groups.points[t.index]||(n="!groups.points[param.index]"),void cc.log("\u627e\u4e0d\u5230\u9c7c\u7ec4\u914d\u7f6e\u4fe1\u606f ID\uff1a"+t.groupId+"  \u7f3a\u5931\u4fe1\u606f\uff1a"+n+"  param.index:"+t.index)}if(t.FishPath)if(t.swimAni=c.default.once.getSwimAnimateByID(t.fid),t.swimAni)if(t.dieAni=c.default.once.getDeathAnimateByID(t.fid),t.dieAni)if(t.iceAni=a.FISHMANConst.once.MapEffects.get("frozen"+t.fid),t.iceAni){var i=this.getNodeByPool(this.pool_fish),s=i.getComponent(d.default);this.arr_fishs.push(s),i.parent=this.FishParent.getChildByName(o),s.init(t)}else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u51b0\u51bb\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u6b7b\u4ea1\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u52a8\u753bID\uff1a"+t.fid);else cc.log("\u627e\u4e0d\u5230\u9c7c\u7684\u8def\u5f84ID\uff1a"+t.pid)}else cc.log("\u627e\u4e0d\u5230\u9c7c\u7ec4\u914d\u7f6e\u4fe1\u606f ID\uff1a"+t.groupId);else cc.log("fishError\u627e\u4e0d\u5230\u9c7c\u7684\u4fe1\u606f ID\uff1a"+t.fid+"  "+!o)},t.prototype.getLockFishByFishId=function(e){for(var t=0;t<this.WeaponLayer.arr_locks.length;t++){var o=this.WeaponLayer.arr_locks[t];if(e===o.fishId)return o}return null},t.prototype.addNet=function(e,t,o,n){var i=this.getNodeByPool(this.pool_net),s=i.getComponent(f.default);i.zIndex=5e3,this.NetParent.addChild(i),s.init(e,t,o,n)},t.prototype.addEffect=function(e){if(cc.isValid(this.node)){var t=this.getNodeByPool(this.pool_effect),o=t.getComponent(r.default);this.EffectParent.addChild(t),e.parent=this.EffectSKParent,o.init(e),this.arr_effect.push(o)}},t.prototype.findZZBoomEffect=function(e,t){void 0===t&&(t=!1);for(var o=null,n=0;n<this.EffectParent.children.length;n++){var i=this.EffectParent.children[n].getComponent(r.default);i&&i.param&&i.param.skillId==a.FISHMANEffectType.ZZBoom&&e==i.param.seatId&&(t&&t==i.param.bombId||!t)&&(o=i)}return o},t.prototype.addRoute=function(){},t.prototype.getEffectBySkillId=function(e,t){void 0===t&&(t=!0);for(var o=[],n=0;n<this.arr_effect.length;n++){var i=this.arr_effect[n];if(i.param&&i.param.skillId===e){if(!t)return i;o.push(i)}}return t?o:null},t.prototype.addBullet=function(e){var t=e;t.angle=t.angle||this.WeaponLayer.getWeaponRotationByTid(t.seatId);var o=this.WeaponLayer.getWeaponOutPositionByTid(t.seatId),n=this.getNodeByPool(this.pool_bullet),i=n.getComponent(h.default);n.zIndex=2e3,this.arr_bullets.push(i),t.point=t.point||this.BulletParent.convertToNodeSpaceAR(o),this.BulletParent.addChild(n),t.isDrill&&(t.lock=null),i.init(t)},t.prototype.showRecharge=function(){Common.showMessage("not enough balance")},t.prototype.onClickedRecharge=function(e,t){cc.log("onClickedRecharge----\x3e"+t),4==parseInt(t)?c.default.once.requestRechargeAll():c.default.once.requestRechargeSum([1,10,50,100][parseInt(t)])},t.prototype.addBill=function(e){var t=this.getNodeByPool(this.pool_bill);t.parent=this.EffectParent,t.position=e.position?this.EffectParent.convertToNodeSpaceAR(e.position):cc.v2(0,0),t.getComponent(I.default).show(e)},t.prototype.addCoin=function(e){var t=this.getNodeByPool(this.pool_coin);t.parent=e.parent||this.GoldParent,t.zIndex=1e4;var o=e,n=this.WeaponLayer.DoubleBg[o.index];if(n){var i=n.convertToWorldSpaceAR(cc.v2(0,0)),s=t.getComponent(p.default);o.to=i,console.log("addCoin",o),s.init(o),this.arr_coin.push(s)}},t.prototype.addCoinLb=function(e){e||(e={});var t=this.getNodeByPool(this.pool_coinlb);if(t.parent=this.GoldLabelParent,e.position)t.position=e.position;else{var o=c.default.once.tableConvertIndex(e.seatId),n=this.arr_seats[o].getUserWinWorldPoint();t.position=t.parent.convertToNodeSpaceAR(n)}t.active=!0,t.zIndex=10001;var i=t.getComponent("FISHMANLabel");return i.defaultNames="score1_",i.spriteAtlas=i.spriteAtlas||a.FISHMANConst.once.UIAtals,i.string=c.default.once.GameLayer.changeGold(e.award)+" ",t},t.prototype.despawnBill=function(e){e.node&&this.pool_bill.put(e.node)},t.prototype.despawnBullet=function(e){e.seatId===a.FISHMANConst.once.seatId&&a.FISHMANConst.once.BulletCount--,e.setLockFishID(-1),e.node&&this.pool_bullet.put(e.node);var t=this.arr_bullets.indexOf(e);this.arr_bullets.splice(t,1),e.isDrill&&(this.despawnRoute(e.nid),e.drillRoute=null)},t.prototype.despawnEffect=function(e){e.clean();var t=this.arr_effect.indexOf(e);this.arr_effect.splice(t,1),this.pool_effect.put(e.node)},t.prototype.despawnRoute=function(){},t.prototype.despawnCoin=function(e){e.node instanceof cc.Node&&(this.pool_coin.put(e.node),e.clean()),e instanceof cc.Node&&this.pool_coin.put(e);var t=this.arr_coin.indexOf(e);this.arr_coin.splice(t,1)},t.prototype.despawnCoinLb=function(e){e.node instanceof cc.Node&&(this.pool_coinlb.put(e.node),e.clean()),e instanceof cc.Node&&this.pool_coinlb.put(e)},t.prototype.clearTableFishs=function(){for(var e=this.FishParent.childrenCount-1;e>=0;e--){var t=this.FishParent.children[e].getComponent(d.default);t&&this.despawnFish(t)}},t.prototype.despawnFish=function(e){e.node&&e instanceof d.default&&(e.node.active=!1,this.pool_fish.put(e.node));var t=this.arr_fishs.indexOf(e);-1!==t&&this.arr_fishs.splice(t,1)},t.prototype.despawnNet=function(e){e.node&&this.pool_net.put(e.node)},t.prototype.update=function(e){if(cc.isValid(this.node)){(a.FISHMANConst.once.HeartBeatCD-=e)<0&&(a.FISHMANConst.once.HeartBeatCD=5,c.default.once.heartBeat());for(var t=[],o=0;o<this.arr_fishs.length;o++){var n=this.arr_fishs[o];if(n.updatexxx(e),n&&n.alive){var i=n.node.convertToWorldSpaceAR(cc.v2(0,0));t.push({fish:n,fwsp:i})}}for(var s=[],r=0;r<this.arr_bullets.length;r++){var l=this.arr_bullets[r];l.updatexxx(e);var p=l.node.convertToWorldSpaceAR(cc.v2(0,0)),h=cc.v2(p.x,p.y-50),d=cc.v2(p.x-20,p.y),f=cc.v2(p.x+20,p.y);s.push({bullet:l,bwsp:p,bwspDown:h,bwspLeft:d,bwspRight:f})}for(r=0;r<s.length;r++){var u=s[r];for(o=0;o<t.length;o++){var y=t[o],I=u.bwsp.sub(y.fwsp).mag();if((y.fish.radius>200?200:y.fish.radius)>I){var g=y.fish.getColliderPoints().ws;(I<50||y.fish==u.bullet.lockFish||v.default.rayCasting(u.bwsp,g)||v.default.rayCasting(u.bwspDown,g)||v.default.rayCasting(u.bwspLeft,g)||v.default.rayCasting(u.bwspRight,g))&&u.bullet.onCollision(y.fish)}}}s=null,t=null}},t.prototype.onDestroy=function(){var e=function(e){for(var t=0;t<e.length;t++){var o=e[t];o.node&&(o.node.removeFromParent(),o.node.destroy())}};e(this.arr_coin),e(this.arr_bullets),e(this.arr_fishs),e(this.arr_effect),a.FISHMANConst.destroyInstance(),c.default.destroyInstance()},s([S(F.default)],t.prototype,"LoadingLayer",void 0),s([S(l.default)],t.prototype,"MenuLayer",void 0),s([S(u.default)],t.prototype,"WeaponLayer",void 0),s([S(y.default)],t.prototype,"EffectLayer",void 0),s([S(cc.Node)],t.prototype,"RechargeLayer",void 0),s([S(cc.Node)],t.prototype,"FishParent",void 0),s([S(cc.Node)],t.prototype,"BulletParent",void 0),s([S(cc.Node)],t.prototype,"GoldParent",void 0),s([S(cc.Node)],t.prototype,"GoldLabelParent",void 0),s([S(cc.Node)],t.prototype,"NetParent",void 0),s([S(cc.Node)],t.prototype,"EffectSKParent",void 0),s([S(cc.Node)],t.prototype,"EffectParent",void 0),s([m],t)}(cc.Component);o.default=A,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANBill":"FISHMANBill","./FISHMANBullet":"FISHMANBullet","./FISHMANCoin":"FISHMANCoin","./FISHMANConst":"FISHMANConst","./FISHMANEffect":"FISHMANEffect","./FISHMANEffectLayer":"FISHMANEffectLayer","./FISHMANFish":"FISHMANFish","./FISHMANFishNet":"FISHMANFishNet","./FISHMANLoading":"FISHMANLoading","./FISHMANManager":"FISHMANManager","./FISHMANMenu":"FISHMANMenu","./FISHMANUser":"FISHMANUser","./FISHMANWeapon":"FISHMANWeapon"}],FISHMANUser:[function(e,t,o){"use strict";cc._RF.push(t,"81dc4QYvZxIkrUL9A7IYF6g","FISHMANUser");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./FISHMANConst"),c=e("./FISHMANManager"),r=cc._decorator,l=r.ccclass,p=r.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._seatId=-1,t.lb_total=null,t.lb_gold=null,t.layer_zz=null,t}return i(t,e),t.prototype.initUI=function(){this.unLock(),this.node.getChildByName("btn_add").on("click",this.onClickedAdd,this)},t.prototype.onClickedAdd=function(){this._seatId==a.FISHMANConst.once.seatId&&(c.default.once.GameLayer.showRecharge(!1),c.default.once.playSFX("click"))},t.prototype.refreshUserInfo=function(e){if(cc.log("uinfo----\x3e"+JSON.stringify(e)),e){this._seatId=e.seatId,this.node.getChildByName("btn_add").active=e.seatId==a.FISHMANConst.once.seatId&&!a.FISHMANConst.once.PlayerInfo.useOneScore,this.updateBalance(e.score),this.updateDiamond(e.wins),this.node.active=!0,this.lb_gold.node.parent.active=!0;var t=c.default.once.tableConvertIndex(this._seatId);this.node.x=.19*cc.view.getVisibleSize().width,this.node.x=t%2?this.node.x+297:-this.node.x-297}},t.prototype.updateBalance=function(e){e=e||0,this.lb_gold.string=c.default.once.GameLayer.changeGold(e)},t.prototype.updateDiamond=function(e){e=e||0,this.lb_total.string=c.default.once.GameLayer.changeGold(e)},t.prototype.onClickZZ=function(){var e=c.default.once.GameLayer.findZZBoomEffect(a.FISHMANConst.once.seatId);e&&c.default.once.CmdZZBoom(e),this.showZZ(!1)},t.prototype.showZZ=function(e){this.layer_zz&&(this.layer_zz.active=e)},t.prototype.showLockFish=function(){},t.prototype.unLock=function(){},t.prototype.cleanInfo=function(){this.node.active=!1,this._seatId=-1,this.lb_total.string="",this.lb_gold.string="0",this.lb_gold.node.parent.active=!1,this.unLock()},t.prototype.getUserWorldPoint=function(){return this.node.convertToWorldSpaceAR(cc.v2(0,-30))},t.prototype.getUserWinWorldPoint=function(){return this.lb_gold.node.convertToWorldSpaceAR(cc.v2(0,-30))},s([p(cc.Label)],t.prototype,"lb_total",void 0),s([p(cc.Label)],t.prototype,"lb_gold",void 0),s([p(cc.Node)],t.prototype,"layer_zz",void 0),s([l],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./FISHMANConst":"FISHMANConst","./FISHMANManager":"FISHMANManager"}],FISHMANWeapon:[function(e,t,o){"use strict";cc._RF.push(t,"f011fwm2BlBUJBznZhOshgw","FISHMANWeapon");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(s<3?i(a):s>3?i(t,o,a):i(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../../../Script/utils/Utils"),c=e("./FISHMANConst"),r=e("./FISHMANFish"),l=e("./FISHMANManager"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SeatWaits=[],t.FishParent=null,t.arr_weaponAn=[],t.arr_weaponFire=[],t.WeaponUI=[],t.DoubleBg=[],t.arr_golds=[],t.spacingY=30,t.firstFire={set:function(e){e!==this._firstFire&&(this._firstFire=e,!this._firstFire&&this.GameLayer.MenuLayer._mune&&this.GameLayer.MenuLayer.onClickedShow())},get:function(){return this._firstFire}},t.arr_weapons=[],t.arr_lines=[],t.arr_circle=[],t.arrLevels=[],t.arr_locks=[c.FISHMANConst.once.NotFound,c.FISHMANConst.once.NotFound,c.FISHMANConst.once.NotFound,c.FISHMANConst.once.NotFound],t.arr_changes=[],t._limitTime=0,t.LastFireTime=0,t.AutoFire=!1,t}return i(t,e),t.prototype.onLoad=function(){},t.prototype.init=function(){this.initViewData(),this.FishParent.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.FishParent.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.FishParent.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.FishParent.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.FishParent._touchListener.setSwallowTouches(!1),this.schedule(this.speed0,c.FISHMANFireSpeed.Speed0),this.schedule(this.speed1,c.FISHMANFireSpeed.Speed1),this.firstFire=!0},t.prototype.speed1=function(){c.FISHMANConst.once.FightLimit==c.FISHMANFireSpeed.Speed1&&(this.limitFireCd(),this.checkAutoFire())},t.prototype.speed0=function(){c.FISHMANConst.once.FightLimit==c.FISHMANFireSpeed.Speed0&&(this.limitFireCd(),this.checkAutoFire())},t.prototype.limitFireCd=function(){this.checkAutoLock(),this._canFire=!0},t.prototype.checkAutoFire=function(){if(-1!=c.FISHMANConst.once.seatId&&(c.FISHMANConst.once.IsAuto||this.AutoFire)){var e=this.getWeaponOutPositionByTid(c.FISHMANConst.once.seatId),t=l.default.once.tableConvertIndex(),o=this.arr_locks[t];o instanceof r.default&&(e=o.getWorldPoint()),this._touchPoint&&(e=this._touchPoint,this._touchPoint=null),l.default.once.onTouchWindow(e,o.fishId),this.firstFire=!1}},t.prototype.setWeaponGold=function(e,t){var o=l.default.once.userConvertIndex(e),n=this.arr_golds[o];if(n){var i=t*c.FISHMANConst.once.RoomBet;n.string=l.default.once.GameLayer.changeGold(i),n.node.active=!0}},t.prototype.setConvertWeaponActive=function(e,t,o){void 0===o&&(o=!0);var n=l.default.once.userConvertIndex(e);try{var i=this.WeaponUI[n];if(i.active=this.arr_weaponAn[n].node.active=t,this.SeatWaits[n].active=!t,this.WeaponUI[n].getChildByName("btn_add").active=t&&c.FISHMANConst.once.userId===e,this.WeaponUI[n].getChildByName("btn_minus").active=t&&c.FISHMANConst.once.userId===e,c.FISHMANConst.once.userId===e&&o){for(var s=[cc.fadeIn(.1)],a=0;a<8;a++)s.push(cc.moveTo(.5,cc.v2(0,a%2==0?160:190)));s.push(cc.fadeOut(.1));var r=i.getChildByName("sp_there");r.active=!0,r.stopAllActions(),r.runAction(cc.sequence(s))}}catch(p){cc.log("setConvertWeaponActive---\x3e"+JSON.stringify(p))}},t.prototype.initViewData=function(){for(var e=this.WeaponUI,t=0;t<4;t++){var o=e[t];o.getChildByName("sp_lock").getComponent(cc.Sprite).spriteFrame=l.default.once.getFrameByName("icon_locking");for(var n=cc.find("an_pao",o).getComponent(cc.Animation),i=n.node.children[0].getComponent(cc.Animation),s=1;s<5;s++){var a=l.default.once.getEffectByType("Gun"+s+"_");a.wrapMode=cc.WrapMode.Normal,n.addClip(a);var c=l.default.once.getEffectByType("Fire"+s+"_");c.wrapMode=cc.WrapMode.Normal,i.addClip(c)}this.arr_weaponFire[t]=i;var r="onFinishFireAn"+t;i.on("finished",this[r],this);var p="onFinishWeaponAn"+t;n.on("finished",this[p],this),this.arr_weaponAn[t]=n,n.node.children[0].active=!1,o.getChildByName("double").active=!1,cc.find("btn_add",o).on("click",this.onClickedAdd,this),cc.find("btn_minus",o).on("click",this.onClicked__,this),cc.find("btn_add",o).active=!1,cc.find("btn_minus",o).active=!1,this.arr_golds.push(o.getChildByName("lb_level").getComponent("FISHMANLabel")),this.arr_weapons.push(o.getChildByName("tip"));var h=o.getChildByName("layer_line").getComponent(cc.Layout);h.spacingY=this.spacingY,this.arr_lines.push(h);var d=o.getChildByName("sp_lock");this.arr_circle.push(d),this.arrLevels.push(0)}},t.prototype.setTimelimit=function(e){this._limitTime=e},Object.defineProperty(t.prototype,"timeLimit",{get:function(){return this._limitTime<=0&&this._canFire},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"balanceLimit",{get:function(){var e=this.getLevelCoinByUID();return c.FISHMANConst.once.Entries>=e},enumerable:!1,configurable:!0}),t.prototype.setClickLimit=function(e){this._canFire=e},t.prototype.paramAniName=function(e){return e<1&&(e=1),e>4&&(e=4),"Gun"+e+"_0"},t.prototype.getLevelCoinByUID=function(e){void 0===e&&(e=404);var t=404===e?c.FISHMANConst.once.userId:e,o=l.default.once.userConvertIndex(t);return parseFloat(this.arr_golds[o].string)},t.prototype.refreshWeaponByIndex=function(e,t){var o=this.arrLevels[e];if(void 0!==o){var n=this.paramAniName(o+1,t);this.arr_weaponAn[e].node.getComponent(cc.Sprite).spriteFrame=c.FISHMANConst.once.UIAtals.getSpriteFrame(n)}},t.prototype.showChangeWeaponByIndex=function(e){var t=this.arrLevels[e],o=this.paramAniName(t+1,1);this.arr_weaponAn[e].node.getComponent(cc.Sprite).spriteFrame=c.FISHMANConst.once.UIAtals.getSpriteFrame(o)},t.prototype.setLevelByUID=function(e,t){var o=l.default.once.userConvertIndex(e);l.default.once.playSFX("weapon_change"),t>3&&(t=3),t<0&&(t=0),this.arrLevels[o]=t,this.showChangeWeaponByIndex(o)},t.prototype.cleanInfoByTid=function(e){var t=l.default.once.tableConvertIndex(e);this.arrLevels[t]=0,this.showDoubleByIndex(t,0),this.arr_weaponAn[t].node.active=!1,this.arr_golds[t].node.active=!1,this.DoubleBg[t].active=!1,this.WeaponUI[t].active=!1,this.SeatWaits[t].active=!0,this.setLockFishByTid(e)},t.prototype.hideLockLineByIndex=function(e){var t=this.arr_lines[e];t&&(t.node.active=!1,this.arr_circle[e].active=!1)},t.prototype.showLockLineByTid=function(e,t){if(t instanceof r.default){var o=t.getWorldPoint(),n=l.default.once.tableConvertIndex(e);this.changeWeaponRotationByTid(o,e,!1);var i=this.arr_weapons[n],s=this.arr_circle[n];s.position=i.parent.convertToNodeSpaceAR(o),s.active=!0;var a=this.arr_lines[n];a.node.angle=i.angle;var p=this.getWeaponOutPositionByTid(e,10);a.node.position=a.node.parent.convertToNodeSpaceAR(p),a.node.scale=1;var h=o.sub(p).mag()-10;a.height=h;var d=h/(56+this.spacingY);d=Math.ceil(d)-1;for(var f=a.node.children.length,u=0;u<d||u<f;u++){var y=a.node.children[u];y||((y=cc.instantiate(a.node.children[0])).active=!1,y.getComponent(cc.Sprite).spriteFrame=c.FISHMANConst.once.UIAtals.getSpriteFrame("anchoro"+e)),y.scale=1,a.node!==y.parent&&(y.parent=a.node),y.active!==u<d&&(y.active=u<d)}a.node.active=!0}},t.prototype.getConvertWeaponRotationByTid=function(e,t,o){void 0===o&&(o=0);var n=l.default.once.tableConvertIndex(t),i=this.arr_weapons[n];if(cc.isValid(i)){var s=o,a=i.convertToWorldSpaceAR(cc.v2(0,s));return l.default.once.convertPointToAngle(a,e)-90}},t.prototype.getWeaponRotationByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_weapons[t].angle},t.prototype.getWeaponLowerPositionByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_weapons[t].convertToWorldSpaceAR(cc.v2(0,0))},t.prototype.onTouchStart=function(e,t){l.default.once.playSFX("click");var o=e.getLocation(),n=l.default.once.tableConvertIndex(),i=this.WeaponUI[n],s=i.getChildByName("btn_add").convertToWorldSpaceAR(cc.v2(0,0)),a=i.getChildByName("btn_minus").convertToWorldSpaceAR(cc.v2(0,0));s.sub(o).mag()<50||a.sub(o).mag()<50||-1!=c.FISHMANConst.once.seatId&&(c.FISHMANConst.once.IsAuto&&this.onTouchMove(e),this.getLockFishByTid(c.FISHMANConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.FISHMANConst.once.seatId),t instanceof r.default&&c.FISHMANConst.once.IsLock&&(cc.log("\u70b9\u51fb\uff1a"+t.config.Name),l.default.once.CmdBYLockFish(t)),this.clickFire(o),this.AutoFire=!0)},t.prototype.onTouchMove=function(e){-1!=c.FISHMANConst.once.seatId&&(this._touchPoint=e.getLocation(),this.getLockFishByTid(c.FISHMANConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.FISHMANConst.once.seatId))},t.prototype.onTouchEnd=function(e){this.AutoFire=!1,-1!=c.FISHMANConst.once.seatId&&(this.getLockFishByTid(c.FISHMANConst.once.seatId)instanceof r.default||this.changeWeaponRotationByTid(e.getLocation(),c.FISHMANConst.once.seatId))},t.prototype.clickFire=function(e){this._limitTime>0||-1===c.FISHMANConst.once.seatId||(c.FISHMANConst.once.IsAuto?this._touchPoint=e:l.default.once.onTouchWindow(e))},t.prototype.changeWeaponRotationByTid=function(e,t,o){void 0===o&&(o=!0);var n=l.default.once.tableConvertIndex(t);if(this.arr_weapons[n]&&this.arr_weaponAn[n]){n>1&&o&&(e.y=cc.view.getVisibleSize().height-e.y);var i=-this.getConvertWeaponRotationByTid(e,t);this.arr_weapons[n].angle=i,this.arr_weaponAn[n].node.angle=i}},t.prototype.getWeaponOutPositionByTid=function(e,t){void 0===t&&(t=c.FISHMANConst.once.WeaponHight);var o=l.default.once.tableConvertIndex(e);return this.arr_weapons[o].convertToWorldSpaceAR(cc.v2(0,t))},t.prototype.getLockFishByTid=function(e){var t=l.default.once.tableConvertIndex(e);return this.arr_locks[t]},t.prototype.onClickedAdd=function(){l.default.once.playSFX("click"),this.changeWeaponBet(1)},t.prototype.onClicked__=function(){l.default.once.playSFX("click"),this.changeWeaponBet(-1)},t.prototype.changeWeaponBet=function(e){var t=c.FISHMANConst.once.BLevel;(t+=e)>=c.FISHMANConst.once.BLevels.length&&(t=0),t<0&&(t=c.FISHMANConst.once.BLevels.length-1),l.default.once.requestChangeCannonBet(JSON.stringify({userid:c.FISHMANConst.once.userId,bet:c.FISHMANConst.once.BLevels[t]}))},t.prototype.showWeapon=function(e){var t=a.default.deepCopy(e),o=l.default.once.userConvertIndex(t.userid),n=this.getLockFishByTid(t.seatId);if(t.userid!=c.FISHMANConst.once.userId){var i=n instanceof r.default?n.getWorldPoint():cc.v2(t.touch.x,t.touch.y);this.changeWeaponRotationByTid(i,t.seatId)}var s=this.arrLevels[o];if(this.arr_weaponAn[o].play("Gun"+(s+1)+"_"),this.arr_weaponFire[o].node.active=!0,this.arr_weaponFire[o].play("Fire"+(s+1)+"_"),t.lock=n.fishId,t.level=s,l.default.once.GameLayer.addBullet(t),t.seatId===c.FISHMANConst.once.seatId){s<1&&(s=1);var p=t.isDrill?"s208":"v"+s;l.default.once.playSFX(p),this.firstFire=!1,l.default.once.GameLayer.EffectLayer.showLable(this._limitTime)}},t.prototype.setLockFishByTid=function(e,t){var o=l.default.once.tableConvertIndex(e),n=this.getLockFishByTid(e);n instanceof r.default&&n.popLockTid(e),this.hideLockLineByIndex(o),t instanceof r.default?this.arr_locks[o]=t:this.arr_locks[o]=c.FISHMANConst.once.NotFound},t.prototype.cleanFishAllWeaponLock=function(e){for(var t=0;t<4;t++){var o=this.getLockFishByTid(t);e.fishId===o.fishId&&this.setLockFishByTid(t)}},t.prototype.touchFishIsLock=function(e){var t=this.getLockFishByTid(c.FISHMANConst.once.seatId);return c.FISHMANConst.once.IsLock&&(t instanceof r.default&&t.fishId!==e.fishId||!(t instanceof r.default))},t.prototype.showDoubleByIndex=function(e,t){void 0===t&&(t=30);var o=this.DoubleBg[e];o.active=!0,o.stopAllActions(),o.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){o.active=!1})))},t.prototype.checkAutoLock=function(){if(-1!=c.FISHMANConst.once.seatId&&c.FISHMANConst.once.IsLock&&!(this.getLockFishByTid(c.FISHMANConst.once.seatId)instanceof r.default)){var e=l.default.once.getMaxFish();e instanceof r.default&&l.default.once.CmdBYLockFish(e)}},t.prototype.update=function(e){cc.isValid(this.node)&&(this.LastFireTime-=e,this._limitTime-=e,this.LastFireTime<-999998||(this.LastFireTime<-60&&l.default.once.GameLayer.EffectLayer.showLable(this.LastFireTime),this.LastFireTime<-91&&this.LastFireTime>-190&&(this.LastFireTime=-999999,l.default.once.GameLayer.MenuLayer.onClickedBack())))},t.prototype.onFinishWeaponAn0=function(){this.refreshWeaponByIndex(0,1)},t.prototype.onFinishWeaponAn1=function(){this.refreshWeaponByIndex(1,1)},t.prototype.onFinishWeaponAn2=function(){this.refreshWeaponByIndex(2,1)},t.prototype.onFinishWeaponAn3=function(){this.refreshWeaponByIndex(3,1)},t.prototype.onFinishFireAn0=function(){this.arr_weaponFire[0].node.active=!1},t.prototype.onFinishFireAn1=function(){this.arr_weaponFire[1].node.active=!1},t.prototype.onFinishFireAn2=function(){this.arr_weaponFire[2].node.active=!1},t.prototype.onFinishFireAn3=function(){this.arr_weaponFire[3].node.active=!1},t.prototype.onDestroy=function(){this.unschedule(this.speed0),this.unschedule(this.speed1)},s([d([cc.Node])],t.prototype,"SeatWaits",void 0),s([d(cc.Node)],t.prototype,"FishParent",void 0),s([d([cc.Node])],t.prototype,"WeaponUI",void 0),s([d([cc.Node])],t.prototype,"DoubleBg",void 0),s([h],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../../../Script/utils/Utils":void 0,"./FISHMANConst":"FISHMANConst","./FISHMANFish":"FISHMANFish","./FISHMANManager":"FISHMANManager"}]},{},["FISHMANBill","FISHMANBullet","FISHMANCoin","FISHMANConst","FISHMANEffect","FISHMANEffectLayer","FISHMANFish","FISHMANFishNet","FISHMANLabel","FISHMANLoading","FISHMANManager","FISHMANMenu","FISHMANNetWork","FISHMANScene","FISHMANUser","FISHMANWeapon"]);